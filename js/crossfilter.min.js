!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).crossfilter=factory()}(this,(function(){"use strict";let array8=arrayUntyped,array16=arrayUntyped,array32=arrayUntyped,arrayLengthen=arrayLengthenUntyped,arrayWiden=arrayWidenUntyped;function arrayUntyped(n){for(var array=new Array(n),i=-1;++i<n;)array[i]=0;return array}function arrayLengthenUntyped(array,length){for(var n=array.length;n<length;)array[n++]=0;return array}function arrayWidenUntyped(array,width){if(width>32)throw new Error("invalid array width!");return array}function bitarray(n){this.length=n,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=array8(n)}"undefined"!=typeof Uint8Array&&(array8=function(n){return new Uint8Array(n)},array16=function(n){return new Uint16Array(n)},array32=function(n){return new Uint32Array(n)},arrayLengthen=function(array,length){if(array.length>=length)return array;var copy=new array.constructor(length);return copy.set(array),copy},arrayWiden=function(array,width){var copy;switch(width){case 16:copy=array16(array.length);break;case 32:copy=array32(array.length);break;default:throw new Error("invalid array width!")}return copy.set(array),copy}),bitarray.prototype.lengthen=function(n){var i,len;for(i=0,len=this.subarrays;i<len;++i)this[i]=arrayLengthen(this[i],n);this.length=n},bitarray.prototype.add=function(){var m,w,one,i,len;for(i=0,len=this.subarrays;i<len;++i)if(one=(~(m=this.masks[i])&m+1)>>>0,!((w=this.width-32*i)>=32)||one)return w<32&&one&1<<w&&(this[i]=arrayWiden(this[i],w<<=1),this.width=32*i+w),this.masks[i]|=one,{offset:i,one:one};return this[this.subarrays]=array8(this.length),this.masks[this.subarrays]=1,this.width+=8,{offset:this.subarrays++,one:1}},bitarray.prototype.copy=function(dest,src){var i,len;for(i=0,len=this.subarrays;i<len;++i)this[i][dest]=this[i][src]},bitarray.prototype.truncate=function(n){var i,len;for(i=0,len=this.subarrays;i<len;++i)for(var j=this.length-1;j>=n;j--)this[i][j]=0;this.length=n},bitarray.prototype.zero=function(n){var i,len;for(i=0,len=this.subarrays;i<len;++i)if(this[i][n])return!1;return!0},bitarray.prototype.zeroExcept=function(n,offset,zero){var i,len;for(i=0,len=this.subarrays;i<len;++i)if(i===offset?this[i][n]&zero:this[i][n])return!1;return!0},bitarray.prototype.zeroExceptMask=function(n,mask){var i,len;for(i=0,len=this.subarrays;i<len;++i)if(this[i][n]&mask[i])return!1;return!0},bitarray.prototype.only=function(n,offset,one){var i,len;for(i=0,len=this.subarrays;i<len;++i)if(this[i][n]!=(i===offset?one:0))return!1;return!0},bitarray.prototype.onlyExcept=function(n,offset,zero,onlyOffset,onlyOne){var mask,i,len;for(i=0,len=this.subarrays;i<len;++i)if(mask=this[i][n],i===offset&&(mask=(mask&zero)>>>0),mask!=(i===onlyOffset?onlyOne:0))return!1;return!0};var xfilterArray={array8:arrayUntyped,array16:arrayUntyped,array32:arrayUntyped,arrayLengthen:arrayLengthenUntyped,arrayWiden:arrayWidenUntyped,bitarray:bitarray};const filterExact=(bisect,value)=>function(values){var n=values.length;return[bisect.left(values,value,0,n),bisect.right(values,value,0,n)]},filterRange=(bisect,range)=>{var min=range[0],max=range[1];return function(values){var n=values.length;return[bisect.left(values,min,0,n),bisect.left(values,max,0,n)]}},filterAll=values=>[0,values.length];var xfilterFilter_filterExact=filterExact,xfilterFilter_filterRange=filterRange,xfilterFilter_filterAll=filterAll,cr_identity=d=>d,cr_null=()=>null,cr_zero=()=>0;function heap_by(f){function heap(a,lo,hi){for(var n=hi-lo,i=1+(n>>>1);--i>0;)sift(a,i,n,lo);return a}function sort(a,lo,hi){for(var n=hi-lo,t;--n>0;)t=a[lo],a[lo]=a[lo+n],a[lo+n]=t,sift(a,1,n,lo);return a}function sift(a,i,n,lo){for(var d=a[--lo+i],x=f(d),child;(child=i<<1)<=n&&(child<n&&f(a[lo+child])>f(a[lo+child+1])&&child++,!(x<=f(a[lo+child])));)a[lo+i]=a[lo+child],i=child;a[lo+i]=d}return heap.sort=sort,heap}const h=heap_by(cr_identity);function heapselect_by(f){var heap=h.by(f);function heapselect(a,lo,hi,k){var queue=new Array(k=Math.min(hi-lo,k)),min,i,d;for(i=0;i<k;++i)queue[i]=a[lo++];if(heap(queue,0,k),lo<hi){min=f(queue[0]);do{f(d=a[lo])>min&&(queue[0]=d,min=f(heap(queue,0,k)[0]))}while(++lo<hi)}return queue}return heapselect}h.by=heap_by;const h$1=heapselect_by(cr_identity);function bisect_by(f){function bisectLeft(a,x,lo,hi){for(;lo<hi;){var mid=lo+hi>>>1;f(a[mid])<x?lo=mid+1:hi=mid}return lo}function bisectRight(a,x,lo,hi){for(;lo<hi;){var mid=lo+hi>>>1;x<f(a[mid])?hi=mid:lo=mid+1}return lo}return bisectRight.right=bisectRight,bisectRight.left=bisectLeft,bisectRight}h$1.by=heapselect_by;const bisect=bisect_by(cr_identity);bisect.by=bisect_by;var permute=(array,index,deep)=>{for(var i=0,n=index.length,copy=deep?JSON.parse(JSON.stringify(array)):new Array(n);i<n;++i)copy[i]=array[index[i]];return copy};const reduceIncrement=p=>p+1,reduceDecrement=p=>p-1,reduceAdd=f=>function(p,v){return p+ +f(v)},reduceSubtract=f=>function(p,v){return p-f(v)};var xfilterReduce_reduceIncrement=reduceIncrement,xfilterReduce_reduceDecrement=reduceDecrement,xfilterReduce_reduceAdd=reduceAdd,xfilterReduce_reduceSubtract=reduceSubtract;function deep(t,e,i,n,r){for(r in n=(i=i.split(".")).splice(-1,1),i)e=e[i[r]]=e[i[r]]||{};return t(e,n)}const get=(obj,prop)=>{const value=obj[prop];return"function"==typeof value?value.call(obj):value},reg=/\[([\w\d]+)\]/g;var result=(obj,path)=>deep(get,obj,path.replace(reg,".$1")),REMOVED_INDEX=-1;function crossfilter(){var crossfilter={add:add,remove:removeData,dimension:dimension,groupAll:groupAll,size:size,all:all,allFiltered:allFiltered,onChange:onChange,isElementFiltered:isElementFiltered},data=[],n=0,filters,filterListeners=[],dataListeners=[],removeDataListeners=[],callbacks=[];function add(newData){var n0=n,n1=newData.length;return n1&&(data=data.concat(newData),filters.lengthen(n+=n1),dataListeners.forEach((function(l){l(newData,n0,n1)})),triggerOnChange("dataAdded")),crossfilter}function removeData(predicate){for(var newIndex=new Array(n),removed=[],usePred="function"==typeof predicate,shouldRemove=function(i){return usePred?predicate(data[i],i):filters.zero(i)},index1=0,index2=0;index1<n;++index1)shouldRemove(index1)?(removed.push(index1),newIndex[index1]=-1):newIndex[index1]=index2++;filterListeners.forEach((function(l){l(-1,-1,[],removed,!0)})),removeDataListeners.forEach((function(l){l(newIndex)}));for(var index3=0,index4=0;index3<n;++index3)-1!==newIndex[index3]&&(index3!==index4&&(filters.copy(index4,index3),data[index4]=data[index3]),++index4);data.length=n=index4,filters.truncate(index4),triggerOnChange("dataRemoved")}function maskForDimensions(dimensions){var n,d,len,id,mask=Array(filters.subarrays);for(n=0;n<filters.subarrays;n++)mask[n]=-1;for(d=0,len=dimensions.length;d<len;d++)mask[(id=dimensions[d].id())>>7]&=~(1<<(63&id));return mask}function isElementFiltered(i,ignore_dimensions){var mask=maskForDimensions(ignore_dimensions||[]);return filters.zeroExceptMask(i,mask)}function dimension(value,iterable){if("string"==typeof value){var accessorPath=value;value=function(d){return result(d,accessorPath)}}var dimension={filter:filter,filterExact:filterExact,filterRange:filterRange,filterFunction:filterFunction,filterAll:filterAll,currentFilter:currentFilter,hasCurrentFilter:hasCurrentFilter,top:top,bottom:bottom,group:group,groupAll:groupAll,dispose:dispose,remove:dispose,accessor:value,id:function(){return id}},one,zero,offset,id,values,index,newValues,newIndex,iterablesIndexCount,iterablesIndexFilterStatus,iterablesEmptyRows=[],sortRange=function(n){return cr_range(n).sort((function(A,B){var a=newValues[A],b=newValues[B];return a<b?-1:a>b?1:A-B}))},refilter=xfilterFilter_filterAll,refilterFunction,filterValue,filterValuePresent,indexListeners=[],dimensionGroups=[],lo0=0,hi0=0,t=0,k;dataListeners.unshift(preAdd),dataListeners.push(postAdd),removeDataListeners.push(removeData);var tmp=filters.add();function preAdd(newData,n0,n1){var newIterablesIndexCount,newIterablesIndexFilterStatus;if(iterable){t=0,j=0,k=[];for(var i0=0;i0<newData.length;i0++)for(j=0,k=value(newData[i0]);j<k.length;j++)t++;newValues=[],newIterablesIndexCount=cr_range(newData.length),newIterablesIndexFilterStatus=cr_index(t,1);for(var unsortedIndex=cr_range(t),l=0,index1=0;index1<newData.length;index1++)if((k=value(newData[index1])).length)for(newIterablesIndexCount[index1]=k.length,j=0;j<k.length;j++)newValues.push(k[j]),unsortedIndex[l]=index1,l++;else newIterablesIndexCount[index1]=0,iterablesEmptyRows.push(index1+n0);var sortMap=sortRange(t);newValues=permute(newValues,sortMap),newIndex=permute(unsortedIndex,sortMap)}else newValues=newData.map(value),newIndex=sortRange(n1),newValues=permute(newValues,newIndex);var bounds=refilter(newValues),lo1=bounds[0],hi1=bounds[1],index2,index3,index4;if(iterable)if(n1=t,refilterFunction)for(index2=0;index2<n1;++index2)refilterFunction(newValues[index2],index2)||(0==--newIterablesIndexCount[newIndex[index2]]&&(filters[offset][newIndex[index2]+n0]|=one),newIterablesIndexFilterStatus[index2]=1);else{for(index3=0;index3<lo1;++index3)0==--newIterablesIndexCount[newIndex[index3]]&&(filters[offset][newIndex[index3]+n0]|=one),newIterablesIndexFilterStatus[index3]=1;for(index4=hi1;index4<n1;++index4)0==--newIterablesIndexCount[newIndex[index4]]&&(filters[offset][newIndex[index4]+n0]|=one),newIterablesIndexFilterStatus[index4]=1}else if(refilterFunction)for(index2=0;index2<n1;++index2)refilterFunction(newValues[index2],index2)||(filters[offset][newIndex[index2]+n0]|=one);else{for(index3=0;index3<lo1;++index3)filters[offset][newIndex[index3]+n0]|=one;for(index4=hi1;index4<n1;++index4)filters[offset][newIndex[index4]+n0]|=one}if(!n0)return values=newValues,index=newIndex,iterablesIndexCount=newIterablesIndexCount,iterablesIndexFilterStatus=newIterablesIndexFilterStatus,lo0=lo1,void(hi0=hi1);var oldValues=values,oldIndex=index,oldIterablesIndexFilterStatus=iterablesIndexFilterStatus,old_n0,i1=0;if(i0=0,iterable&&(old_n0=n0,n0=oldValues.length,n1=t),values=new Array(iterable?n0+n1:n),index=iterable?new Array(n0+n1):cr_index(n,n),iterable&&(iterablesIndexFilterStatus=cr_index(n0+n1,1)),iterable){var oldiiclength=iterablesIndexCount.length;iterablesIndexCount=xfilterArray.arrayLengthen(iterablesIndexCount,n);for(var j=0;j+oldiiclength<n;j++)iterablesIndexCount[j+oldiiclength]=newIterablesIndexCount[j]}for(var index5=0;i0<n0&&i1<n1;++index5)oldValues[i0]<newValues[i1]?(values[index5]=oldValues[i0],iterable&&(iterablesIndexFilterStatus[index5]=oldIterablesIndexFilterStatus[i0]),index[index5]=oldIndex[i0++]):(values[index5]=newValues[i1],iterable&&(iterablesIndexFilterStatus[index5]=newIterablesIndexFilterStatus[i1]),index[index5]=newIndex[i1++]+(iterable?old_n0:n0));for(;i0<n0;++i0,++index5)values[index5]=oldValues[i0],iterable&&(iterablesIndexFilterStatus[index5]=oldIterablesIndexFilterStatus[i0]),index[index5]=oldIndex[i0];for(;i1<n1;++i1,++index5)values[index5]=newValues[i1],iterable&&(iterablesIndexFilterStatus[index5]=newIterablesIndexFilterStatus[i1]),index[index5]=newIndex[i1]+(iterable?old_n0:n0);bounds=refilter(values),lo0=bounds[0],hi0=bounds[1]}function postAdd(newData,n0,n1){indexListeners.forEach((function(l){l(newValues,newIndex,n0,n1)})),newValues=newIndex=null}function removeData(reIndex){if(iterable){for(var i0=0,i1=0;i0<iterablesEmptyRows.length;i0++)-1!==reIndex[iterablesEmptyRows[i0]]&&(iterablesEmptyRows[i1]=reIndex[iterablesEmptyRows[i0]],i1++);for(iterablesEmptyRows.length=i1,i0=0,i1=0;i0<n;i0++)-1!==reIndex[i0]&&(i1!==i0&&(iterablesIndexCount[i1]=iterablesIndexCount[i0]),i1++);iterablesIndexCount=iterablesIndexCount.slice(0,i1)}for(var n0=values.length,i=0,j=0,oldDataIndex;i<n0;++i)-1!==reIndex[oldDataIndex=index[i]]&&(i!==j&&(values[j]=values[i]),index[j]=reIndex[oldDataIndex],iterable&&(iterablesIndexFilterStatus[j]=iterablesIndexFilterStatus[i]),++j);for(values.length=j,iterable&&(iterablesIndexFilterStatus=iterablesIndexFilterStatus.slice(0,j));j<n0;)index[j++]=0;var bounds=refilter(values);lo0=bounds[0],hi0=bounds[1]}function filterIndexBounds(bounds){var lo1=bounds[0],hi1=bounds[1];if(refilterFunction)return refilterFunction=null,filterIndexFunction((function(d,i){return lo1<=i&&i<hi1}),0===bounds[0]&&bounds[1]===values.length),lo0=lo1,hi0=hi1,dimension;var i,j,k,added=[],removed=[],valueIndexAdded=[],valueIndexRemoved=[];if(lo1<lo0)for(i=lo1,j=Math.min(lo0,hi1);i<j;++i)added.push(index[i]),valueIndexAdded.push(i);else if(lo1>lo0)for(i=lo0,j=Math.min(lo1,hi0);i<j;++i)removed.push(index[i]),valueIndexRemoved.push(i);if(hi1>hi0)for(i=Math.max(lo1,hi0),j=hi1;i<j;++i)added.push(index[i]),valueIndexAdded.push(i);else if(hi1<hi0)for(i=Math.max(lo0,hi1),j=hi0;i<j;++i)removed.push(index[i]),valueIndexRemoved.push(i);if(iterable){var newAdded=[],newRemoved=[];for(i=0;i<added.length;i++)iterablesIndexCount[added[i]]++,iterablesIndexFilterStatus[valueIndexAdded[i]]=0,1===iterablesIndexCount[added[i]]&&(filters[offset][added[i]]^=one,newAdded.push(added[i]));for(i=0;i<removed.length;i++)iterablesIndexCount[removed[i]]--,iterablesIndexFilterStatus[valueIndexRemoved[i]]=1,0===iterablesIndexCount[removed[i]]&&(filters[offset][removed[i]]^=one,newRemoved.push(removed[i]));if(added=newAdded,removed=newRemoved,refilter===xfilterFilter_filterAll)for(i=0;i<iterablesEmptyRows.length;i++)filters[offset][k=iterablesEmptyRows[i]]&one&&(filters[offset][k]^=one,added.push(k));else for(i=0;i<iterablesEmptyRows.length;i++)filters[offset][k=iterablesEmptyRows[i]]&one||(filters[offset][k]^=one,removed.push(k))}else{for(i=0;i<added.length;i++)filters[offset][added[i]]^=one;for(i=0;i<removed.length;i++)filters[offset][removed[i]]^=one}return lo0=lo1,hi0=hi1,filterListeners.forEach((function(l){l(one,offset,added,removed)})),triggerOnChange("filtered"),dimension}function filter(range){return null==range?filterAll():Array.isArray(range)?filterRange(range):"function"==typeof range?filterFunction(range):filterExact(range)}function filterExact(value){return filterValue=value,filterValuePresent=!0,filterIndexBounds((refilter=xfilterFilter_filterExact(bisect,value))(values))}function filterRange(range){return filterValue=range,filterValuePresent=!0,filterIndexBounds((refilter=xfilterFilter_filterRange(bisect,range))(values))}function filterAll(){return filterValue=void 0,filterValuePresent=!1,filterIndexBounds((refilter=xfilterFilter_filterAll)(values))}function filterFunction(f){filterValue=f,filterValuePresent=!0,refilterFunction=f,refilter=xfilterFilter_filterAll,filterIndexFunction(f,!1);var bounds=refilter(values);return lo0=bounds[0],hi0=bounds[1],dimension}function filterIndexFunction(f,filterAll){var i,k,x,added=[],removed=[],valueIndexAdded=[],valueIndexRemoved=[],indexLength=values.length;if(!iterable)for(i=0;i<indexLength;++i)!(filters[offset][k=index[i]]&one)^!!(x=f(values[i],i))&&(x?added.push(k):removed.push(k));if(iterable)for(i=0;i<indexLength;++i)f(values[i],i)?(added.push(index[i]),valueIndexAdded.push(i)):(removed.push(index[i]),valueIndexRemoved.push(i));if(iterable){var newAdded=[],newRemoved=[];for(i=0;i<added.length;i++)1===iterablesIndexFilterStatus[valueIndexAdded[i]]&&(iterablesIndexCount[added[i]]++,iterablesIndexFilterStatus[valueIndexAdded[i]]=0,1===iterablesIndexCount[added[i]]&&(filters[offset][added[i]]^=one,newAdded.push(added[i])));for(i=0;i<removed.length;i++)0===iterablesIndexFilterStatus[valueIndexRemoved[i]]&&(iterablesIndexCount[removed[i]]--,iterablesIndexFilterStatus[valueIndexRemoved[i]]=1,0===iterablesIndexCount[removed[i]]&&(filters[offset][removed[i]]^=one,newRemoved.push(removed[i])));if(added=newAdded,removed=newRemoved,filterAll)for(i=0;i<iterablesEmptyRows.length;i++)filters[offset][k=iterablesEmptyRows[i]]&one&&(filters[offset][k]^=one,added.push(k));else for(i=0;i<iterablesEmptyRows.length;i++)filters[offset][k=iterablesEmptyRows[i]]&one||(filters[offset][k]^=one,removed.push(k))}else{for(i=0;i<added.length;i++)filters[offset][added[i]]&one&&(filters[offset][added[i]]&=zero);for(i=0;i<removed.length;i++)filters[offset][removed[i]]&one||(filters[offset][removed[i]]|=one)}filterListeners.forEach((function(l){l(one,offset,added,removed)})),triggerOnChange("filtered")}function currentFilter(){return filterValue}function hasCurrentFilter(){return filterValuePresent}function top(k,top_offset){var array=[],i=hi0,j,toSkip=0;for(top_offset&&top_offset>0&&(toSkip=top_offset);--i>=lo0&&k>0;)filters.zero(j=index[i])&&(toSkip>0?--toSkip:(array.push(data[j]),--k));if(iterable)for(i=0;i<iterablesEmptyRows.length&&k>0;i++)filters.zero(j=iterablesEmptyRows[i])&&(toSkip>0?--toSkip:(array.push(data[j]),--k));return array}function bottom(k,bottom_offset){var array=[],i,j,toSkip=0;if(bottom_offset&&bottom_offset>0&&(toSkip=bottom_offset),iterable)for(i=0;i<iterablesEmptyRows.length&&k>0;i++)filters.zero(j=iterablesEmptyRows[i])&&(toSkip>0?--toSkip:(array.push(data[j]),--k));for(i=lo0;i<hi0&&k>0;)filters.zero(j=index[i])&&(toSkip>0?--toSkip:(array.push(data[j]),--k)),i++;return array}function group(key){var group={top:top,all:all,reduce:reduce,reduceCount:reduceCount,reduceSum:reduceSum,order:order,orderNatural:orderNatural,size:size,dispose:dispose,remove:dispose};dimensionGroups.push(group);var groups,groupIndex,groupWidth=8,groupCapacity=capacity(groupWidth),k=0,select,heap,reduceAdd,reduceRemove,reduceInitial,update=cr_null,reset=cr_null,resetNeeded=!0,groupAll=key===cr_null,n0old;function add(newValues,newIndex,n0,n1){iterable&&(n0old=n0,n0=values.length-newValues.length,n1=newValues.length);var oldGroups=groups,reIndex=iterable?[]:cr_index(k,groupCapacity),add=reduceAdd,remove=reduceRemove,initial=reduceInitial,k0=k,i0=0,i1=0,j,g0,x0,x1,g,x;for(resetNeeded&&(add=initial=cr_null),resetNeeded&&(remove=initial=cr_null),groups=new Array(k),k=0,groupIndex=iterable?k0?groupIndex:[]:k0>1?xfilterArray.arrayLengthen(groupIndex,n):cr_index(n,groupCapacity),k0&&(x0=(g0=oldGroups[0]).key);i1<n1&&!((x1=key(newValues[i1]))>=x1);)++i1;for(;i1<n1;){for(g0&&x0<=x1?(g=g0,x=x0,reIndex[i0]=k,(g0=oldGroups[++i0])&&(x0=g0.key)):(g={key:x1,value:initial()},x=x1),groups[k]=g;x1<=x&&(j=newIndex[i1]+(iterable?n0old:n0),iterable?groupIndex[j]?groupIndex[j].push(k):groupIndex[j]=[k]:groupIndex[j]=k,g.value=add(g.value,data[j],!0),filters.zeroExcept(j,offset,zero)||(g.value=remove(g.value,data[j],!1)),!(++i1>=n1));)x1=key(newValues[i1]);groupIncrement()}for(;i0<k0;)groups[reIndex[i0]=k]=oldGroups[i0++],groupIncrement();if(iterable)for(var index1=0;index1<n;index1++)groupIndex[index1]||(groupIndex[index1]=[]);if(k>i0)if(iterable)for(i0=0;i0<n0old;++i0)for(index1=0;index1<groupIndex[i0].length;index1++)groupIndex[i0][index1]=reIndex[groupIndex[i0][index1]];else for(i0=0;i0<n0;++i0)groupIndex[i0]=reIndex[groupIndex[i0]];function groupIncrement(){iterable?k++:++k===groupCapacity&&(reIndex=xfilterArray.arrayWiden(reIndex,groupWidth<<=1),groupIndex=xfilterArray.arrayWiden(groupIndex,groupWidth),groupCapacity=capacity(groupWidth))}j=filterListeners.indexOf(update),k>1||iterable?(update=updateMany,reset=resetMany):(!k&&groupAll&&(k=1,groups=[{key:null,value:initial()}]),1===k?(update=updateOne,reset=resetOne):(update=cr_null,reset=cr_null),groupIndex=null),filterListeners[j]=update}function removeData(reIndex){if(k>1||iterable){var oldK=k,oldGroups=groups,seenGroups=cr_index(oldK,oldK),i,i0,j;if(iterable){for(i=0,j=0;i<n;++i)if(-1!==reIndex[i]){for(groupIndex[j]=groupIndex[i],i0=0;i0<groupIndex[j].length;i0++)seenGroups[groupIndex[j][i0]]=1;++j}groupIndex=groupIndex.slice(0,j)}else for(i=0,j=0;i<n;++i)-1!==reIndex[i]&&(seenGroups[groupIndex[j]=groupIndex[i]]=1,++j);for(groups=[],k=0,i=0;i<oldK;++i)seenGroups[i]&&(seenGroups[i]=k++,groups.push(oldGroups[i]));if(k>1||iterable)if(iterable)for(i=0;i<j;++i)for(i0=0;i0<groupIndex[i].length;++i0)groupIndex[i][i0]=seenGroups[groupIndex[i][i0]];else for(i=0;i<j;++i)groupIndex[i]=seenGroups[groupIndex[i]];else groupIndex=null;filterListeners[filterListeners.indexOf(update)]=k>1||iterable?(reset=resetMany,update=updateMany):1===k?(reset=resetOne,update=updateOne):reset=update=cr_null}else if(1===k){if(groupAll)return;for(var index3=0;index3<n;++index3)if(-1!==reIndex[index3])return;groups=[],k=0,filterListeners[filterListeners.indexOf(update)]=update=reset=cr_null}}function updateMany(filterOne,filterOffset,added,removed,notFilter){var i,j,k,n,g;if(!(filterOne===one&&filterOffset===offset||resetNeeded))if(iterable){for(i=0,n=added.length;i<n;++i)if(filters.zeroExcept(k=added[i],offset,zero))for(j=0;j<groupIndex[k].length;j++)(g=groups[groupIndex[k][j]]).value=reduceAdd(g.value,data[k],!1,j);for(i=0,n=removed.length;i<n;++i)if(filters.onlyExcept(k=removed[i],offset,zero,filterOffset,filterOne))for(j=0;j<groupIndex[k].length;j++)(g=groups[groupIndex[k][j]]).value=reduceRemove(g.value,data[k],notFilter,j)}else{for(i=0,n=added.length;i<n;++i)filters.zeroExcept(k=added[i],offset,zero)&&((g=groups[groupIndex[k]]).value=reduceAdd(g.value,data[k],!1));for(i=0,n=removed.length;i<n;++i)filters.onlyExcept(k=removed[i],offset,zero,filterOffset,filterOne)&&((g=groups[groupIndex[k]]).value=reduceRemove(g.value,data[k],notFilter))}}function updateOne(filterOne,filterOffset,added,removed,notFilter){if(!(filterOne===one&&filterOffset===offset||resetNeeded)){var i,k,n,g=groups[0];for(i=0,n=added.length;i<n;++i)filters.zeroExcept(k=added[i],offset,zero)&&(g.value=reduceAdd(g.value,data[k],!1));for(i=0,n=removed.length;i<n;++i)filters.onlyExcept(k=removed[i],offset,zero,filterOffset,filterOne)&&(g.value=reduceRemove(g.value,data[k],notFilter))}}function resetMany(){var i,j,g;for(i=0;i<k;++i)groups[i].value=reduceInitial();if(iterable){for(i=0;i<n;++i)for(j=0;j<groupIndex[i].length;j++)(g=groups[groupIndex[i][j]]).value=reduceAdd(g.value,data[i],!0,j);for(i=0;i<n;++i)if(!filters.zeroExcept(i,offset,zero))for(j=0;j<groupIndex[i].length;j++)(g=groups[groupIndex[i][j]]).value=reduceRemove(g.value,data[i],!1,j)}else{for(i=0;i<n;++i)(g=groups[groupIndex[i]]).value=reduceAdd(g.value,data[i],!0);for(i=0;i<n;++i)filters.zeroExcept(i,offset,zero)||((g=groups[groupIndex[i]]).value=reduceRemove(g.value,data[i],!1))}}function resetOne(){var i,g=groups[0];for(g.value=reduceInitial(),i=0;i<n;++i)g.value=reduceAdd(g.value,data[i],!0);for(i=0;i<n;++i)filters.zeroExcept(i,offset,zero)||(g.value=reduceRemove(g.value,data[i],!1))}function all(){return resetNeeded&&(reset(),resetNeeded=!1),groups}function top(k){var top=select(all(),0,groups.length,k);return heap.sort(top,0,top.length)}function reduce(add,remove,initial){return reduceAdd=add,reduceRemove=remove,reduceInitial=initial,resetNeeded=!0,group}function reduceCount(){return reduce(xfilterReduce_reduceIncrement,xfilterReduce_reduceDecrement,cr_zero)}function reduceSum(value){return reduce(xfilterReduce_reduceAdd(value),xfilterReduce_reduceSubtract(value),cr_zero)}function order(value){function valueOf(d){return value(d.value)}return select=h$1.by(valueOf),heap=h.by(valueOf),group}function orderNatural(){return order(cr_identity)}function size(){return k}function dispose(){var i=filterListeners.indexOf(update);return i>=0&&filterListeners.splice(i,1),(i=indexListeners.indexOf(add))>=0&&indexListeners.splice(i,1),(i=removeDataListeners.indexOf(removeData))>=0&&removeDataListeners.splice(i,1),(i=dimensionGroups.indexOf(group))>=0&&dimensionGroups.splice(i,1),group}return arguments.length<1&&(key=cr_identity),filterListeners.push(update),indexListeners.push(add),removeDataListeners.push(removeData),add(values,index,0,n),reduceCount().orderNatural()}function groupAll(){var g=group(cr_null),all=g.all;return delete g.all,delete g.top,delete g.order,delete g.orderNatural,delete g.size,g.value=function(){return all()[0].value},g}function dispose(){dimensionGroups.forEach((function(group){group.dispose()}));var i=dataListeners.indexOf(preAdd);return i>=0&&dataListeners.splice(i,1),(i=dataListeners.indexOf(postAdd))>=0&&dataListeners.splice(i,1),(i=removeDataListeners.indexOf(removeData))>=0&&removeDataListeners.splice(i,1),filters.masks[offset]&=zero,filterAll()}return offset=tmp.offset,one=tmp.one,zero=~one,id=offset<<7|Math.log(one)/Math.log(2),preAdd(data,0,n),postAdd(data,0,n),dimension}function groupAll(){var group={reduce:reduce,reduceCount:reduceCount,reduceSum:reduceSum,value:value,dispose:dispose,remove:dispose},reduceValue,reduceAdd,reduceRemove,reduceInitial,resetNeeded=!0;function add(newData,n0){var i;if(!resetNeeded)for(i=n0;i<n;++i)reduceValue=reduceAdd(reduceValue,data[i],!0),filters.zero(i)||(reduceValue=reduceRemove(reduceValue,data[i],!1))}function update(filterOne,filterOffset,added,removed,notFilter){var i,k,n;if(!resetNeeded){for(i=0,n=added.length;i<n;++i)filters.zero(k=added[i])&&(reduceValue=reduceAdd(reduceValue,data[k],notFilter));for(i=0,n=removed.length;i<n;++i)filters.only(k=removed[i],filterOffset,filterOne)&&(reduceValue=reduceRemove(reduceValue,data[k],notFilter))}}function reset(){var i;for(reduceValue=reduceInitial(),i=0;i<n;++i)reduceValue=reduceAdd(reduceValue,data[i],!0),filters.zero(i)||(reduceValue=reduceRemove(reduceValue,data[i],!1))}function reduce(add,remove,initial){return reduceAdd=add,reduceRemove=remove,reduceInitial=initial,resetNeeded=!0,group}function reduceCount(){return reduce(xfilterReduce_reduceIncrement,xfilterReduce_reduceDecrement,cr_zero)}function reduceSum(value){return reduce(xfilterReduce_reduceAdd(value),xfilterReduce_reduceSubtract(value),cr_zero)}function value(){return resetNeeded&&(reset(),resetNeeded=!1),reduceValue}function dispose(){var i=filterListeners.indexOf(update);return i>=0&&filterListeners.splice(i,1),(i=dataListeners.indexOf(add))>=0&&dataListeners.splice(i,1),group}return(filterListeners.push(update),dataListeners.push(add),add(data,0),reduceCount())}function size(){return n}function all(){return data}function allFiltered(ignore_dimensions){var array=[],i=0,mask=maskForDimensions(ignore_dimensions||[]);for(i=0;i<n;i++)filters.zeroExceptMask(i,mask)&&array.push(data[i]);return array}function onChange(cb){if("function"==typeof cb)return callbacks.push(cb),function(){callbacks.splice(callbacks.indexOf(cb),1)};console.warn("onChange callback parameter must be a function!")}function triggerOnChange(eventName){for(var i=0;i<callbacks.length;i++)callbacks[i](eventName)}return filters=new xfilterArray.bitarray(0),arguments.length?add(arguments[0]):crossfilter}function cr_index(n,m){return(m<257?xfilterArray.array8:m<65537?xfilterArray.array16:xfilterArray.array32)(n)}function cr_range(n){for(var range=cr_index(n,n),i=-1;++i<n;)range[i]=i;return range}function capacity(w){return 8===w?256:16===w?65536:4294967296}crossfilter.heap=h,crossfilter.heapselect=h$1,crossfilter.bisect=bisect,crossfilter.permute=permute;var version="1.5.4";return crossfilter.version="1.5.4",crossfilter}));