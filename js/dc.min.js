/*!
 *  dc 4.2.7
 *  http://dc-js.github.io/dc.js/
 *  Copyright 2012-2021 Nick Zhu & the dc.js Developers
 *  https://github.com/dc-js/dc.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3")):"function"==typeof define&&define.amd?define(["exports","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3"],factory):factory((global=global||self).dc={},global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3)}(this,(function(exports,d3TimeFormat,d3Time,d3Format,d3Selection,d3Dispatch,d3Array,d3Scale,d3Interpolate,d3ScaleChromatic,d3Axis,d3Zoom,d3Brush,d3Timer,d3Shape,d3Geo,d3Ease,d3Hierarchy,d3,d3Collection){"use strict";const version="4.2.7";class BadArgumentException extends Error{}const constants={CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10};class Logger{constructor(){this.enableDebugLog=!1,this._alreadyWarned={}}warn(msg){return console&&(console.warn?console.warn(msg):console.log&&console.log(msg)),this}warnOnce(msg){return this._alreadyWarned[msg]||(this._alreadyWarned[msg]=!0,logger.warn(msg)),this}debug(msg){return this.enableDebugLog&&console&&(console.debug?console.debug(msg):console.log&&console.log(msg)),this}}const logger=new Logger;class Config{constructor(){this._defaultColors=Config._schemeCategory20c,this.dateFormat=d3TimeFormat.timeFormat("%m/%d/%Y"),this._renderlet=null,this.disableTransitions=!1}defaultColors(colors){return arguments.length?(this._defaultColors=colors,this):(this._defaultColors===Config._schemeCategory20c&&logger.warnOnce("You are using d3.schemeCategory20c, which has been removed in D3v5. See the explanation at https://github.com/d3/d3/blob/master/CHANGES.md#changes-in-d3-50. DC is using it for backward compatibility, however it will be changed in DCv3.1. You can change it by calling dc.config.defaultColors(newScheme). See https://github.com/d3/d3-scale-chromatic for some alternatives."),this._defaultColors)}}Config._schemeCategory20c=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];const config=new Config,d3compat={eventHandler:handler=>function eventHandler(a,b){console.warn("No d3.js compatbility event handler registered, defaulting to v6 behavior."),handler.call(this,b,a)},nester:({key:key,sortKeys:sortKeys,sortValues:sortValues,entries:entries})=>{throw new Error("No d3.js compatbility nester registered, load v5 or v6 compability layer.")},pointer:()=>{throw new Error("No d3.js compatbility pointer registered, load v5 or v6 compability layer.")}};class ChartRegistry{constructor(){this._chartMap={}}_initializeChartGroup(group){return group||(group=constants.DEFAULT_CHART_GROUP),this._chartMap[group]||(this._chartMap[group]=[]),group}has(chart){for(const e in this._chartMap)if(this._chartMap[e].indexOf(chart)>=0)return!0;return!1}register(chart,group){const _chartMap=this._chartMap;_chartMap[group=this._initializeChartGroup(group)].push(chart)}deregister(chart,group){group=this._initializeChartGroup(group);for(let i=0;i<this._chartMap[group].length;i++)if(this._chartMap[group][i].anchorName()===chart.anchorName()){this._chartMap[group].splice(i,1);break}}clear(group){group?delete this._chartMap[group]:this._chartMap={}}list(group){return group=this._initializeChartGroup(group),this._chartMap[group]}}const chartRegistry=new ChartRegistry,registerChart=function(chart,group){chartRegistry.register(chart,group)},deregisterChart=function(chart,group){chartRegistry.deregister(chart,group)},hasChart=function(chart){return chartRegistry.has(chart)},deregisterAllCharts=function(group){chartRegistry.clear(group)},filterAll=function(group){const charts=chartRegistry.list(group);for(let i=0;i<charts.length;++i)charts[i].filterAll()},refocusAll=function(group){const charts=chartRegistry.list(group);for(let i=0;i<charts.length;++i)charts[i].focus&&charts[i].focus()},renderAll=function(group){const charts=chartRegistry.list(group);for(let i=0;i<charts.length;++i)charts[i].render();null!==config._renderlet&&config._renderlet(group)},redrawAll=function(group){const charts=chartRegistry.list(group);for(let i=0;i<charts.length;++i)charts[i].redraw();null!==config._renderlet&&config._renderlet(group)},transition=function(selection,duration,delay,name){if(config.disableTransitions||duration<=0)return selection;let s=selection.transition(name);return(duration>=0||void 0!==duration)&&(s=s.duration(duration)),(delay>=0||void 0!==delay)&&(s=s.delay(delay)),s},optionalTransition=function(enable,duration,delay,name){return enable?function(selection){return transition(selection,duration,delay,name)}:function(selection){return selection}},afterTransition=function(_transition,callback){if(_transition.empty()||!_transition.duration)callback.call(_transition);else{let n=0;_transition.each(()=>{++n}).on("end",()=>{--n||callback.call(_transition)})}},renderlet=function(_){return arguments.length?(config._renderlet=_,null):config._renderlet},instanceOfChart=function(o){return o instanceof Object&&o.__dcFlag__&&!0},events={current:null,trigger:function(closure,delay){delay?(events.current=closure,setTimeout(()=>{closure===events.current&&closure()},delay)):closure()}},filters={RangedFilter:function(low,high){const range=new Array(low,high);return range.isFiltered=function(value){return value>=this[0]&&value<this[1]},range.filterType="RangedFilter",range},TwoDimensionalFilter:function(filter){if(null===filter)return null;const f=filter;return f.isFiltered=function(value){return value.length&&value.length===f.length&&value[0]===f[0]&&value[1]===f[1]},f.filterType="TwoDimensionalFilter",f},RangedTwoDimensionalFilter:function(filter){if(null===filter)return null;const f=filter;let fromBottomLeft;return fromBottomLeft=f[0]instanceof Array?[[Math.min(filter[0][0],filter[1][0]),Math.min(filter[0][1],filter[1][1])],[Math.max(filter[0][0],filter[1][0]),Math.max(filter[0][1],filter[1][1])]]:[[filter[0],-1/0],[filter[1],1/0]],f.isFiltered=function(value){let x,y;return value instanceof Array?(x=value[0],y=value[1]):(x=value,y=fromBottomLeft[0][1]),x>=fromBottomLeft[0][0]&&x<fromBottomLeft[1][0]&&y>=fromBottomLeft[0][1]&&y<fromBottomLeft[1][1]},f.filterType="RangedTwoDimensionalFilter",f},HierarchyFilter:function(path){if(null===path)return null;const filter=path.slice(0);return filter.isFiltered=function(value){if(!(filter.length&&value&&value.length&&value.length>=filter.length))return!1;for(let i=0;i<filter.length;i++)if(value[i]!==filter[i])return!1;return!0},filter}};class InvalidStateException extends Error{}const pluck=function(n,f){return f?function(d,i){return f.call(d,d[n],i)}:function(d){return d[n]}},utils={printSingleValue:function(filter){let s=`${filter}`;return filter instanceof Date?s=config.dateFormat(filter):"string"==typeof filter?s=filter:utils.isFloat(filter)?s=utils.printSingleValue.fformat(filter):utils.isInteger(filter)&&(s=Math.round(filter)),s}};utils.printSingleValue.fformat=d3Format.format(".2f"),utils._toTimeFunc=function(t){const mappings={second:d3Time.timeSecond,minute:d3Time.timeMinute,hour:d3Time.timeHour,day:d3Time.timeDay,week:d3Time.timeWeek,month:d3Time.timeMonth,year:d3Time.timeYear};return mappings[t]},utils.add=function(l,r,t){if("string"==typeof r&&(r=r.replace("%","")),l instanceof Date)return"string"==typeof r&&(r=+r),"millis"===t?new Date(l.getTime()+r):("function"!=typeof(t=t||d3Time.timeDay)&&(t=utils._toTimeFunc(t)),t.offset(l,r));if("string"==typeof r){const percentage=+r/100;return l>0?l*(1+percentage):l*(1-percentage)}return l+r},utils.subtract=function(l,r,t){if("string"==typeof r&&(r=r.replace("%","")),l instanceof Date)return"string"==typeof r&&(r=+r),"millis"===t?new Date(l.getTime()-r):("function"!=typeof(t=t||d3Time.timeDay)&&(t=utils._toTimeFunc(t)),t.offset(l,-r));if("string"==typeof r){const percentage=+r/100;return l<0?l*(1+percentage):l*(1-percentage)}return l-r},utils.isNumber=function(n){return n===+n},utils.isFloat=function(n){return n===+n&&n!==(0|n)},utils.isInteger=function(n){return n===+n&&n===(0|n)},utils.isNegligible=function(n){return!utils.isNumber(n)||n<constants.NEGLIGIBLE_NUMBER&&n>-constants.NEGLIGIBLE_NUMBER},utils.clamp=function(val,min,max){return val<min?min:val>max?max:val},utils.constant=function(x){return function(){return x}};let _idCounter=0;function findChild(children,nodeName){for(let k=0;k<children.length;k++)if(children[k].key===nodeName)return children[k]}utils.uniqueId=function(){return++_idCounter},utils.nameToId=function(name){return name.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},utils.appendOrSelect=function(parent,selector,tag){tag=tag||selector;let element=parent.select(selector);return element.empty()&&(element=parent.append(tag)),element},utils.safeNumber=function(n){return utils.isNumber(+n)?+n:0},utils.arraysEqual=function(a1,a2){return!a1&&!a2||!(!a1||!a2)&&(a1.length===a2.length&&a1.every((elem,i)=>elem.valueOf()===a2[i].valueOf()))},utils.allChildren=function(node){let paths=[];if(paths.push(node.path),console.log("currentNode",node),node.children)for(let i=0;i<node.children.length;i++)paths=paths.concat(utils.allChildren(node.children[i]));return paths},utils.toHierarchy=function(list,accessor){const root={key:"root",children:[]};for(let i=0;i<list.length;i++){const data=list[i],parts=data.key,value=accessor(data);let currentNode=root;for(let j=0;j<parts.length;j++){const currentPath=parts.slice(0,j+1),children=currentNode.children,nodeName=parts[j];let childNode;j+1<parts.length?(childNode=findChild(children,nodeName),void 0===childNode&&(childNode={key:nodeName,children:[],path:currentPath},children.push(childNode)),currentNode=childNode):(childNode={key:nodeName,value:value,data:data,path:currentPath},children.push(childNode))}}return root},utils.getAncestors=function(node){const path=[];let current=node;for(;current.parent;)path.unshift(current.name),current=current.parent;return path},utils.arraysIdentical=function(a,b){let i=a.length;if(i!==b.length)return!1;for(;i--;)if(a[i]!==b[i])return!1;return!0};const printers={filters:function(filters){let s="";for(let i=0;i<filters.length;++i)i>0&&(s+=", "),s+=printers.filter(filters[i]);return s},filter:function(filter){let s="";return null!=filter&&(filter instanceof Array?filter.length>=2?s=`[${filter.map(e=>utils.printSingleValue(e)).join(" -> ")}]`:filter.length>=1&&(s=utils.printSingleValue(filter[0])):s=utils.printSingleValue(filter)),s}},units={integers:function(start,end){return Math.abs(end-start)},ordinal:function(){throw new Error("dc.units.ordinal should not be called - it is a placeholder")},fp:{}};units.fp.precision=function(precision){const _f=function(s,e){const d=Math.abs((e-s)/_f.resolution);return utils.isNegligible(d-Math.floor(d))?Math.floor(d):Math.ceil(d)};return _f.resolution=precision,_f};const _defaultFilterHandler=(dimension,filters)=>(0===filters.length?dimension.filter(null):1!==filters.length||filters[0].isFiltered?1===filters.length&&"RangedFilter"===filters[0].filterType?dimension.filterRange(filters[0]):dimension.filterFunction(d=>{for(let i=0;i<filters.length;i++){const filter=filters[i];if(filter.isFiltered){if(filter.isFiltered(d))return!0}else if(filter<=d&&filter>=d)return!0}return!1}):dimension.filterExact(filters[0]),filters),_defaultHasFilterHandler=(filters,filter)=>null==filter?filters.length>0:filters.some(f=>filter<=f&&filter>=f),_defaultRemoveFilterHandler=(filters,filter)=>{for(let i=0;i<filters.length;i++)if(filters[i]<=filter&&filters[i]>=filter){filters.splice(i,1);break}return filters},_defaultAddFilterHandler=(filters,filter)=>(filters.push(filter),filters),_defaultResetFilterHandler=filters=>[];class BaseMixin{constructor(){this.__dcFlag__=utils.uniqueId(),this._svgDescription=null,this._keyboardAccessible=!1,this._dimension=void 0,this._group=void 0,this._anchor=void 0,this._root=void 0,this._svg=void 0,this._isChild=void 0,this._minWidth=200,this._defaultWidthCalc=element=>{const width=element&&element.getBoundingClientRect&&element.getBoundingClientRect().width;return width&&width>this._minWidth?width:this._minWidth},this._widthCalc=this._defaultWidthCalc,this._minHeight=200,this._defaultHeightCalc=element=>{const height=element&&element.getBoundingClientRect&&element.getBoundingClientRect().height;return height&&height>this._minHeight?height:this._minHeight},this._heightCalc=this._defaultHeightCalc,this._width=void 0,this._height=void 0,this._useViewBoxResizing=!1,this._keyAccessor=pluck("key"),this._valueAccessor=pluck("value"),this._label=pluck("key"),this._ordering=pluck("key"),this._renderLabel=!1,this._title=d=>`${this.keyAccessor()(d)}: ${this.valueAccessor()(d)}`,this._renderTitle=!0,this._controlsUseVisibility=!1,this._transitionDuration=750,this._transitionDelay=0,this._filterPrinter=printers.filters,this._mandatoryAttributesList=["dimension","group"],this._chartGroup=constants.DEFAULT_CHART_GROUP,this._listeners=d3Dispatch.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition"),this._legend=void 0,this._commitHandler=void 0,this._defaultData=group=>group.all(),this._data=this._defaultData,this._filters=[],this._filterHandler=_defaultFilterHandler,this._hasFilterHandler=_defaultHasFilterHandler,this._removeFilterHandler=_defaultRemoveFilterHandler,this._addFilterHandler=_defaultAddFilterHandler,this._resetFilterHandler=_defaultResetFilterHandler}height(height){return arguments.length?(this._heightCalc=height?"function"==typeof height?height:utils.constant(height):this._defaultHeightCalc,this._height=void 0,this):(utils.isNumber(this._height)||(this._height=this._heightCalc(this._root.node())),this._height)}width(width){return arguments.length?(this._widthCalc=width?"function"==typeof width?width:utils.constant(width):this._defaultWidthCalc,this._width=void 0,this):(utils.isNumber(this._width)||(this._width=this._widthCalc(this._root.node())),this._width)}minWidth(minWidth){return arguments.length?(this._minWidth=minWidth,this):this._minWidth}minHeight(minHeight){return arguments.length?(this._minHeight=minHeight,this):this._minHeight}useViewBoxResizing(useViewBoxResizing){return arguments.length?(this._useViewBoxResizing=useViewBoxResizing,this):this._useViewBoxResizing}dimension(dimension){return arguments.length?(this._dimension=dimension,this.expireCache(),this):this._dimension}data(callback){return arguments.length?(this._data="function"==typeof callback?callback:utils.constant(callback),this.expireCache(),this):this._data(this._group)}group(group,name){return arguments.length?(this._group=group,this._groupName=name,this.expireCache(),this):this._group}ordering(orderFunction){return arguments.length?(this._ordering=orderFunction,this.expireCache(),this):this._ordering}_computeOrderedGroups(data){return Array.from(data).sort((a,b)=>d3Array.ascending(this._ordering(a),this._ordering(b)))}filterAll(){return this.filter(null)}select(sel){return this._root.select(sel)}selectAll(sel){return this._root?this._root.selectAll(sel):null}anchor(parent,chartGroup){if(!arguments.length)return this._anchor;if(instanceOfChart(parent))this._anchor=parent.anchor(),this._anchor.children&&(this._anchor=`#${parent.anchorName()}`),this._root=parent.root(),this._isChild=!0;else{if(!parent)throw new BadArgumentException("parent must be defined");parent.select&&parent.classed?this._anchor=parent.node():this._anchor=parent,this._root=d3Selection.select(this._anchor),this._root.classed(constants.CHART_CLASS,!0),registerChart(this,chartGroup),this._isChild=!1}return this._chartGroup=chartGroup,this}anchorName(){const a=this.anchor();return a&&a.id?a.id:a&&a.replace?a.replace("#",""):`dc-chart${this.chartID()}`}root(rootElement){return arguments.length?(this._root=rootElement,this):this._root}svg(svgElement){return arguments.length?(this._svg=svgElement,this):this._svg}resetSvg(){return this.select("svg").remove(),this.generateSvg()}sizeSvg(){this._svg&&(this._useViewBoxResizing?this._svg.attr("viewBox")||this._svg.attr("viewBox",`0 0 ${this.width()} ${this.height()}`):this._svg.attr("width",this.width()).attr("height",this.height()))}generateSvg(){return this._svg=this.root().append("svg"),(this._svgDescription||this._keyboardAccessible)&&(this._svg.append("desc").attr("id",`desc-id-${this.__dcFlag__}`).html(`${this.svgDescription()}`),this._svg.attr("tabindex","0").attr("role","img").attr("aria-labelledby",`desc-id-${this.__dcFlag__}`)),this.sizeSvg(),this._svg}svgDescription(description){return arguments.length?(this._svgDescription=description,this):this._svgDescription||this.constructor.name}keyboardAccessible(keyboardAccessible){return arguments.length?(this._keyboardAccessible=keyboardAccessible,this):this._keyboardAccessible}filterPrinter(filterPrinterFunction){return arguments.length?(this._filterPrinter=filterPrinterFunction,this):this._filterPrinter}controlsUseVisibility(controlsUseVisibility){return arguments.length?(this._controlsUseVisibility=controlsUseVisibility,this):this._controlsUseVisibility}turnOnControls(){if(this._root){const attribute=this.controlsUseVisibility()?"visibility":"display";this.selectAll(".reset").style(attribute,null),this.selectAll(".filter").text(this._filterPrinter(this.filters())).style(attribute,null)}return this}turnOffControls(){if(this._root){const attribute=this.controlsUseVisibility()?"visibility":"display",value=this.controlsUseVisibility()?"hidden":"none";this.selectAll(".reset").style(attribute,value),this.selectAll(".filter").style(attribute,value).text(this.filter())}return this}transitionDuration(duration){return arguments.length?(this._transitionDuration=duration,this):this._transitionDuration}transitionDelay(delay){return arguments.length?(this._transitionDelay=delay,this):this._transitionDelay}_mandatoryAttributes(_){return arguments.length?(this._mandatoryAttributesList=_,this):this._mandatoryAttributesList}checkForMandatoryAttributes(a){if(!this[a]||!this[a]())throw new InvalidStateException(`Mandatory attribute chart.${a} is missing on chart[#${this.anchorName()}]`)}render(){this._height=this._width=void 0,this._listeners.call("preRender",this,this),this._mandatoryAttributesList&&this._mandatoryAttributesList.forEach(e=>this.checkForMandatoryAttributes(e));const result=this._doRender();return this._legend&&this._legend.render(),this._activateRenderlets("postRender"),result}_makeKeyboardAccessible(onClickFunction,...onClickArgs){const tabElements=this._svg.selectAll(".dc-tabbable").attr("tabindex",0);onClickFunction&&tabElements.on("keydown",d3compat.eventHandler((d,event)=>{13===event.keyCode&&"object"==typeof d&&onClickFunction.call(this,d,...onClickArgs),32===event.keyCode&&"object"==typeof d&&(onClickFunction.call(this,d,...onClickArgs),event.preventDefault())}))}_activateRenderlets(event){this._listeners.call("pretransition",this,this),this.transitionDuration()>0&&this._svg?this._svg.transition().duration(this.transitionDuration()).delay(this.transitionDelay()).on("end",()=>{this._listeners.call("renderlet",this,this),event&&this._listeners.call(event,this,this)}):(this._listeners.call("renderlet",this,this),event&&this._listeners.call(event,this,this))}redraw(){this.sizeSvg(),this._listeners.call("preRedraw",this,this);const result=this._doRedraw();return this._legend&&this._legend.render(),this._activateRenderlets("postRedraw"),result}commitHandler(commitHandler){return arguments.length?(this._commitHandler=commitHandler,this):this._commitHandler}redrawGroup(){return this._commitHandler?this._commitHandler(!1,(error,result)=>{error?console.log(error):redrawAll(this.chartGroup())}):redrawAll(this.chartGroup()),this}renderGroup(){return this._commitHandler?this._commitHandler(!1,(error,result)=>{error?console.log(error):renderAll(this.chartGroup())}):renderAll(this.chartGroup()),this}_invokeFilteredListener(f){void 0!==f&&this._listeners.call("filtered",this,this,f)}_invokeZoomedListener(){this._listeners.call("zoomed",this,this)}hasFilterHandler(hasFilterHandler){return arguments.length?(this._hasFilterHandler=hasFilterHandler,this):this._hasFilterHandler}hasFilter(filter){return this._hasFilterHandler(this._filters,filter)}removeFilterHandler(removeFilterHandler){return arguments.length?(this._removeFilterHandler=removeFilterHandler,this):this._removeFilterHandler}addFilterHandler(addFilterHandler){return arguments.length?(this._addFilterHandler=addFilterHandler,this):this._addFilterHandler}resetFilterHandler(resetFilterHandler){return arguments.length?(this._resetFilterHandler=resetFilterHandler,this):this._resetFilterHandler}applyFilters(filters){if(this.dimension()&&this.dimension().filter){const fs=this._filterHandler(this.dimension(),filters);fs&&(filters=fs)}return filters}replaceFilter(filter){return this._filters=this._resetFilterHandler(this._filters),this.filter(filter),this}filter(filter){if(!arguments.length)return this._filters.length>0?this._filters[0]:null;let filters=this._filters;return filter instanceof Array&&filter[0]instanceof Array&&!filter.isFiltered?filter[0].forEach(f=>{filters=this._hasFilterHandler(filters,f)?this._removeFilterHandler(filters,f):this._addFilterHandler(filters,f)}):filters=null===filter?this._resetFilterHandler(filters):this._hasFilterHandler(filters,filter)?this._removeFilterHandler(filters,filter):this._addFilterHandler(filters,filter),this._filters=this.applyFilters(filters),this._invokeFilteredListener(filter),null!==this._root&&this.hasFilter()?this.turnOnControls():this.turnOffControls(),this}filters(){return this._filters}highlightSelected(e){d3Selection.select(e).classed(constants.SELECTED_CLASS,!0),d3Selection.select(e).classed(constants.DESELECTED_CLASS,!1)}fadeDeselected(e){d3Selection.select(e).classed(constants.SELECTED_CLASS,!1),d3Selection.select(e).classed(constants.DESELECTED_CLASS,!0)}resetHighlight(e){d3Selection.select(e).classed(constants.SELECTED_CLASS,!1),d3Selection.select(e).classed(constants.DESELECTED_CLASS,!1)}onClick(datum){const filter=this.keyAccessor()(datum);events.trigger(()=>{this.filter(filter),this.redrawGroup()})}filterHandler(filterHandler){return arguments.length?(this._filterHandler=filterHandler,this):this._filterHandler}_doRender(){return this}_doRedraw(){return this}legendables(){return[]}legendHighlight(){}legendReset(){}legendToggle(){}isLegendableHidden(){return!1}keyAccessor(keyAccessor){return arguments.length?(this._keyAccessor=keyAccessor,this):this._keyAccessor}valueAccessor(valueAccessor){return arguments.length?(this._valueAccessor=valueAccessor,this):this._valueAccessor}label(labelFunction,enableLabels){return arguments.length?(this._label=labelFunction,(void 0===enableLabels||enableLabels)&&(this._renderLabel=!0),this):this._label}renderLabel(renderLabel){return arguments.length?(this._renderLabel=renderLabel,this):this._renderLabel}title(titleFunction){return arguments.length?(this._title=titleFunction,this):this._title}renderTitle(renderTitle){return arguments.length?(this._renderTitle=renderTitle,this):this._renderTitle}chartGroup(chartGroup){return arguments.length?(this._isChild||deregisterChart(this,this._chartGroup),this._chartGroup=chartGroup,this._isChild||registerChart(this,this._chartGroup),this):this._chartGroup}expireCache(){return this}legend(legend){return arguments.length?(this._legend=legend,this._legend.parent(this),this):this._legend}chartID(){return this.__dcFlag__}options(opts){const applyOptions=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(const o in opts)"function"==typeof this[o]?opts[o]instanceof Array&&-1!==applyOptions.indexOf(o)?this[o].apply(this,opts[o]):this[o].call(this,opts[o]):logger.debug(`Not a valid option setter name: ${o}`);return this}on(event,listener){return this._listeners.on(event,listener),this}renderlet(renderletFunction){return logger.warnOnce('chart.renderlet has been deprecated. Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),this.on(`renderlet.${utils.uniqueId()}`,renderletFunction),this}}const baseMixin=()=>new BaseMixin,ColorMixin=Base=>class extends Base{constructor(){super(),this._colors=d3Scale.scaleOrdinal(config.defaultColors()),this._colorAccessor=d=>this.keyAccessor()(d),this._colorCalculator=void 0;{const chart=this;chart.getColor=function(d,i){return chart._colorCalculator?chart._colorCalculator.call(this,d,i):chart._colors(chart._colorAccessor.call(this,d,i))}}}calculateColorDomain(){const newDomain=[d3Array.min(this.data(),this.colorAccessor()),d3Array.max(this.data(),this.colorAccessor())];return this._colors.domain(newDomain),this}colors(colorScale){return arguments.length?(this._colors=colorScale instanceof Array?d3Scale.scaleQuantize().range(colorScale):"function"==typeof colorScale?colorScale:utils.constant(colorScale),this):this._colors}ordinalColors(r){return this.colors(d3Scale.scaleOrdinal().range(r))}linearColors(r){return this.colors(d3Scale.scaleLinear().range(r).interpolate(d3Interpolate.interpolateHcl))}colorAccessor(colorAccessor){return arguments.length?(this._colorAccessor=colorAccessor,this):this._colorAccessor}colorDomain(domain){return arguments.length?(this._colors.domain(domain),this):this._colors.domain()}colorCalculator(colorCalculator){return arguments.length?(this._colorCalculator=colorCalculator,this):this._colorCalculator||this.getColor}},BubbleMixin=Base=>class extends(ColorMixin(Base)){constructor(){super(),this._maxBubbleRelativeSize=.3,this._minRadiusWithLabel=10,this._sortBubbleSize=!1,this._elasticRadius=!1,this._excludeElasticZero=!0,this.BUBBLE_NODE_CLASS="node",this.BUBBLE_CLASS="bubble",this.MIN_RADIUS=10,this.renderLabel(!0),this.data(group=>{const data=group.all();if(this._keyboardAccessible&&data.sort((a,b)=>d3Array.ascending(this.keyAccessor()(a),this.keyAccessor()(b))),this._sortBubbleSize){const radiusAccessor=this.radiusValueAccessor();data.sort((a,b)=>d3Array.descending(radiusAccessor(a),radiusAccessor(b)))}return data}),this._r=d3Scale.scaleLinear().domain([0,100])}_rValueAccessor(d){return d.r}r(bubbleRadiusScale){return arguments.length?(this._r=bubbleRadiusScale,this):this._r}elasticRadius(elasticRadius){return arguments.length?(this._elasticRadius=elasticRadius,this):this._elasticRadius}calculateRadiusDomain(){this._elasticRadius&&this.r().domain([this.rMin(),this.rMax()])}radiusValueAccessor(radiusValueAccessor){return arguments.length?(this._rValueAccessor=radiusValueAccessor,this):this._rValueAccessor}rMin(){let values=this.data().map(this.radiusValueAccessor());return this._excludeElasticZero&&(values=values.filter(value=>value>0)),d3Array.min(values)}rMax(){return d3Array.max(this.data(),e=>this.radiusValueAccessor()(e))}bubbleR(d){const value=this.radiusValueAccessor()(d);let r=this.r()(value);return(isNaN(r)||value<=0)&&(r=0),r}_labelFunction(d){return this.label()(d)}_shouldLabel(d){return this.bubbleR(d)>this._minRadiusWithLabel}_labelOpacity(d){return this._shouldLabel(d)?1:0}_labelPointerEvent(d){return this._shouldLabel(d)?"all":"none"}_doRenderLabel(bubbleGEnter){if(this.renderLabel()){let label=bubbleGEnter.select("text");label.empty()&&(label=bubbleGEnter.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",d3compat.eventHandler(d=>this.onClick(d)))),label.attr("opacity",0).attr("pointer-events",d=>this._labelPointerEvent(d)).text(d=>this._labelFunction(d)),transition(label,this.transitionDuration(),this.transitionDelay()).attr("opacity",d=>this._labelOpacity(d))}}doUpdateLabels(bubbleGEnter){if(this.renderLabel()){const labels=bubbleGEnter.select("text").attr("pointer-events",d=>this._labelPointerEvent(d)).text(d=>this._labelFunction(d));transition(labels,this.transitionDuration(),this.transitionDelay()).attr("opacity",d=>this._labelOpacity(d))}}_titleFunction(d){return this.title()(d)}_doRenderTitles(g){if(this.renderTitle()){const title=g.select("title");title.empty()&&g.append("title").text(d=>this._titleFunction(d))}}doUpdateTitles(g){this.renderTitle()&&g.select("title").text(d=>this._titleFunction(d))}sortBubbleSize(sortBubbleSize){return arguments.length?(this._sortBubbleSize=sortBubbleSize,this):this._sortBubbleSize}minRadius(radius){return arguments.length?(this.MIN_RADIUS=radius,this):this.MIN_RADIUS}minRadiusWithLabel(radius){return arguments.length?(this._minRadiusWithLabel=radius,this):this._minRadiusWithLabel}maxBubbleRelativeSize(relativeSize){return arguments.length?(this._maxBubbleRelativeSize=relativeSize,this):this._maxBubbleRelativeSize}excludeElasticZero(excludeZero){return arguments.length?(this._excludeElasticZero=excludeZero,this):this._excludeElasticZero}fadeDeselectedArea(selection){if(this.hasFilter()){const chart=this;this.selectAll(`g.${chart.BUBBLE_NODE_CLASS}`).each((function(d){chart.isSelectedNode(d)?chart.highlightSelected(this):chart.fadeDeselected(this)}))}else{const chart=this;this.selectAll(`g.${chart.BUBBLE_NODE_CLASS}`).each((function(){chart.resetHighlight(this)}))}}isSelectedNode(d){return this.hasFilter(d.key)}onClick(d){const filter=d.key;events.trigger(()=>{this.filter(filter),this.redrawGroup()})}},CapMixin=Base=>class extends Base{constructor(){super(),this._cap=1/0,this._takeFront=!0,this._othersLabel="Others",this._othersGrouper=(topItems,restItems)=>{const restItemsSum=d3Array.sum(restItems,this.valueAccessor()),restKeys=restItems.map(this.keyAccessor());return restItemsSum>0?topItems.concat([{others:restKeys,key:this.othersLabel(),value:restItemsSum}]):topItems},this.ordering(kv=>-kv.value),this.data(group=>{if(this._cap===1/0)return this._computeOrderedGroups(group.all());{let items=group.all(),rest;if(items=this._computeOrderedGroups(items),this._cap)if(this._takeFront)rest=items.slice(this._cap),items=items.slice(0,this._cap);else{const start=Math.max(0,items.length-this._cap);rest=items.slice(0,start),items=items.slice(start)}return this._othersGrouper?this._othersGrouper(items,rest):items}})}cappedKeyAccessor(d,i){return d.others?d.key:this.keyAccessor()(d,i)}cappedValueAccessor(d,i){return d.others?d.value:this.valueAccessor()(d,i)}cap(count){return arguments.length?(this._cap=count,this):this._cap}takeFront(takeFront){return arguments.length?(this._takeFront=takeFront,this):this._takeFront}othersLabel(label){return arguments.length?(this._othersLabel=label,this):this._othersLabel}othersGrouper(grouperFunction){return arguments.length?(this._othersGrouper=grouperFunction,this):this._othersGrouper}onClick(d){d.others&&this.filter([d.others]),super.onClick(d)}};class MarginMixin extends BaseMixin{constructor(){super(),this._margin={top:10,right:50,bottom:30,left:30}}margins(margins){return arguments.length?(this._margin=margins,this):this._margin}effectiveWidth(){return this.width()-this.margins().left-this.margins().right}effectiveHeight(){return this.height()-this.margins().top-this.margins().bottom}}const GRID_LINE_CLASS="grid-line",HORIZONTAL_CLASS="horizontal",VERTICAL_CLASS="vertical",Y_AXIS_LABEL_CLASS="y-axis-label",X_AXIS_LABEL_CLASS="x-axis-label",CUSTOM_BRUSH_HANDLE_CLASS="custom-brush-handle",DEFAULT_AXIS_LABEL_PADDING=12;class CoordinateGridMixin extends(ColorMixin(MarginMixin)){constructor(){super(),this.colors(d3Scale.scaleOrdinal(d3ScaleChromatic.schemeCategory10)),this._mandatoryAttributes().push("x"),this._parent=void 0,this._g=void 0,this._chartBodyG=void 0,this._x=void 0,this._origX=void 0,this._xOriginalDomain=void 0,this._xAxis=null,this._xUnits=units.integers,this._xAxisPadding=0,this._xAxisPaddingUnit=d3Time.timeDay,this._xElasticity=!1,this._xAxisLabel=void 0,this._xAxisLabelPadding=0,this._lastXDomain=void 0,this._y=void 0,this._yAxis=null,this._yAxisPadding=0,this._yElasticity=!1,this._yAxisLabel=void 0,this._yAxisLabelPadding=0,this._brush=d3Brush.brushX(),this._gBrush=void 0,this._brushOn=!0,this._parentBrushOn=!1,this._round=void 0,this._ignoreBrushEvents=!1,this._renderHorizontalGridLine=!1,this._renderVerticalGridLine=!1,this._resizing=!1,this._unitCount=void 0,this._zoomScale=[1,1/0],this._zoomOutRestrict=!0,this._zoom=d3Zoom.zoom().on("zoom",d3compat.eventHandler((d,evt)=>this._onZoom(evt))),this._nullZoom=d3Zoom.zoom().on("zoom",null),this._hasBeenMouseZoomable=!1,this._ignoreZoomEvents=!1,this._rangeChart=void 0,this._focusChart=void 0,this._mouseZoomable=!1,this._clipPadding=0,this._fOuterRangeBandPadding=.5,this._fRangeBandPadding=0,this._useRightYAxis=!1,this._useTopXAxis=!1}rescale(){return this._unitCount=void 0,this._resizing=!0,this}resizing(resizing){return arguments.length?(this._resizing=resizing,this):this._resizing}rangeChart(rangeChart){return arguments.length?(this._rangeChart=rangeChart,this._rangeChart.focusChart(this),this):this._rangeChart}zoomScale(extent){return arguments.length?(this._zoomScale=extent,this):this._zoomScale}zoomOutRestrict(zoomOutRestrict){return arguments.length?(this._zoomOutRestrict=zoomOutRestrict,this):this._zoomOutRestrict}_generateG(parent){this._parent=void 0===parent?this.svg():parent;const href=window.location.href.split("#")[0];return this._g=this._parent.append("g"),this._chartBodyG=this._g.append("g").attr("class","chart-body").attr("transform",`translate(${this.margins().left}, ${this.margins().top})`).attr("clip-path",`url(${href}#${this._getClipPathId()})`),this._g}g(gElement){return arguments.length?(this._g=gElement,this):this._g}mouseZoomable(mouseZoomable){return arguments.length?(this._mouseZoomable=mouseZoomable,this):this._mouseZoomable}chartBodyG(chartBodyG){return arguments.length?(this._chartBodyG=chartBodyG,this):this._chartBodyG}x(xScale){return arguments.length?(this._x=xScale,this._xOriginalDomain=this._x.domain(),this.rescale(),this):this._x}xOriginalDomain(){return this._xOriginalDomain}xUnits(xUnits){return arguments.length?(this._xUnits=xUnits,this):this._xUnits}xAxis(xAxis){return arguments.length?(this._xAxis=xAxis,this):(this._xAxis||(this._xAxis=this._createXAxis()),this._xAxis)}elasticX(elasticX){return arguments.length?(this._xElasticity=elasticX,this):this._xElasticity}xAxisPadding(padding){return arguments.length?(this._xAxisPadding=padding,this):this._xAxisPadding}xAxisPaddingUnit(unit){return arguments.length?(this._xAxisPaddingUnit=unit,this):this._xAxisPaddingUnit}xUnitCount(){return void 0===this._unitCount&&(this.isOrdinal()?this._unitCount=this.x().domain().length:(this._unitCount=this.xUnits()(this.x().domain()[0],this.x().domain()[1]),this._unitCount instanceof Array&&(this._unitCount=this._unitCount.length))),this._unitCount}useRightYAxis(useRightYAxis){return arguments.length?(this._useRightYAxis!==useRightYAxis&&this._yAxis&&logger.warn("Value of useRightYAxis has been altered, after yAxis was created. You might get unexpected yAxis behavior. Make calls to useRightYAxis sooner in your chart creation process."),this._useRightYAxis=useRightYAxis,this):this._useRightYAxis}useTopXAxis(useTopXAxis){return arguments.length?(this._useTopXAxis!==useTopXAxis&&this._xAxis&&logger.warn("Value of useTopXAxis has been altered, after xAxis was created. You might get unexpected yAxis behavior. Make calls to useTopXAxis sooner in your chart creation process."),this._useTopXAxis=useTopXAxis,this):this._useTopXAxis}isOrdinal(){return this.xUnits()===units.ordinal}_useOuterPadding(){return!0}_ordinalXDomain(){const groups=this._computeOrderedGroups(this.data());return groups.map(this.keyAccessor())}_createXAxis(){return this._useTopXAxis?d3Axis.axisTop():d3Axis.axisBottom()}_prepareXAxis(g,render){this.isOrdinal()?(this._x.bandwidth||(logger.warn("For compatibility with d3v4+, dc.js d3.0 ordinal bar/line/bubble charts need d3.scaleBand() for the x scale, instead of d3.scaleOrdinal(). Replacing .x() with a d3.scaleBand with the same domain - make the same change in your code to avoid this warning!"),this._x=d3Scale.scaleBand().domain(this._x.domain())),(this.elasticX()||0===this._x.domain().length)&&this._x.domain(this._ordinalXDomain())):this.elasticX()&&this._x.domain([this.xAxisMin(),this.xAxisMax()]);const xdom=this._x.domain();!render&&utils.arraysEqual(this._lastXDomain,xdom)||this.rescale(),this._lastXDomain=xdom,this.isOrdinal()?this._x.range([0,this.xAxisLength()]).paddingInner(this._fRangeBandPadding).paddingOuter(this._useOuterPadding()?this._fOuterRangeBandPadding:0):this._x.range([0,this.xAxisLength()]),this._xAxis||(this._xAxis=this._createXAxis()),this._xAxis=this._xAxis.scale(this.x()),this._renderVerticalGridLines(g)}renderXAxis(g){let axisXG=g.select("g.x");axisXG.empty()&&(axisXG=g.append("g").attr("class","axis x").attr("transform",`translate(${this.margins().left},${this._xAxisY()})`));let axisXLab=g.select("text.x-axis-label");const axisXLabY=this._useTopXAxis?this._xAxisLabelPadding:this.height()-this._xAxisLabelPadding;axisXLab.empty()&&this.xAxisLabel()&&(axisXLab=g.append("text").attr("class","x-axis-label").attr("transform",`translate(${this.margins().left+this.xAxisLength()/2},${axisXLabY})`).attr("text-anchor","middle")),this.xAxisLabel()&&axisXLab.text()!==this.xAxisLabel()&&axisXLab.text(this.xAxisLabel()),transition(axisXG,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.margins().left},${this._xAxisY()})`).call(this._xAxis),transition(axisXLab,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.margins().left+this.xAxisLength()/2},${axisXLabY})`)}_renderVerticalGridLines(g){let gridLineG=g.select("g.vertical");if(this._renderVerticalGridLine){gridLineG.empty()&&(gridLineG=g.insert("g",":first-child").attr("class","grid-line vertical").attr("transform",`translate(${this.margins().left},${this.margins().top})`));const ticks=this._xAxis.tickValues()?this._xAxis.tickValues():"function"==typeof this._x.ticks?this._x.ticks.apply(this._x,this._xAxis.tickArguments()):this._x.domain(),lines=gridLineG.selectAll("line").data(ticks),linesGEnter=lines.enter().append("line").attr("x1",d=>this._x(d)).attr("y1",this._xAxisY()-this.margins().top).attr("x2",d=>this._x(d)).attr("y2",0).attr("opacity",0);transition(linesGEnter,this.transitionDuration(),this.transitionDelay()).attr("opacity",.5),transition(lines,this.transitionDuration(),this.transitionDelay()).attr("x1",d=>this._x(d)).attr("y1",this._xAxisY()-this.margins().top).attr("x2",d=>this._x(d)).attr("y2",0),lines.exit().remove()}else gridLineG.selectAll("line").remove()}_xAxisY(){return this._useTopXAxis?this.margins().top:this.height()-this.margins().bottom}xAxisLength(){return this.effectiveWidth()}xAxisLabel(labelText,padding){return arguments.length?(this._xAxisLabel=labelText,this.margins().bottom-=this._xAxisLabelPadding,this._xAxisLabelPadding=void 0===padding?12:padding,this.margins().bottom+=this._xAxisLabelPadding,this):this._xAxisLabel}_createYAxis(){return this._useRightYAxis?d3Axis.axisRight():d3Axis.axisLeft()}_prepareYAxis(g){if(void 0===this._y||this.elasticY()){void 0===this._y&&(this._y=d3Scale.scaleLinear());const _min=this.yAxisMin()||0,_max=this.yAxisMax()||0;this._y.domain([_min,_max]).rangeRound([this.yAxisHeight(),0])}this._y.range([this.yAxisHeight(),0]),this._yAxis||(this._yAxis=this._createYAxis()),this._yAxis.scale(this._y),this._renderHorizontalGridLinesForAxis(g,this._y,this._yAxis)}renderYAxisLabel(axisClass,text,rotation,labelXPosition){labelXPosition=labelXPosition||this._yAxisLabelPadding;let axisYLab=this.g().select(`text.y-axis-label.${axisClass}-label`);const labelYPosition=this.margins().top+this.yAxisHeight()/2;axisYLab.empty()&&text&&(axisYLab=this.g().append("text").attr("transform",`translate(${labelXPosition},${labelYPosition}),rotate(${rotation})`).attr("class",`y-axis-label ${axisClass}-label`).attr("text-anchor","middle").text(text)),text&&axisYLab.text()!==text&&axisYLab.text(text),transition(axisYLab,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${labelXPosition},${labelYPosition}),rotate(${rotation})`)}renderYAxisAt(axisClass,axis,position){let axisYG=this.g().select(`g.${axisClass}`);axisYG.empty()&&(axisYG=this.g().append("g").attr("class",`axis ${axisClass}`).attr("transform",`translate(${position},${this.margins().top})`)),transition(axisYG,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${position},${this.margins().top})`).call(axis)}renderYAxis(){const axisPosition=this._useRightYAxis?this.width()-this.margins().right:this._yAxisX();this.renderYAxisAt("y",this._yAxis,axisPosition);const labelPosition=this._useRightYAxis?this.width()-this._yAxisLabelPadding:this._yAxisLabelPadding,rotation=this._useRightYAxis?90:-90;this.renderYAxisLabel("y",this.yAxisLabel(),rotation,labelPosition)}_renderHorizontalGridLinesForAxis(g,scale,axis){let gridLineG=g.select("g.horizontal");if(this._renderHorizontalGridLine){const ticks=axis.tickValues()?axis.tickValues():scale.ticks?scale.ticks.apply(scale,axis.tickArguments()):scale.domain();gridLineG.empty()&&(gridLineG=g.insert("g",":first-child").attr("class","grid-line horizontal").attr("transform",`translate(${this.margins().left},${this.margins().top})`));const lines=gridLineG.selectAll("line").data(ticks),linesGEnter=lines.enter().append("line").attr("x1",1).attr("y1",d=>scale(d)).attr("x2",this.xAxisLength()).attr("y2",d=>scale(d)).attr("opacity",0);transition(linesGEnter,this.transitionDuration(),this.transitionDelay()).attr("opacity",.5),transition(lines,this.transitionDuration(),this.transitionDelay()).attr("x1",1).attr("y1",d=>scale(d)).attr("x2",this.xAxisLength()).attr("y2",d=>scale(d)),lines.exit().remove()}else gridLineG.selectAll("line").remove()}_yAxisX(){return this.useRightYAxis()?this.width()-this.margins().right:this.margins().left}yAxisLabel(labelText,padding){return arguments.length?(this._yAxisLabel=labelText,this.margins().left-=this._yAxisLabelPadding,this._yAxisLabelPadding=void 0===padding?12:padding,this.margins().left+=this._yAxisLabelPadding,this):this._yAxisLabel}y(yScale){return arguments.length?(this._y=yScale,this.rescale(),this):this._y}yAxis(yAxis){return arguments.length?(this._yAxis=yAxis,this):(this._yAxis||(this._yAxis=this._createYAxis()),this._yAxis)}elasticY(elasticY){return arguments.length?(this._yElasticity=elasticY,this):this._yElasticity}renderHorizontalGridLines(renderHorizontalGridLines){return arguments.length?(this._renderHorizontalGridLine=renderHorizontalGridLines,this):this._renderHorizontalGridLine}renderVerticalGridLines(renderVerticalGridLines){return arguments.length?(this._renderVerticalGridLine=renderVerticalGridLines,this):this._renderVerticalGridLine}xAxisMin(){const m=d3Array.min(this.data(),e=>this.keyAccessor()(e));return utils.subtract(m,this._xAxisPadding,this._xAxisPaddingUnit)}xAxisMax(){const m=d3Array.max(this.data(),e=>this.keyAccessor()(e));return utils.add(m,this._xAxisPadding,this._xAxisPaddingUnit)}yAxisMin(){const m=d3Array.min(this.data(),e=>this.valueAccessor()(e));return utils.subtract(m,this._yAxisPadding)}yAxisMax(){const m=d3Array.max(this.data(),e=>this.valueAccessor()(e));return utils.add(m,this._yAxisPadding)}yAxisPadding(padding){return arguments.length?(this._yAxisPadding=padding,this):this._yAxisPadding}yAxisHeight(){return this.effectiveHeight()}round(round){return arguments.length?(this._round=round,this):this._round}_rangeBandPadding(_){return arguments.length?(this._fRangeBandPadding=_,this):this._fRangeBandPadding}_outerRangeBandPadding(_){return arguments.length?(this._fOuterRangeBandPadding=_,this):this._fOuterRangeBandPadding}filter(_){return arguments.length?(super.filter(_),this.redrawBrush(_,!1),this):super.filter()}brush(_){return arguments.length?(this._brush=_,this):this._brush}renderBrush(g,doTransition){this._brushOn&&(this._brush.on("start brush end",d3compat.eventHandler((d,evt)=>this._brushing(evt))),this._gBrush=g.append("g").attr("class","brush").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this.setBrushExtents(),this.createBrushHandlePaths(this._gBrush,doTransition),this.redrawBrush(this.filter(),doTransition))}createBrushHandlePaths(gBrush){let brushHandles=gBrush.selectAll("path.custom-brush-handle").data([{type:"w"},{type:"e"}]);brushHandles=brushHandles.enter().append("path").attr("class","custom-brush-handle").merge(brushHandles),brushHandles.attr("d",d=>this.resizeHandlePath(d))}extendBrush(brushSelection){return brushSelection&&this.round()&&(brushSelection[0]=this.round()(brushSelection[0]),brushSelection[1]=this.round()(brushSelection[1])),brushSelection}brushIsEmpty(brushSelection){return!brushSelection||brushSelection[1]<=brushSelection[0]}_brushing(evt){if(this._ignoreBrushEvents)return;let brushSelection=evt.selection;brushSelection&&(brushSelection=brushSelection.map(this.x().invert)),brushSelection=this.extendBrush(brushSelection),this.redrawBrush(brushSelection,!1);const rangedFilter=this.brushIsEmpty(brushSelection)?null:filters.RangedFilter(brushSelection[0],brushSelection[1]);events.trigger(()=>{this.applyBrushSelection(rangedFilter)},constants.EVENT_DELAY)}applyBrushSelection(rangedFilter){this.replaceFilter(rangedFilter),this.redrawGroup()}_withoutBrushEvents(closure){const oldValue=this._ignoreBrushEvents;this._ignoreBrushEvents=!0;try{closure()}finally{this._ignoreBrushEvents=oldValue}}setBrushExtents(doTransition){this._withoutBrushEvents(()=>{this._brush.extent([[0,0],[this.effectiveWidth(),this.effectiveHeight()]])}),this._gBrush.call(this._brush)}redrawBrush(brushSelection,doTransition){if(this._brushOn&&this._gBrush)if(this._resizing&&this.setBrushExtents(doTransition),brushSelection){const scaledSelection=[this._x(brushSelection[0]),this._x(brushSelection[1])],gBrush=optionalTransition(doTransition,this.transitionDuration(),this.transitionDelay())(this._gBrush);this._withoutBrushEvents(()=>{gBrush.call(this._brush.move,scaledSelection)}),gBrush.selectAll("path.custom-brush-handle").attr("display",null).attr("transform",(d,i)=>`translate(${this._x(brushSelection[i])}, 0)`).attr("d",d=>this.resizeHandlePath(d))}else this._withoutBrushEvents(()=>{this._gBrush.call(this._brush.move,null)}),this._gBrush.selectAll("path.custom-brush-handle").attr("display","none");this.fadeDeselectedArea(brushSelection)}fadeDeselectedArea(brushSelection){}resizeHandlePath(d){const e=+("e"===(d=d.type)),x=e?1:-1,y=this.effectiveHeight()/3;return`M${.5*x},${y}A6,6 0 0 ${e} ${6.5*x},${y+6}V${2*y-6}A6,6 0 0 ${e} ${.5*x},${2*y}Z`+`M${2.5*x},${y+8}V${2*y-8}M${4.5*x},${y+8}V${2*y-8}`}_getClipPathId(){return`${this.anchorName().replace(/[ .#=\[\]"]/g,"-")}-clip`}clipPadding(padding){return arguments.length?(this._clipPadding=padding,this):this._clipPadding}_generateClipPath(){const defs=utils.appendOrSelect(this._parent,"defs"),id=this._getClipPathId(),chartBodyClip=utils.appendOrSelect(defs,`#${id}`,"clipPath").attr("id",id),padding=2*this._clipPadding;utils.appendOrSelect(chartBodyClip,"rect").attr("width",this.xAxisLength()+padding).attr("height",this.yAxisHeight()+padding).attr("transform",`translate(-${this._clipPadding}, -${this._clipPadding})`)}_preprocessData(){}_doRender(){return this.resetSvg(),this._preprocessData(),this._generateG(),this._generateClipPath(),this._drawChart(!0),this._configureMouseZoom(),this}_doRedraw(){return this._preprocessData(),this._drawChart(!1),this._generateClipPath(),this}_drawChart(render){this.isOrdinal()&&(this._brushOn=!1),this._prepareXAxis(this.g(),render),this._prepareYAxis(this.g()),this.plotData(),(this.elasticX()||this._resizing||render)&&this.renderXAxis(this.g()),(this.elasticY()||this._resizing||render)&&this.renderYAxis(this.g()),render?this.renderBrush(this.g(),!1):this.redrawBrush(this.filter(),this._resizing),this.fadeDeselectedArea(this.filter()),this.resizing(!1)}_configureMouseZoom(){this._origX=this._x.copy(),this._mouseZoomable?this._enableMouseZoom():this._hasBeenMouseZoomable&&this._disableMouseZoom()}_enableMouseZoom(){this._hasBeenMouseZoomable=!0;const extent=[[0,0],[this.effectiveWidth(),this.effectiveHeight()]];if(this._zoom.scaleExtent(this._zoomScale).extent(extent).duration(this.transitionDuration()),this._zoomOutRestrict){const zoomScaleMin=Math.max(this._zoomScale[0],1);this._zoom.translateExtent(extent).scaleExtent([zoomScaleMin,this._zoomScale[1]])}this.root().call(this._zoom),this._updateD3zoomTransform()}_disableMouseZoom(){this.root().call(this._nullZoom)}_zoomHandler(newDomain,noRaiseEvents){let domFilter;this._hasRangeSelected(newDomain)?(this.x().domain(newDomain),domFilter=filters.RangedFilter(newDomain[0],newDomain[1])):(this.x().domain(this._xOriginalDomain),domFilter=null),this.replaceFilter(domFilter),this.rescale(),this.redraw(),noRaiseEvents||(this._rangeChart&&!utils.arraysEqual(this.filter(),this._rangeChart.filter())&&events.trigger(()=>{this._rangeChart.replaceFilter(domFilter),this._rangeChart.redraw()}),this._invokeZoomedListener(),events.trigger(()=>{this.redrawGroup()},constants.EVENT_DELAY))}_domainToZoomTransform(newDomain,origDomain,xScale){const k=(origDomain[1]-origDomain[0])/(newDomain[1]-newDomain[0]),xt=-1*xScale(newDomain[0]);return d3Zoom.zoomIdentity.scale(k).translate(xt,0)}_updateD3zoomTransform(){this._zoom&&this._withoutZoomEvents(()=>{this._zoom.transform(this.root(),this._domainToZoomTransform(this.x().domain(),this._xOriginalDomain,this._origX))})}_withoutZoomEvents(closure){const oldValue=this._ignoreZoomEvents;this._ignoreZoomEvents=!0;try{closure()}finally{this._ignoreZoomEvents=oldValue}}_onZoom(evt){if(this._ignoreZoomEvents)return;const newDomain=evt.transform.rescaleX(this._origX).domain();this.focus(newDomain,!1)}_checkExtents(ext,outerLimits){return ext&&2===ext.length&&outerLimits&&2===outerLimits.length?((ext[0]>outerLimits[1]||ext[1]<outerLimits[0])&&console.warn("Could not intersect extents, will reset"),[ext[0]>outerLimits[0]?ext[0]:outerLimits[0],ext[1]<outerLimits[1]?ext[1]:outerLimits[1]]):ext}focus(range,noRaiseEvents){this._zoomOutRestrict&&(range=this._checkExtents(range,this._xOriginalDomain),this._rangeChart&&(range=this._checkExtents(range,this._rangeChart.x().domain()))),this._zoomHandler(range,noRaiseEvents),this._updateD3zoomTransform()}refocused(){return!utils.arraysEqual(this.x().domain(),this._xOriginalDomain)}focusChart(c){return arguments.length?(this._focusChart=c,this.on("filtered.dcjs-range-chart",chart=>{chart.filter()?utils.arraysEqual(chart.filter(),this._focusChart.filter())||events.trigger(()=>{this._focusChart.focus(chart.filter(),!0)}):events.trigger(()=>{this._focusChart.x().domain(this._focusChart.xOriginalDomain(),!0)})}),this):this._focusChart}brushOn(brushOn){return arguments.length?(this._brushOn=brushOn,this):this._brushOn}parentBrushOn(brushOn){return arguments.length?(this._parentBrushOn=brushOn,this):this._parentBrushOn}gBrush(){return this._gBrush}_hasRangeSelected(range){return range instanceof Array&&range.length>1}}const d3Box=function(){let width=1,height=1,duration=0;const delay=0;let domain=null,value=Number,whiskers=boxWhiskers,quartiles=boxQuartiles,tickFormat=null,renderDataPoints=!1;const dataRadius=3;let dataOpacity=.3,dataWidthPortion=.8,renderTitle=!1,showOutliers=!0,boldOutlier=!1;function box(g){g.each((function(data,index){data=data.map(value).sort(d3Array.ascending);const _g=d3Selection.select(this),n=data.length;let min,max;if(0===n)return;const quartileData=data.quartiles=quartiles(data),whiskerIndices=whiskers&&whiskers.call(this,data,index),whiskerData=whiskerIndices&&whiskerIndices.map(_i=>data[_i]),outlierIndices=whiskerIndices?d3Array.range(0,whiskerIndices[0]).concat(d3Array.range(whiskerIndices[1]+1,n)):d3Array.range(n);showOutliers?(min=data[0],max=data[n-1]):(min=data[whiskerIndices[0]],max=data[whiskerIndices[1]]);const pointIndices=d3Array.range(whiskerIndices[0],whiskerIndices[1]+1),x1=d3Scale.scaleLinear().domain(domain&&domain.call(this,data,index)||[min,max]).range([height,0]),x0=this.__chart__||d3Scale.scaleLinear().domain([0,1/0]).range(x1.range());this.__chart__=x1;const center=_g.selectAll("line.center").data(whiskerData?[whiskerData]:[]);center.enter().insert("line","rect").attr("class","center").attr("x1",width/2).attr("y1",d=>x0(d[0])).attr("x2",width/2).attr("y2",d=>x0(d[1])).style("opacity",1e-6).transition().duration(duration).delay(0).style("opacity",1).attr("y1",d=>x1(d[0])).attr("y2",d=>x1(d[1])),center.transition().duration(duration).delay(0).style("opacity",1).attr("x1",width/2).attr("x2",width/2).attr("y1",d=>x1(d[0])).attr("y2",d=>x1(d[1])),center.exit().transition().duration(duration).delay(0).style("opacity",1e-6).attr("y1",d=>x1(d[0])).attr("y2",d=>x1(d[1])).remove();const _box=_g.selectAll("rect.box").data([quartileData]);_box.enter().append("rect").attr("class","box").attr("x",0).attr("y",d=>x0(d[2])).attr("width",width).attr("height",d=>x0(d[0])-x0(d[2])).style("fill-opacity",renderDataPoints?.1:1).transition().duration(duration).delay(0).attr("y",d=>x1(d[2])).attr("height",d=>x1(d[0])-x1(d[2])),_box.transition().duration(duration).delay(0).attr("width",width).attr("y",d=>x1(d[2])).attr("height",d=>x1(d[0])-x1(d[2]));const medianLine=_g.selectAll("line.median").data([quartileData[1]]);medianLine.enter().append("line").attr("class","median").attr("x1",0).attr("y1",x0).attr("x2",width).attr("y2",x0).transition().duration(duration).delay(0).attr("y1",x1).attr("y2",x1),medianLine.transition().duration(duration).delay(0).attr("x1",0).attr("x2",width).attr("y1",x1).attr("y2",x1);const whisker=_g.selectAll("line.whisker").data(whiskerData||[]);if(whisker.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",x0).attr("x2",width).attr("y2",x0).style("opacity",1e-6).transition().duration(duration).delay(0).attr("y1",x1).attr("y2",x1).style("opacity",1),whisker.transition().duration(duration).delay(0).attr("x1",0).attr("x2",width).attr("y1",x1).attr("y2",x1).style("opacity",1),whisker.exit().transition().duration(duration).delay(0).attr("y1",x1).attr("y2",x1).style("opacity",1e-6).remove(),showOutliers){const outlierClass=boldOutlier?"outlierBold":"outlier",outlierSize=boldOutlier?3:5,outlierX=boldOutlier?function(){return Math.floor(Math.random()*(width*dataWidthPortion)+1+(width-width*dataWidthPortion)/2)}:function(){return width/2},outlier=_g.selectAll(`circle.${outlierClass}`).data(outlierIndices,Number);outlier.enter().insert("circle","text").attr("class",outlierClass).attr("r",outlierSize).attr("cx",outlierX).attr("cy",i=>x0(data[i])).style("opacity",1e-6).transition().duration(duration).delay(0).attr("cy",i=>x1(data[i])).style("opacity",.6),renderTitle&&(outlier.selectAll("title").remove(),outlier.append("title").text(i=>data[i])),outlier.transition().duration(duration).delay(0).attr("cx",outlierX).attr("cy",i=>x1(data[i])).style("opacity",.6),outlier.exit().transition().duration(duration).delay(0).attr("cy",0).style("opacity",1e-6).remove()}if(renderDataPoints){const point=_g.selectAll("circle.data").data(pointIndices);point.enter().insert("circle","text").attr("class","data").attr("r",3).attr("cx",()=>Math.floor(Math.random()*(width*dataWidthPortion)+1+(width-width*dataWidthPortion)/2)).attr("cy",i=>x0(data[i])).style("opacity",1e-6).transition().duration(duration).delay(0).attr("cy",i=>x1(data[i])).style("opacity",dataOpacity),renderTitle&&(point.selectAll("title").remove(),point.append("title").text(i=>data[i])),point.transition().duration(duration).delay(0).attr("cx",()=>Math.floor(Math.random()*(width*dataWidthPortion)+1+(width-width*dataWidthPortion)/2)).attr("cy",i=>x1(data[i])).style("opacity",dataOpacity),point.exit().transition().duration(duration).delay(0).attr("cy",0).style("opacity",1e-6).remove()}const format=tickFormat||x1.tickFormat(8),boxTick=_g.selectAll("text.box").data(quartileData);boxTick.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",(d,i)=>1&i?6:-6).attr("x",(d,i)=>1&i?width:0).attr("y",x0).attr("text-anchor",(d,i)=>1&i?"start":"end").text(format).transition().duration(duration).delay(0).attr("y",x1),boxTick.transition().duration(duration).delay(0).text(format).attr("x",(d,i)=>1&i?width:0).attr("y",x1);const whiskerTick=_g.selectAll("text.whisker").data(whiskerData||[]);whiskerTick.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",width).attr("y",x0).text(format).style("opacity",1e-6).transition().duration(duration).delay(0).attr("y",x1).style("opacity",1),whiskerTick.transition().duration(duration).delay(0).text(format).attr("x",width).attr("y",x1).style("opacity",1),whiskerTick.exit().transition().duration(duration).delay(0).attr("y",x1).style("opacity",1e-6).remove(),delete data.quartiles})),d3Timer.timerFlush()}return box.width=function(x){return arguments.length?(width=x,box):width},box.height=function(x){return arguments.length?(height=x,box):height},box.tickFormat=function(x){return arguments.length?(tickFormat=x,box):tickFormat},box.showOutliers=function(x){return arguments.length?(showOutliers=x,box):showOutliers},box.boldOutlier=function(x){return arguments.length?(boldOutlier=x,box):boldOutlier},box.renderDataPoints=function(x){return arguments.length?(renderDataPoints=x,box):renderDataPoints},box.renderTitle=function(x){return arguments.length?(renderTitle=x,box):renderTitle},box.dataOpacity=function(x){return arguments.length?(dataOpacity=x,box):dataOpacity},box.dataWidthPortion=function(x){return arguments.length?(dataWidthPortion=x,box):dataWidthPortion},box.duration=function(x){return arguments.length?(duration=x,box):duration},box.domain=function(x){return arguments.length?(domain=null===x?x:"function"==typeof x?x:utils.constant(x),box):domain},box.value=function(x){return arguments.length?(value=x,box):value},box.whiskers=function(x){return arguments.length?(whiskers=x,box):whiskers},box.quartiles=function(x){return arguments.length?(quartiles=x,box):quartiles},box};function boxWhiskers(d){return[0,d.length-1]}function boxQuartiles(d){return[d3Array.quantile(d,.25),d3Array.quantile(d,.5),d3Array.quantile(d,.75)]}class StackMixin extends CoordinateGridMixin{constructor(){super(),this._stackLayout=d3Shape.stack(),this._stack=[],this._titles={},this._hidableStacks=!1,this._evadeDomainFilter=!1,this.data(()=>{const layers=this._stack.filter(this._visibility);if(!layers.length)return[];layers.forEach((l,i)=>this._prepareValues(l,i));const v4data=layers[0].values.map((v,i)=>{const col={x:v.x};return layers.forEach(layer=>{col[layer.name]=layer.values[i].y}),col}),keys=layers.map(layer=>layer.name),v4result=this.stackLayout().keys(keys)(v4data);return v4result.forEach((series,i)=>{series.forEach((ys,j)=>{layers[i].values[j].y0=ys[0],layers[i].values[j].y1=ys[1]})}),layers}),this.colorAccessor((function(d){return this.layer||this.name||d.name||d.layer}))}_prepareValues(layer,layerIdx){const valAccessor=layer.accessor||this.valueAccessor();layer.name=String(layer.name||layerIdx);const allValues=layer.group.all().map((d,i)=>({x:this.keyAccessor()(d,i),y:layer.hidden?null:valAccessor(d,i),data:d,layer:layer.name,hidden:layer.hidden}));layer.domainValues=allValues.filter(l=>this._domainFilter()(l)),layer.values=this.evadeDomainFilter()?allValues:layer.domainValues}_domainFilter(){if(!this.x())return utils.constant(!0);const xDomain=this.x().domain();return this.isOrdinal()?()=>!0:this.elasticX()?()=>!0:p=>p.x>=xDomain[0]&&p.x<=xDomain[xDomain.length-1]}stack(group,name,accessor){if(!arguments.length)return this._stack;arguments.length<=2&&(accessor=name);const layer={group:group};return"string"==typeof name&&(layer.name=name),"function"==typeof accessor&&(layer.accessor=accessor),this._stack.push(layer),this}group(g,n,f){return arguments.length?(this._stack=[],this._titles={},this.stack(g,n),f&&this.valueAccessor(f),super.group(g,n)):super.group()}hidableStacks(hidableStacks){return arguments.length?(this._hidableStacks=hidableStacks,this):this._hidableStacks}_findLayerByName(n){const i=this._stack.map(pluck("name")).indexOf(n);return this._stack[i]}hideStack(stackName){const layer=this._findLayerByName(stackName);return layer&&(layer.hidden=!0),this}showStack(stackName){const layer=this._findLayerByName(stackName);return layer&&(layer.hidden=!1),this}getValueAccessorByIndex(index){return this._stack[index].accessor||this.valueAccessor()}yAxisMin(){const m=d3Array.min(this._flattenStack(),p=>p.y<0?p.y+p.y0:p.y0);return utils.subtract(m,this.yAxisPadding())}yAxisMax(){const m=d3Array.max(this._flattenStack(),p=>p.y>0?p.y+p.y0:p.y0);return utils.add(m,this.yAxisPadding())}_flattenStack(){const values=this.data().map(layer=>layer.domainValues);return[].concat(...values)}xAxisMin(){const m=d3Array.min(this._flattenStack(),pluck("x"));return utils.subtract(m,this.xAxisPadding(),this.xAxisPaddingUnit())}xAxisMax(){const m=d3Array.max(this._flattenStack(),pluck("x"));return utils.add(m,this.xAxisPadding(),this.xAxisPaddingUnit())}title(stackName,titleAccessor){return stackName?"function"==typeof stackName?super.title(stackName):stackName===this._groupName&&"function"==typeof titleAccessor?super.title(titleAccessor):"function"!=typeof titleAccessor?this._titles[stackName]||super.title():(this._titles[stackName]=titleAccessor,this):super.title()}stackLayout(_stack){return arguments.length?(this._stackLayout=_stack,this):this._stackLayout}evadeDomainFilter(evadeDomainFilter){return arguments.length?(this._evadeDomainFilter=evadeDomainFilter,this):this._evadeDomainFilter}_visibility(l){return!l.hidden}_ordinalXDomain(){const flat=this._flattenStack().map(pluck("data")),ordered=this._computeOrderedGroups(flat);return ordered.map(this.keyAccessor())}legendables(){return this._stack.map((layer,i)=>({chart:this,name:layer.name,hidden:layer.hidden||!1,color:this.getColor.call(layer,layer.values,i)}))}isLegendableHidden(d){const layer=this._findLayerByName(d.name);return!!layer&&layer.hidden}legendToggle(d){this._hidableStacks&&(this.isLegendableHidden(d)?this.showStack(d.name):this.hideStack(d.name),this.renderGroup())}}const MIN_BAR_WIDTH=1,DEFAULT_GAP_BETWEEN_BARS=2,LABEL_PADDING=3;class BarChart extends StackMixin{constructor(parent,chartGroup){super(),this._gap=2,this._centerBar=!1,this._alwaysUseRounding=!1,this._barWidth=void 0,this.label(d=>utils.printSingleValue(d.y0+d.y),!1),this.anchor(parent,chartGroup)}outerPadding(padding){return arguments.length?this._outerRangeBandPadding(padding):this._outerRangeBandPadding()}rescale(){return super.rescale(),this._barWidth=void 0,this}render(){return this.round()&&this._centerBar&&!this._alwaysUseRounding&&logger.warn("By default, brush rounding is disabled if bars are centered. See dc.js bar chart API documentation for details."),super.render()}plotData(){let layers=this.chartBodyG().selectAll("g.stack").data(this.data());this._calculateBarWidth(),layers=layers.enter().append("g").attr("class",(d,i)=>`stack _${i}`).merge(layers);const last=layers.size()-1;{const chart=this;layers.each((function(d,i){const layer=d3Selection.select(this);chart._renderBars(layer,i,d),chart.renderLabel()&&last===i&&chart._renderLabels(layer,i,d)}))}}_barHeight(d){return utils.safeNumber(Math.abs(this.y()(d.y+d.y0)-this.y()(d.y0)))}_labelXPos(d){let x=this.x()(d.x);return this._centerBar||(x+=this._barWidth/2),this.isOrdinal()&&void 0!==this._gap&&(x+=this._gap/2),utils.safeNumber(x)}_labelYPos(d){let y=this.y()(d.y+d.y0);return d.y<0&&(y-=this._barHeight(d)),utils.safeNumber(y-3)}_renderLabels(layer,layerIndex,data){const labels=layer.selectAll("text.barLabel").data(data.values,pluck("x")),labelsEnterUpdate=labels.enter().append("text").attr("class","barLabel").attr("text-anchor","middle").attr("x",d=>this._labelXPos(d)).attr("y",d=>this._labelYPos(d)).merge(labels);this.isOrdinal()&&(labelsEnterUpdate.on("click",d3compat.eventHandler(d=>this.onClick(d))),labelsEnterUpdate.attr("cursor","pointer")),transition(labelsEnterUpdate,this.transitionDuration(),this.transitionDelay()).attr("x",d=>this._labelXPos(d)).attr("y",d=>this._labelYPos(d)).text(d=>this.label()(d)),transition(labels.exit(),this.transitionDuration(),this.transitionDelay()).attr("height",0).remove()}_barXPos(d){let x=this.x()(d.x);return this._centerBar&&(x-=this._barWidth/2),this.isOrdinal()&&void 0!==this._gap&&(x+=this._gap/2),utils.safeNumber(x)}_renderBars(layer,layerIndex,data){const bars=layer.selectAll("rect.bar").data(data.values,pluck("x")),enter=bars.enter().append("rect").attr("class","bar").classed("dc-tabbable",this._keyboardAccessible).attr("fill",pluck("data",this.getColor)).attr("x",d=>this._barXPos(d)).attr("y",this.yAxisHeight()).attr("height",0),barsEnterUpdate=enter.merge(bars);this.renderTitle()&&enter.append("title").text(pluck("data",this.title(data.name))),this.isOrdinal()&&barsEnterUpdate.on("click",d3compat.eventHandler(d=>this.onClick(d))),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),transition(barsEnterUpdate,this.transitionDuration(),this.transitionDelay()).attr("x",d=>this._barXPos(d)).attr("y",d=>{let y=this.y()(d.y+d.y0);return d.y<0&&(y-=this._barHeight(d)),utils.safeNumber(y)}).attr("width",this._barWidth).attr("height",d=>this._barHeight(d)).attr("fill",pluck("data",this.getColor)).select("title").text(pluck("data",this.title(data.name))),transition(bars.exit(),this.transitionDuration(),this.transitionDelay()).attr("x",d=>this.x()(d.x)).attr("width",.9*this._barWidth).remove()}_calculateBarWidth(){if(void 0===this._barWidth){const numberOfBars=this.xUnitCount();this.isOrdinal()&&void 0===this._gap?this._barWidth=Math.floor(this.x().bandwidth()):this._gap?this._barWidth=Math.floor((this.xAxisLength()-(numberOfBars-1)*this._gap)/numberOfBars):this._barWidth=Math.floor(this.xAxisLength()/(1+this.barPadding())/numberOfBars),(this._barWidth===1/0||isNaN(this._barWidth)||this._barWidth<1)&&(this._barWidth=1)}}fadeDeselectedArea(brushSelection){const bars=this.chartBodyG().selectAll("rect.bar");if(this.isOrdinal())this.hasFilter()?(bars.classed(constants.SELECTED_CLASS,d=>this.hasFilter(d.x)),bars.classed(constants.DESELECTED_CLASS,d=>!this.hasFilter(d.x))):(bars.classed(constants.SELECTED_CLASS,!1),bars.classed(constants.DESELECTED_CLASS,!1));else if(this.brushOn()||this.parentBrushOn())if(this.brushIsEmpty(brushSelection))bars.classed(constants.DESELECTED_CLASS,!1);else{const start=brushSelection[0],end=brushSelection[1];bars.classed(constants.DESELECTED_CLASS,d=>d.x<start||d.x>=end)}}centerBar(centerBar){return arguments.length?(this._centerBar=centerBar,this):this._centerBar}onClick(d){super.onClick(d.data)}barPadding(barPadding){return arguments.length?(this._rangeBandPadding(barPadding),this._gap=void 0,this):this._rangeBandPadding()}_useOuterPadding(){return void 0===this._gap}gap(gap){return arguments.length?(this._gap=gap,this):this._gap}extendBrush(brushSelection){return brushSelection&&this.round()&&(!this._centerBar||this._alwaysUseRounding)&&(brushSelection[0]=this.round()(brushSelection[0]),brushSelection[1]=this.round()(brushSelection[1])),brushSelection}alwaysUseRounding(alwaysUseRounding){return arguments.length?(this._alwaysUseRounding=alwaysUseRounding,this):this._alwaysUseRounding}legendHighlight(d){const colorFilter=(color,inv)=>function(){const item=d3Selection.select(this),match=item.attr("fill")===color;return inv?!match:match};this.isLegendableHidden(d)||this.g().selectAll("rect.bar").classed("highlight",colorFilter(d.color)).classed("fadeout",colorFilter(d.color,!0))}legendReset(){this.g().selectAll("rect.bar").classed("highlight",!1).classed("fadeout",!1)}xAxisMax(){let max=super.xAxisMax();if("resolution"in this.xUnits()){const res=this.xUnits().resolution;max+=res}return max}}const barChart=(parent,chartGroup)=>new BarChart(parent,chartGroup);function defaultWhiskersIQR(k){return d=>{const q1=d.quartiles[0],q3=d.quartiles[2],iqr=(q3-q1)*k;let i=-1,j=d.length;do{++i}while(d[i]<q1-iqr);do{--j}while(d[j]>q3+iqr);return[i,j]}}class BoxPlot extends CoordinateGridMixin{constructor(parent,chartGroup){super(),this._whiskerIqrFactor=1.5,this._whiskersIqr=defaultWhiskersIQR,this._whiskers=this._whiskersIqr(this._whiskerIqrFactor),this._box=d3Box(),this._tickFormat=null,this._renderDataPoints=!1,this._dataOpacity=.3,this._dataWidthPortion=.8,this._showOutliers=!0,this._boldOutlier=!1,this._yRangePadding=8,this._boxWidth=(innerChartWidth,xUnits)=>this.isOrdinal()?this.x().bandwidth():innerChartWidth/(1+this.boxPadding())/xUnits,this.x(d3Scale.scaleBand()),this.xUnits(units.ordinal),this.data(group=>group.all().map(d=>(d.map=accessor=>accessor.call(d,d),d)).filter(d=>{const values=this.valueAccessor()(d);return 0!==values.length})),this.boxPadding(.8),this.outerPadding(.5),this.anchor(parent,chartGroup)}boxPadding(padding){return arguments.length?this._rangeBandPadding(padding):this._rangeBandPadding()}outerPadding(padding){return arguments.length?this._outerRangeBandPadding(padding):this._outerRangeBandPadding()}boxWidth(boxWidth){return arguments.length?(this._boxWidth="function"==typeof boxWidth?boxWidth:utils.constant(boxWidth),this):this._boxWidth}_boxTransform(d,i){const xOffset=this.x()(this.keyAccessor()(d,i));return`translate(${xOffset}, 0)`}_preprocessData(){this.elasticX()&&this.x().domain([])}plotData(){this._calculatedBoxWidth=this._boxWidth(this.effectiveWidth(),this.xUnitCount()),this._box.whiskers(this._whiskers).width(this._calculatedBoxWidth).height(this.effectiveHeight()).value(this.valueAccessor()).domain(this.y().domain()).duration(this.transitionDuration()).tickFormat(this._tickFormat).renderDataPoints(this._renderDataPoints).dataOpacity(this._dataOpacity).dataWidthPortion(this._dataWidthPortion).renderTitle(this.renderTitle()).showOutliers(this._showOutliers).boldOutlier(this._boldOutlier);const boxesG=this.chartBodyG().selectAll("g.box").data(this.data(),this.keyAccessor()),boxesGEnterUpdate=this._renderBoxes(boxesG);this._updateBoxes(boxesGEnterUpdate),this._removeBoxes(boxesG),this.fadeDeselectedArea(this.filter())}_renderBoxes(boxesG){const boxesGEnter=boxesG.enter().append("g");return boxesGEnter.attr("class","box").classed("dc-tabbable",this._keyboardAccessible).attr("transform",(d,i)=>this._boxTransform(d,i)).call(this._box).on("click",d3compat.eventHandler(d=>{this.filter(this.keyAccessor()(d)),this.redrawGroup()})).selectAll("circle").classed("dc-tabbable",this._keyboardAccessible),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),boxesGEnter.merge(boxesG)}_updateBoxes(boxesG){const chart=this;transition(boxesG,this.transitionDuration(),this.transitionDelay()).attr("transform",(d,i)=>this._boxTransform(d,i)).call(this._box).each((function(d){const color=chart.getColor(d,0);d3Selection.select(this).select("rect.box").attr("fill",color),d3Selection.select(this).selectAll("circle.data").attr("fill",color)}))}_removeBoxes(boxesG){boxesG.exit().remove().call(this._box)}_minDataValue(){return d3Array.min(this.data(),e=>d3Array.min(this.valueAccessor()(e)))}_maxDataValue(){return d3Array.max(this.data(),e=>d3Array.max(this.valueAccessor()(e)))}_yAxisRangeRatio(){return(this._maxDataValue()-this._minDataValue())/this.effectiveHeight()}onClick(d){this.filter(this.keyAccessor()(d)),this.redrawGroup()}fadeDeselectedArea(brushSelection){const chart=this;if(this.hasFilter())if(this.isOrdinal())this.g().selectAll("g.box").each((function(d){chart.isSelectedNode(d)?chart.highlightSelected(this):chart.fadeDeselected(this)}));else{if(!this.brushOn()&&!this.parentBrushOn())return;const start=brushSelection[0],end=brushSelection[1];this.g().selectAll("g.box").each((function(d){const key=chart.keyAccessor()(d);key<start||key>=end?chart.fadeDeselected(this):chart.highlightSelected(this)}))}else this.g().selectAll("g.box").each((function(){chart.resetHighlight(this)}))}isSelectedNode(d){return this.hasFilter(this.keyAccessor()(d))}yAxisMin(){const padding=this._yRangePadding*this._yAxisRangeRatio();return utils.subtract(this._minDataValue()-padding,this.yAxisPadding())}yAxisMax(){const padding=this._yRangePadding*this._yAxisRangeRatio();return utils.add(this._maxDataValue()+padding,this.yAxisPadding())}tickFormat(tickFormat){return arguments.length?(this._tickFormat=tickFormat,this):this._tickFormat}yRangePadding(yRangePadding){return arguments.length?(this._yRangePadding=yRangePadding,this):this._yRangePadding}renderDataPoints(show){return arguments.length?(this._renderDataPoints=show,this):this._renderDataPoints}dataOpacity(opacity){return arguments.length?(this._dataOpacity=opacity,this):this._dataOpacity}dataWidthPortion(percentage){return arguments.length?(this._dataWidthPortion=percentage,this):this._dataWidthPortion}showOutliers(show){return arguments.length?(this._showOutliers=show,this):this._showOutliers}boldOutlier(show){return arguments.length?(this._boldOutlier=show,this):this._boldOutlier}}const boxPlot=(parent,chartGroup)=>new BoxPlot(parent,chartGroup);class BubbleChart extends(BubbleMixin(CoordinateGridMixin)){constructor(parent,chartGroup){super(),this.transitionDuration(750),this.transitionDelay(0),this.anchor(parent,chartGroup)}_bubbleLocator(d){return`translate(${this._bubbleX(d)},${this._bubbleY(d)})`}plotData(){this.calculateRadiusDomain(),this.r().range([this.MIN_RADIUS,this.xAxisLength()*this.maxBubbleRelativeSize()]);const data=this.data();let bubbleG=this.chartBodyG().selectAll(`g.${this.BUBBLE_NODE_CLASS}`).data(data,d=>d.key);(this.sortBubbleSize()||this.keyboardAccessible())&&bubbleG.order(),this._removeNodes(bubbleG),bubbleG=this._renderNodes(bubbleG),this._updateNodes(bubbleG),this.fadeDeselectedArea(this.filter())}_renderNodes(bubbleG){const bubbleGEnter=bubbleG.enter().append("g");return bubbleGEnter.attr("class",this.BUBBLE_NODE_CLASS).attr("transform",d=>this._bubbleLocator(d)).append("circle").attr("class",(d,i)=>`${this.BUBBLE_CLASS} _${i}`).on("click",d3compat.eventHandler(d=>this.onClick(d))).classed("dc-tabbable",this._keyboardAccessible).attr("fill",this.getColor).attr("r",0),bubbleG=bubbleGEnter.merge(bubbleG),transition(bubbleG,this.transitionDuration(),this.transitionDelay()).select(`circle.${this.BUBBLE_CLASS}`).attr("r",d=>this.bubbleR(d)).attr("opacity",d=>this.bubbleR(d)>0?1:0),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),this._doRenderLabel(bubbleGEnter),this._doRenderTitles(bubbleGEnter),bubbleG}_updateNodes(bubbleG){transition(bubbleG,this.transitionDuration(),this.transitionDelay()).attr("transform",d=>this._bubbleLocator(d)).select(`circle.${this.BUBBLE_CLASS}`).attr("fill",this.getColor).attr("r",d=>this.bubbleR(d)).attr("opacity",d=>this.bubbleR(d)>0?1:0),this.doUpdateLabels(bubbleG),this.doUpdateTitles(bubbleG)}_removeNodes(bubbleG){bubbleG.exit().remove()}_bubbleX(d){let x=this.x()(this.keyAccessor()(d));return!isNaN(x)&&isFinite(x)||(x=0),x}_bubbleY(d){let y=this.y()(this.valueAccessor()(d));return!isNaN(y)&&isFinite(y)||(y=0),y}renderBrush(){}redrawBrush(brushSelection,doTransition){this.fadeDeselectedArea(brushSelection)}}const bubbleChart=(parent,chartGroup)=>new BubbleChart(parent,chartGroup),BUBBLE_OVERLAY_CLASS="bubble-overlay",BUBBLE_NODE_CLASS="node",BUBBLE_CLASS="bubble";class BubbleOverlay extends(BubbleMixin(BaseMixin)){constructor(parent,chartGroup){super(),this._g=void 0,this._points=[],this._keyboardAccessible=!1,this.transitionDuration(750),this.transitionDelay(0),this.radiusValueAccessor(d=>d.value),this.anchor(parent,chartGroup)}point(name,x,y){return this._points.push({name:name,x:x,y:y}),this}_doRender(){return this._g=this._initOverlayG(),this.r().range([this.MIN_RADIUS,this.width()*this.maxBubbleRelativeSize()]),this._initializeBubbles(),this.fadeDeselectedArea(this.filter()),this}_initOverlayG(){return this._g=this.select("g.bubble-overlay"),this._g.empty()&&(this._g=this.svg().append("g").attr("class","bubble-overlay")),this._g}_initializeBubbles(){const data=this._mapData();this.calculateRadiusDomain(),this._points.forEach(point=>{const nodeG=this._getNodeG(point,data);let circle=nodeG.select("circle.bubble");circle.empty()&&(circle=nodeG.append("circle").attr("class","bubble").classed("dc-tabbable",this._keyboardAccessible).attr("r",0).attr("fill",this.getColor).on("click",d3compat.eventHandler(d=>this.onClick(d)))),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),transition(circle,this.transitionDuration(),this.transitionDelay()).attr("r",d=>this.bubbleR(d)),this._doRenderLabel(nodeG),this._doRenderTitles(nodeG)})}_mapData(){const data={};return this.data().forEach(datum=>{data[this.keyAccessor()(datum)]=datum}),data}_getNodeG(point,data){const bubbleNodeClass=`node ${utils.nameToId(point.name)}`;let nodeG=this._g.select(`g.${utils.nameToId(point.name)}`);return nodeG.empty()&&(nodeG=this._g.append("g").attr("class",bubbleNodeClass).attr("transform",`translate(${point.x},${point.y})`)),nodeG.datum(data[point.name]),nodeG}_doRedraw(){return this._updateBubbles(),this.fadeDeselectedArea(this.filter()),this}_updateBubbles(){const data=this._mapData();this.calculateRadiusDomain(),this._points.forEach(point=>{const nodeG=this._getNodeG(point,data),circle=nodeG.select("circle.bubble");transition(circle,this.transitionDuration(),this.transitionDelay()).attr("r",d=>this.bubbleR(d)).attr("fill",this.getColor),this.doUpdateLabels(nodeG),this.doUpdateTitles(nodeG)})}debug(flag){if(flag){let debugG=this.select(`g.${constants.DEBUG_GROUP_CLASS}`);debugG.empty()&&(debugG=this.svg().append("g").attr("class",constants.DEBUG_GROUP_CLASS));const debugText=debugG.append("text").attr("x",10).attr("y",20);debugG.append("rect").attr("width",this.width()).attr("height",this.height()).on("mousemove",d3compat.eventHandler((d,evt)=>{const position=d3compat.pointer(evt,debugG.node()),msg=`${position[0]}, ${position[1]}`;debugText.text(msg)}))}else this.selectAll(".debug").remove();return this}}const bubbleOverlay=(parent,chartGroup)=>new BubbleOverlay(parent,chartGroup),GROUP_CSS_CLASS="dc-cbox-group",ITEM_CSS_CLASS="dc-cbox-item";class CboxMenu extends BaseMixin{constructor(parent,chartGroup){super(),this._cbox=void 0,this._promptText="Select all",this._multiple=!1,this._inputType="radio",this._promptValue=null,this._uniqueId=utils.uniqueId(),this.data(group=>group.all().filter(this._filterDisplayed)),this._filterDisplayed=d=>this.valueAccessor()(d)>0,this._order=(a,b)=>this.keyAccessor()(a)>this.keyAccessor()(b)?1:this.keyAccessor()(a)<this.keyAccessor()(b)?-1:0,this.anchor(parent,chartGroup)}_doRender(){return this._doRedraw()}_doRedraw(){return this.select("ul").remove(),this._cbox=this.root().append("ul").classed("dc-cbox-group",!0),this._renderOptions(),this.hasFilter()&&this._multiple?this._cbox.selectAll("input").property("checked",d=>d&&this.filters().indexOf(String(this.keyAccessor()(d)))>=0||!1):this.hasFilter()&&this._cbox.selectAll("input").property("checked",d=>!!d&&this.keyAccessor()(d)===this.filter()),this}_renderOptions(){let options=this._cbox.selectAll("li.dc-cbox-item").data(this.data(),d=>this.keyAccessor()(d));options.exit().remove(),options=options.enter().append("li").classed("dc-cbox-item",!0).merge(options),options.append("input").attr("type",this._inputType).attr("value",d=>this.keyAccessor()(d)).attr("name",`domain_${this._uniqueId}`).attr("id",(d,i)=>`input_${this._uniqueId}_${i}`),options.append("label").attr("for",(d,i)=>`input_${this._uniqueId}_${i}`).text(this.title());const chart=this;if(this._multiple)this._cbox.append("li").append("input").attr("type","reset").text(this._promptText).on("click",d3compat.eventHandler((function(d,evt){return chart._onChange(d,evt,this)})));else{const li=this._cbox.append("li");li.append("input").attr("type",this._inputType).attr("value",this._promptValue).attr("name",`domain_${this._uniqueId}`).attr("id",(d,i)=>`input_${this._uniqueId}_all`).property("checked",!0),li.append("label").attr("for",(d,i)=>`input_${this._uniqueId}_all`).text(this._promptText)}return this._cbox.selectAll("li.dc-cbox-item").sort(this._order),this._cbox.on("change",d3compat.eventHandler((function(d,evt){return chart._onChange(d,evt,this)}))),options}_onChange(d,evt,element){let values;const target=d3Selection.select(evt.target);let options;target.datum()?(options=d3Selection.select(element).selectAll("input").filter((function(o){if(o)return this.checked})),values=options.nodes().map(option=>option.value),this._multiple||1!==values.length||(values=values[0])):values=this._promptValue||null,this.onChange(values)}onChange(val){val&&this._multiple?this.replaceFilter([val]):val?this.replaceFilter(val):this.filterAll(),events.trigger(()=>{this.redrawGroup()})}order(order){return arguments.length?(this._order=order,this):this._order}promptText(promptText){return arguments.length?(this._promptText=promptText,this):this._promptText}filterDisplayed(filterDisplayed){return arguments.length?(this._filterDisplayed=filterDisplayed,this):this._filterDisplayed}multiple(multiple){return arguments.length?(this._multiple=multiple,this._multiple?this._inputType="checkbox":this._inputType="radio",this):this._multiple}promptValue(promptValue){return arguments.length?(this._promptValue=promptValue,this):this._promptValue}}const cboxMenu=(parent,chartGroup)=>new CboxMenu(parent,chartGroup),SUB_CHART_CLASS="sub",DEFAULT_RIGHT_Y_AXIS_LABEL_PADDING=12;class CompositeChart extends CoordinateGridMixin{constructor(parent,chartGroup){super(),this._children=[],this._childOptions={},this._shareColors=!1,this._shareTitle=!0,this._alignYAxes=!1,this._rightYAxis=d3Axis.axisRight(),this._rightYAxisLabel=0,this._rightYAxisLabelPadding=12,this._rightY=void 0,this._rightAxisGridLines=!1,this._mandatoryAttributes([]),this.transitionDuration(500),this.transitionDelay(0),this.on("filtered.dcjs-composite-chart",chart=>{for(let i=0;i<this._children.length;++i)this._children[i].replaceFilter(this.filter())}),this.anchor(parent,chartGroup)}_generateG(){const g=super._generateG();for(let i=0;i<this._children.length;++i){const child=this._children[i];this._generateChildG(child,i),child.dimension()||child.dimension(this.dimension()),child.group()||child.group(this.group()),child.chartGroup(this.chartGroup()),child.svg(this.svg()),child.xUnits(this.xUnits()),child.transitionDuration(this.transitionDuration(),this.transitionDelay()),child.parentBrushOn(this.brushOn()),child.brushOn(!1),child.renderTitle(this.renderTitle()),child.elasticX(this.elasticX())}return g}rescale(){return super.rescale(),this._children.forEach(child=>{child.rescale()}),this}resizing(resizing){return arguments.length?(super.resizing(resizing),this._children.forEach(child=>{child.resizing(resizing)}),this):super.resizing()}_prepareYAxis(){const left=0!==this._leftYAxisChildren().length,right=0!==this._rightYAxisChildren().length,ranges=this._calculateYAxisRanges(left,right);left&&this._prepareLeftYAxis(ranges),right&&this._prepareRightYAxis(ranges),this._leftYAxisChildren().length>0&&!this._rightAxisGridLines?this._renderHorizontalGridLinesForAxis(this.g(),this.y(),this.yAxis()):this._rightYAxisChildren().length>0&&this._renderHorizontalGridLinesForAxis(this.g(),this._rightY,this._rightYAxis)}renderYAxis(){0!==this._leftYAxisChildren().length&&(this.renderYAxisAt("y",this.yAxis(),this.margins().left),this.renderYAxisLabel("y",this.yAxisLabel(),-90)),0!==this._rightYAxisChildren().length&&(this.renderYAxisAt("yr",this.rightYAxis(),this.width()-this.margins().right),this.renderYAxisLabel("yr",this.rightYAxisLabel(),90,this.width()-this._rightYAxisLabelPadding))}_calculateYAxisRanges(left,right){let lyAxisMin,lyAxisMax,ryAxisMin,ryAxisMax,ranges;return left&&(lyAxisMin=this._yAxisMin(),lyAxisMax=this._yAxisMax()),right&&(ryAxisMin=this._rightYAxisMin(),ryAxisMax=this._rightYAxisMax()),this.alignYAxes()&&left&&right&&(ranges=this._alignYAxisRanges(lyAxisMin,lyAxisMax,ryAxisMin,ryAxisMax)),ranges||{lyAxisMin:lyAxisMin,lyAxisMax:lyAxisMax,ryAxisMin:ryAxisMin,ryAxisMax:ryAxisMax}}_alignYAxisRanges(lyAxisMin,lyAxisMax,ryAxisMin,ryAxisMax){const extentRatio=(ryAxisMax-ryAxisMin)/(lyAxisMax-lyAxisMin);return{lyAxisMin:Math.min(lyAxisMin,ryAxisMin/extentRatio),lyAxisMax:Math.max(lyAxisMax,ryAxisMax/extentRatio),ryAxisMin:Math.min(ryAxisMin,lyAxisMin*extentRatio),ryAxisMax:Math.max(ryAxisMax,lyAxisMax*extentRatio)}}_prepareRightYAxis(ranges){const needDomain=void 0===this.rightY()||this.elasticY(),needRange=needDomain||this.resizing();void 0===this.rightY()&&this.rightY(d3Scale.scaleLinear()),needDomain&&this.rightY().domain([ranges.ryAxisMin,ranges.ryAxisMax]),needRange&&this.rightY().rangeRound([this.yAxisHeight(),0]),this.rightY().range([this.yAxisHeight(),0]),this.rightYAxis(this.rightYAxis().scale(this.rightY()))}_prepareLeftYAxis(ranges){const needDomain=void 0===this.y()||this.elasticY(),needRange=needDomain||this.resizing();void 0===this.y()&&this.y(d3Scale.scaleLinear()),needDomain&&this.y().domain([ranges.lyAxisMin,ranges.lyAxisMax]),needRange&&this.y().rangeRound([this.yAxisHeight(),0]),this.y().range([this.yAxisHeight(),0]),this.yAxis(this.yAxis().scale(this.y()))}_generateChildG(child,i){child._generateG(this.g()),child.g().attr("class",`sub _${i}`)}plotData(){for(let i=0;i<this._children.length;++i){const child=this._children[i];child.g()||this._generateChildG(child,i),this._shareColors&&child.colors(this.colors()),child.x(this.x()),child.xAxis(this.xAxis()),child.useRightYAxis()?(child.y(this.rightY()),child.yAxis(this.rightYAxis())):(child.y(this.y()),child.yAxis(this.yAxis())),child.plotData(),child._activateRenderlets()}}useRightAxisGridLines(useRightAxisGridLines){return arguments?(this._rightAxisGridLines=useRightAxisGridLines,this):this._rightAxisGridLines}childOptions(childOptions){return arguments.length?(this._childOptions=childOptions,this._children.forEach(child=>{child.options(this._childOptions)}),this):this._childOptions}fadeDeselectedArea(brushSelection){if(this.brushOn())for(let i=0;i<this._children.length;++i){const child=this._children[i];child.fadeDeselectedArea(brushSelection)}}rightYAxisLabel(rightYAxisLabel,padding){return arguments.length?(this._rightYAxisLabel=rightYAxisLabel,this.margins().right-=this._rightYAxisLabelPadding,this._rightYAxisLabelPadding=void 0===padding?12:padding,this.margins().right+=this._rightYAxisLabelPadding,this):this._rightYAxisLabel}compose(subChartArray){return this._children=subChartArray,this._children.forEach(child=>{child.height(this.height()),child.width(this.width()),child.margins(this.margins()),this._shareTitle&&child.title(this.title()),child.options(this._childOptions)}),this.rescale(),this}_setChildrenProperty(prop,value){this._children.forEach(child=>{child[prop](value)})}height(height){return arguments.length?(super.height(height),this._setChildrenProperty("height",height),this):super.height()}width(width){return arguments.length?(super.width(width),this._setChildrenProperty("width",width),this):super.width()}margins(margins){return arguments.length?(super.margins(margins),this._setChildrenProperty("margins",margins),this):super.margins()}children(){return this._children}shareColors(shareColors){return arguments.length?(this._shareColors=shareColors,this):this._shareColors}shareTitle(shareTitle){return arguments.length?(this._shareTitle=shareTitle,this):this._shareTitle}rightY(yScale){return arguments.length?(this._rightY=yScale,this.rescale(),this):this._rightY}alignYAxes(alignYAxes){return arguments.length?(this._alignYAxes=alignYAxes,this.rescale(),this):this._alignYAxes}_leftYAxisChildren(){return this._children.filter(child=>!child.useRightYAxis())}_rightYAxisChildren(){return this._children.filter(child=>child.useRightYAxis())}_getYAxisMin(charts){return charts.map(c=>c.yAxisMin())}_yAxisMin(){return d3Array.min(this._getYAxisMin(this._leftYAxisChildren()))}_rightYAxisMin(){return d3Array.min(this._getYAxisMin(this._rightYAxisChildren()))}_getYAxisMax(charts){return charts.map(c=>c.yAxisMax())}_yAxisMax(){return utils.add(d3Array.max(this._getYAxisMax(this._leftYAxisChildren())),this.yAxisPadding())}_rightYAxisMax(){return utils.add(d3Array.max(this._getYAxisMax(this._rightYAxisChildren())),this.yAxisPadding())}_getAllXAxisMinFromChildCharts(){return this._children.map(c=>c.xAxisMin())}xAxisMin(){return utils.subtract(d3Array.min(this._getAllXAxisMinFromChildCharts()),this.xAxisPadding(),this.xAxisPaddingUnit())}_getAllXAxisMaxFromChildCharts(){return this._children.map(c=>c.xAxisMax())}xAxisMax(){return utils.add(d3Array.max(this._getAllXAxisMaxFromChildCharts()),this.xAxisPadding(),this.xAxisPaddingUnit())}legendables(){return this._children.reduce((items,child)=>(this._shareColors&&child.colors(this.colors()),items.push.apply(items,child.legendables()),items),[])}legendHighlight(d){for(let j=0;j<this._children.length;++j){const child=this._children[j];child.legendHighlight(d)}}legendReset(d){for(let j=0;j<this._children.length;++j){const child=this._children[j];child.legendReset(d)}}legendToggle(){console.log("composite should not be getting legendToggle itself")}rightYAxis(rightYAxis){return arguments.length?(this._rightYAxis=rightYAxis,this):this._rightYAxis}yAxisMin(){throw new Error("Not supported for this chart type")}yAxisMax(){throw new Error("Not supported for this chart type")}}const compositeChart=(parent,chartGroup)=>new CompositeChart(parent,chartGroup);class DataCount extends BaseMixin{constructor(parent,chartGroup){super(),this._formatNumber=d3Format.format(",d"),this._crossfilter=null,this._groupAll=null,this._html={some:"",all:""},this._mandatoryAttributes(["crossfilter","groupAll"]),this.anchor(parent,chartGroup)}html(options){return arguments.length?(options.all&&(this._html.all=options.all),options.some&&(this._html.some=options.some),this):this._html}formatNumber(formatter){return arguments.length?(this._formatNumber=formatter,this):this._formatNumber}_doRender(){const tot=this.crossfilter().size(),val=this.groupAll().value(),all=this._formatNumber(tot),selected=this._formatNumber(val);return tot===val&&""!==this._html.all?this.root().html(this._html.all.replace("%total-count",all).replace("%filter-count",selected)):""!==this._html.some?this.root().html(this._html.some.replace("%total-count",all).replace("%filter-count",selected)):(this.selectAll(".total-count").text(all),this.selectAll(".filter-count").text(selected)),this}_doRedraw(){return this._doRender()}crossfilter(cf){return arguments.length?(this._crossfilter=cf,this):this._crossfilter}dimension(cf){return logger.warnOnce("consider using dataCount.crossfilter instead of dataCount.dimension for clarity"),arguments.length?this.crossfilter(cf):this.crossfilter()}groupAll(groupAll){return arguments.length?(this._groupAll=groupAll,this):this._groupAll}group(groupAll){return logger.warnOnce("consider using dataCount.groupAll instead of dataCount.group for clarity"),arguments.length?this.groupAll(groupAll):this.groupAll()}}const dataCount=(parent,chartGroup)=>new DataCount(parent,chartGroup),LABEL_CSS_CLASS="dc-grid-label",ITEM_CSS_CLASS$1="dc-grid-item",SECTION_CSS_CLASS="dc-grid-section dc-grid-group",GRID_CSS_CLASS="dc-grid-top";class DataGrid extends BaseMixin{constructor(parent,chartGroup){super(),this._section=null,this._size=999,this._html=function(d){return`you need to provide an html() handling param:  ${JSON.stringify(d)}`},this._sortBy=function(d){return d},this._order=d3Array.ascending,this._beginSlice=0,this._endSlice=void 0,this._htmlSection=d=>`<div class='${SECTION_CSS_CLASS}'><h1 class='dc-grid-label'>${this.keyAccessor()(d)}</h1></div>`,this._mandatoryAttributes(["dimension","section"]),this.anchor(parent,chartGroup)}_doRender(){return this.selectAll("div.dc-grid-top").remove(),this._renderItems(this._renderSections()),this}_renderSections(){const sections=this.root().selectAll("div.dc-grid-top").data(this._nestEntries(),d=>this.keyAccessor()(d)),itemSection=sections.enter().append("div").attr("class","dc-grid-top");return this._htmlSection&&itemSection.html(d=>this._htmlSection(d)),sections.exit().remove(),itemSection}_nestEntries(){let entries=this.dimension().top(this._size);return entries=entries.sort((a,b)=>this._order(this._sortBy(a),this._sortBy(b))).slice(this._beginSlice,this._endSlice),d3compat.nester({key:this.section(),sortKeys:this._order,entries:entries})}_renderItems(sections){let items=sections.order().selectAll("div.dc-grid-item").data(d=>d.values);return items.exit().remove(),items=items.enter().append("div").attr("class","dc-grid-item").html(d=>this._html(d)).merge(items),items}_doRedraw(){return this._doRender()}section(section){return arguments.length?(this._section=section,this):this._section}group(section){return logger.warnOnce("consider using dataGrid.section instead of dataGrid.group for clarity"),arguments.length?this.section(section):this.section()}beginSlice(beginSlice){return arguments.length?(this._beginSlice=beginSlice,this):this._beginSlice}endSlice(endSlice){return arguments.length?(this._endSlice=endSlice,this):this._endSlice}size(size){return arguments.length?(this._size=size,this):this._size}html(html){return arguments.length?(this._html=html,this):this._html}htmlSection(htmlSection){return arguments.length?(this._htmlSection=htmlSection,this):this._htmlSection}htmlGroup(htmlSection){return logger.warnOnce("consider using dataGrid.htmlSection instead of dataGrid.htmlGroup for clarity"),arguments.length?this.htmlSection(htmlSection):this.htmlSection()}sortBy(sortByFunction){return arguments.length?(this._sortBy=sortByFunction,this):this._sortBy}order(order){return arguments.length?(this._order=order,this):this._order}}const dataGrid=(parent,chartGroup)=>new DataGrid(parent,chartGroup),LABEL_CSS_CLASS$1="dc-table-label",ROW_CSS_CLASS="dc-table-row",COLUMN_CSS_CLASS="dc-table-column",SECTION_CSS_CLASS$1="dc-table-section dc-table-group",HEAD_CSS_CLASS="dc-table-head";class DataTable extends BaseMixin{constructor(parent,chartGroup){super(),this._size=25,this._columns=[],this._sortBy=d=>d,this._order=d3Array.ascending,this._beginSlice=0,this._endSlice=void 0,this._showSections=!0,this._section=()=>"",this._mandatoryAttributes(["dimension"]),this.anchor(parent,chartGroup)}_doRender(){return this.selectAll("tbody").remove(),this._renderRows(this._renderSections()),this}_doColumnValueFormat(v,d){return"function"==typeof v?v(d):"string"==typeof v?d[v]:v.format(d)}_doColumnHeaderFormat(d){return"function"==typeof d?this._doColumnHeaderFnToString(d):"string"==typeof d?this._doColumnHeaderCapitalize(d):String(d.label)}_doColumnHeaderCapitalize(s){return s.charAt(0).toUpperCase()+s.slice(1)}_doColumnHeaderFnToString(f){let s=String(f);const i1=s.indexOf("return ");if(i1>=0){const i2=s.lastIndexOf(";");if(i2>=0){s=s.substring(i1+7,i2);const i3=s.indexOf("numberFormat");i3>=0&&(s=s.replace("numberFormat",""))}}return s}_renderSections(){let bAllFunctions=!0;if(this._columns.forEach(f=>{bAllFunctions&="function"==typeof f}),!bAllFunctions){let thead=this.selectAll("thead").data([0]);thead.exit().remove(),thead=thead.enter().append("thead").merge(thead);let headrow=thead.selectAll("tr").data([0]);headrow.exit().remove(),headrow=headrow.enter().append("tr").merge(headrow);const headcols=headrow.selectAll("th").data(this._columns);headcols.exit().remove(),headcols.enter().append("th").merge(headcols).attr("class",HEAD_CSS_CLASS).html(d=>this._doColumnHeaderFormat(d))}const sections=this.root().selectAll("tbody").data(this._nestEntries(),d=>this.keyAccessor()(d)),rowSection=sections.enter().append("tbody");return!0===this._showSections&&rowSection.append("tr").attr("class",SECTION_CSS_CLASS$1).append("td").attr("class","dc-table-label").attr("colspan",this._columns.length).html(d=>this.keyAccessor()(d)),sections.exit().remove(),rowSection}_nestEntries(){let entries;return entries=this._order===d3Array.ascending?this.dimension().bottom(this._size):this.dimension().top(this._size),entries=entries.sort((a,b)=>this._order(this._sortBy(a),this._sortBy(b))).slice(this._beginSlice,this._endSlice),d3compat.nester({key:this.section(),sortKeys:this._order,entries:entries})}_renderRows(sections){const rows=sections.order().selectAll("tr.dc-table-row").data(d=>d.values),rowEnter=rows.enter().append("tr").attr("class",ROW_CSS_CLASS);return this._columns.forEach((v,i)=>{rowEnter.append("td").attr("class",`dc-table-column _${i}`).html(d=>this._doColumnValueFormat(v,d))}),rows.exit().remove(),rows}_doRedraw(){return this._doRender()}section(section){return arguments.length?(this._section=section,this):this._section}group(section){return logger.warnOnce("consider using dataTable.section instead of dataTable.group for clarity"),arguments.length?this.section(section):this.section()}size(size){return arguments.length?(this._size=size,this):this._size}beginSlice(beginSlice){return arguments.length?(this._beginSlice=beginSlice,this):this._beginSlice}endSlice(endSlice){return arguments.length?(this._endSlice=endSlice,this):this._endSlice}columns(columns){return arguments.length?(this._columns=columns,this):this._columns}sortBy(sortBy){return arguments.length?(this._sortBy=sortBy,this):this._sortBy}order(order){return arguments.length?(this._order=order,this):this._order}showSections(showSections){return arguments.length?(this._showSections=showSections,this):this._showSections}showGroups(showSections){return logger.warnOnce("consider using dataTable.showSections instead of dataTable.showGroups for clarity"),arguments.length?this.showSections(showSections):this.showSections()}}const dataTable=(parent,chartGroup)=>new DataTable(parent,chartGroup);class GeoChoroplethChart extends(ColorMixin(BaseMixin)){constructor(parent,chartGroup){super(),this.colorAccessor(d=>d||0),this._geoPath=d3Geo.geoPath(),this._projectionFlag=void 0,this._projection=void 0,this._geoJsons=[],this.anchor(parent,chartGroup)}_doRender(){this.resetSvg();for(let layerIndex=0;layerIndex<this._geoJsons.length;++layerIndex){const states=this.svg().append("g").attr("class",`layer${layerIndex}`);let regionG=states.selectAll(`g.${this._geoJson(layerIndex).name}`).data(this._geoJson(layerIndex).data);regionG=regionG.enter().append("g").attr("class",this._geoJson(layerIndex).name).merge(regionG),regionG.append("path").classed("dc-tabbable",this._keyboardAccessible).attr("fill","white").attr("d",this._getGeoPath()),regionG.append("title"),this._plotData(layerIndex)}this._projectionFlag=!1}_plotData(layerIndex){const data=this._generateLayeredData();if(this._isDataLayer(layerIndex)){const regionG=this._renderRegionG(layerIndex);this._renderPaths(regionG,layerIndex,data),this._renderTitles(regionG,layerIndex,data)}}_generateLayeredData(){const data={},groupAll=this.data();for(let i=0;i<groupAll.length;++i)data[this.keyAccessor()(groupAll[i])]=this.valueAccessor()(groupAll[i]);return data}_isDataLayer(layerIndex){return this._geoJson(layerIndex).keyAccessor}_renderRegionG(layerIndex){const regionG=this.svg().selectAll(this._layerSelector(layerIndex)).classed("selected",d=>this._isSelected(layerIndex,d)).classed("deselected",d=>this._isDeselected(layerIndex,d)).attr("class",d=>{const layerNameClass=this._geoJson(layerIndex).name,regionClass=utils.nameToId(this._geoJson(layerIndex).keyAccessor(d));let baseClasses=`${layerNameClass} ${regionClass}`;return this._isSelected(layerIndex,d)&&(baseClasses+=" selected"),this._isDeselected(layerIndex,d)&&(baseClasses+=" deselected"),baseClasses});return regionG}_layerSelector(layerIndex){return`g.layer${layerIndex} g.${this._geoJson(layerIndex).name}`}_isSelected(layerIndex,d){return this.hasFilter()&&this.hasFilter(this._getKey(layerIndex,d))}_isDeselected(layerIndex,d){return this.hasFilter()&&!this.hasFilter(this._getKey(layerIndex,d))}_getKey(layerIndex,d){return this._geoJson(layerIndex).keyAccessor(d)}_geoJson(index){return this._geoJsons[index]}_renderPaths(regionG,layerIndex,data){const paths=regionG.select("path").attr("fill",(function(){const currentFill=d3Selection.select(this).attr("fill");return currentFill||"none"})).on("click",d3compat.eventHandler(d=>this.onClick(d,layerIndex)));this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick,layerIndex),transition(paths,this.transitionDuration(),this.transitionDelay()).attr("fill",(d,i)=>this.getColor(data[this._geoJson(layerIndex).keyAccessor(d)],i))}onClick(d,layerIndex){const selectedRegion=this._geoJson(layerIndex).keyAccessor(d);events.trigger(()=>{this.filter(selectedRegion),this.redrawGroup()})}_renderTitles(regionG,layerIndex,data){this.renderTitle()&&regionG.selectAll("title").text(d=>{const key=this._getKey(layerIndex,d),value=data[key];return this.title()({key:key,value:value})})}_doRedraw(){for(let layerIndex=0;layerIndex<this._geoJsons.length;++layerIndex)this._plotData(layerIndex),this._projectionFlag&&this.svg().selectAll(`g.${this._geoJson(layerIndex).name} path`).attr("d",this._getGeoPath());this._projectionFlag=!1}overlayGeoJson(json,name,keyAccessor){for(let i=0;i<this._geoJsons.length;++i)if(this._geoJsons[i].name===name)return this._geoJsons[i].data=json,this._geoJsons[i].keyAccessor=keyAccessor,this;return this._geoJsons.push({name:name,data:json,keyAccessor:keyAccessor}),this}projection(projection){return arguments.length?(this._projection=projection,this._projectionFlag=!0,this):this._projection}_getGeoPath(){return void 0===this._projection?(logger.warn("choropleth projection default of geoAlbers is deprecated, in next version projection will need to be set explicitly"),this._geoPath.projection(d3Geo.geoAlbersUsa())):this._geoPath.projection(this._projection)}geoJsons(){return this._geoJsons}geoPath(){return this._geoPath}removeGeoJson(name){const geoJsons=[];for(let i=0;i<this._geoJsons.length;++i){const layer=this._geoJsons[i];layer.name!==name&&geoJsons.push(layer)}return this._geoJsons=geoJsons,this}}const geoChoroplethChart=(parent,chartGroup)=>new GeoChoroplethChart(parent,chartGroup),DEFAULT_BORDER_RADIUS=6.75;class HeatMap extends(ColorMixin(MarginMixin)){constructor(parent,chartGroup){super(),this._chartBody=void 0,this._cols=void 0,this._rows=void 0,this._colOrdering=d3Array.ascending,this._rowOrdering=d3Array.ascending,this._colScale=d3Scale.scaleBand(),this._rowScale=d3Scale.scaleBand(),this._xBorderRadius=6.75,this._yBorderRadius=6.75,this._mandatoryAttributes(["group"]),this.title(this.colorAccessor()),this._colsLabel=d=>d,this._rowsLabel=d=>d,this._xAxisOnClick=d=>{this._filterAxis(0,d)},this._yAxisOnClick=d=>{this._filterAxis(1,d)},this._boxOnClick=d=>{const filter=d.key;events.trigger(()=>{this.filter(filters.TwoDimensionalFilter(filter)),this.redrawGroup()})},this.anchor(parent,chartGroup)}colsLabel(labelFunction){return arguments.length?(this._colsLabel=labelFunction,this):this._colsLabel}rowsLabel(labelFunction){return arguments.length?(this._rowsLabel=labelFunction,this):this._rowsLabel}_filterAxis(axis,value){const cellsOnAxis=this.selectAll(".box-group").filter(d=>d.key[axis]===value),unfilteredCellsOnAxis=cellsOnAxis.filter(d=>!this.hasFilter(d.key));events.trigger(()=>{const selection=unfilteredCellsOnAxis.empty()?cellsOnAxis:unfilteredCellsOnAxis,filtersList=selection.data().map(kv=>filters.TwoDimensionalFilter(kv.key));this.filter([filtersList]),this.redrawGroup()})}filter(filter){const nonstandardFilter=f=>(logger.warnOnce("heatmap.filter taking a coordinate is deprecated - please pass dc.filters.TwoDimensionalFilter instead"),this._filter(filters.TwoDimensionalFilter(f)));return arguments.length?null===filter||"TwoDimensionalFilter"===filter.filterType||Array.isArray(filter)&&Array.isArray(filter[0])&&"TwoDimensionalFilter"===filter[0][0].filterType?super.filter(filter):nonstandardFilter(filter):super.filter()}rows(rows){return arguments.length?(this._rows=rows,this):this._rows}rowOrdering(rowOrdering){return arguments.length?(this._rowOrdering=rowOrdering,this):this._rowOrdering}cols(cols){return arguments.length?(this._cols=cols,this):this._cols}colOrdering(colOrdering){return arguments.length?(this._colOrdering=colOrdering,this):this._colOrdering}_doRender(){return this.resetSvg(),this._chartBody=this.svg().append("g").attr("class","heatmap").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this._doRedraw()}_doRedraw(){const data=this.data();let rows=this.rows()||data.map(this.valueAccessor()),cols=this.cols()||data.map(this.keyAccessor());this._rowOrdering&&(rows=rows.sort(this._rowOrdering)),this._colOrdering&&(cols=cols.sort(this._colOrdering)),rows=this._rowScale.domain(rows),cols=this._colScale.domain(cols);const rowCount=rows.domain().length,colCount=cols.domain().length,boxWidth=Math.floor(this.effectiveWidth()/colCount),boxHeight=Math.floor(this.effectiveHeight()/rowCount);cols.rangeRound([0,this.effectiveWidth()]),rows.rangeRound([this.effectiveHeight(),0]);let boxes=this._chartBody.selectAll("g.box-group").data(this.data(),(d,i)=>`${this.keyAccessor()(d,i)}\0${this.valueAccessor()(d,i)}`);boxes.exit().remove();const gEnter=boxes.enter().append("g").attr("class","box-group");gEnter.append("rect").attr("class","heat-box").classed("dc-tabbable",this._keyboardAccessible).attr("fill","white").attr("x",(d,i)=>cols(this.keyAccessor()(d,i))).attr("y",(d,i)=>rows(this.valueAccessor()(d,i))).on("click",d3compat.eventHandler(this.boxOnClick())),this._keyboardAccessible&&this._makeKeyboardAccessible(this.boxOnClick),boxes=gEnter.merge(boxes),this.renderTitle()&&(gEnter.append("title"),boxes.select("title").text(this.title())),transition(boxes.select("rect"),this.transitionDuration(),this.transitionDelay()).attr("x",(d,i)=>cols(this.keyAccessor()(d,i))).attr("y",(d,i)=>rows(this.valueAccessor()(d,i))).attr("rx",this._xBorderRadius).attr("ry",this._yBorderRadius).attr("fill",this.getColor).attr("width",boxWidth).attr("height",boxHeight);let gCols=this._chartBody.select("g.cols");gCols.empty()&&(gCols=this._chartBody.append("g").attr("class","cols axis"));let gColsText=gCols.selectAll("text").data(cols.domain());gColsText.exit().remove(),gColsText=gColsText.enter().append("text").attr("x",d=>cols(d)+boxWidth/2).style("text-anchor","middle").attr("y",this.effectiveHeight()).attr("dy",12).on("click",d3compat.eventHandler(this.xAxisOnClick())).text(this.colsLabel()).merge(gColsText),transition(gColsText,this.transitionDuration(),this.transitionDelay()).text(this.colsLabel()).attr("x",d=>cols(d)+boxWidth/2).attr("y",this.effectiveHeight());let gRows=this._chartBody.select("g.rows");gRows.empty()&&(gRows=this._chartBody.append("g").attr("class","rows axis"));let gRowsText=gRows.selectAll("text").data(rows.domain());if(gRowsText.exit().remove(),gRowsText=gRowsText.enter().append("text").style("text-anchor","end").attr("x",0).attr("dx",-2).attr("y",d=>rows(d)+boxHeight/2).attr("dy",6).on("click",d3compat.eventHandler(this.yAxisOnClick())).text(this.rowsLabel()).merge(gRowsText),transition(gRowsText,this.transitionDuration(),this.transitionDelay()).text(this.rowsLabel()).attr("y",d=>rows(d)+boxHeight/2),this.hasFilter()){const chart=this;this.selectAll("g.box-group").each((function(d){chart.isSelectedNode(d)?chart.highlightSelected(this):chart.fadeDeselected(this)}))}else{const chart=this;this.selectAll("g.box-group").each((function(){chart.resetHighlight(this)}))}return this}boxOnClick(handler){return arguments.length?(this._boxOnClick=handler,this):this._boxOnClick}xAxisOnClick(handler){return arguments.length?(this._xAxisOnClick=handler,this):this._xAxisOnClick}yAxisOnClick(handler){return arguments.length?(this._yAxisOnClick=handler,this):this._yAxisOnClick}xBorderRadius(xBorderRadius){return arguments.length?(this._xBorderRadius=xBorderRadius,this):this._xBorderRadius}yBorderRadius(yBorderRadius){return arguments.length?(this._yBorderRadius=yBorderRadius,this):this._yBorderRadius}isSelectedNode(d){return this.hasFilter(d.key)}}const heatMap=(parent,chartGroup)=>new HeatMap(parent,chartGroup);class HtmlLegend{constructor(){this._htmlLegendDivCssClass="dc-html-legend",this._legendItemCssClassHorizontal="dc-legend-item-horizontal",this._legendItemCssClassVertical="dc-legend-item-vertical",this._parent=void 0,this._container=void 0,this._legendText=pluck("name"),this._maxItems=void 0,this._horizontal=!1,this._legendItemClass=void 0,this._highlightSelected=!1,this._keyboardAccessible=!1}parent(p){return arguments.length?(this._parent=p,this):this._parent}render(){this._defaultLegendItemCssClass=this._horizontal?this._legendItemCssClassHorizontal:this._legendItemCssClassVertical,this._container.select(`div.${this._htmlLegendDivCssClass}`).remove();const container=this._container.append("div").attr("class",this._htmlLegendDivCssClass);container.attr("style",`max-width:${this._container.nodes()[0].style.width}`);let legendables=this._parent.legendables();const filters=this._parent.filters();void 0!==this._maxItems&&(legendables=legendables.slice(0,this._maxItems));const legendItemClassName=this._legendItemClass?this._legendItemClass:this._defaultLegendItemCssClass,itemEnter=container.selectAll(`div.${legendItemClassName}`).data(legendables).enter().append("div").classed(legendItemClassName,!0).on("mouseover",d3compat.eventHandler(d=>this._parent.legendHighlight(d))).on("mouseout",d3compat.eventHandler(d=>this._parent.legendReset(d))).on("click",d3compat.eventHandler(d=>this._parent.legendToggle(d)));this._highlightSelected&&itemEnter.classed(constants.SELECTED_CLASS,d=>-1!==filters.indexOf(d.name)),itemEnter.append("span").attr("class","dc-legend-item-color").style("background-color",pluck("color")),itemEnter.append("span").attr("class","dc-legend-item-label").classed("dc-tabbable",this._keyboardAccessible).attr("title",this._legendText).text(this._legendText),this._keyboardAccessible&&this._makeLegendKeyboardAccessible()}container(container){return arguments.length?(this._container=d3Selection.select(container),this):this._container}legendItemClass(legendItemClass){return arguments.length?(this._legendItemClass=legendItemClass,this):this._legendItemClass}highlightSelected(highlightSelected){return arguments.length?(this._highlightSelected=highlightSelected,this):this._highlightSelected}horizontal(horizontal){return arguments.length?(this._horizontal=horizontal,this):this._horizontal}legendText(legendText){return arguments.length?(this._legendText=legendText,this):this._legendText}maxItems(maxItems){return arguments.length?(this._maxItems=utils.isNumber(maxItems)?maxItems:void 0,this):this._maxItems}keyboardAccessible(keyboardAccessible){return arguments.length?(this._keyboardAccessible=keyboardAccessible,this):this._keyboardAccessible}_makeLegendKeyboardAccessible(){this._parent._svgDescription||(this._parent.svg().append("desc").attr("id",`desc-id-${this._parent.__dcFlag__}`).html(`${this._parent.svgDescription()}`),this._parent.svg().attr("tabindex","0").attr("role","img").attr("aria-labelledby",`desc-id-${this._parent.__dcFlag__}`));const tabElements=this.container().selectAll(".dc-legend-item-label.dc-tabbable").attr("tabindex",0);tabElements.on("keydown",d3compat.eventHandler((d,event)=>{13===event.keyCode&&"object"==typeof d&&d.chart.legendToggle(d),32===event.keyCode&&"object"==typeof d&&(d.chart.legendToggle(d),event.preventDefault())})).on("focus",d3compat.eventHandler(d=>{this._parent.legendHighlight(d)})).on("blur",d3compat.eventHandler(d=>{this._parent.legendReset(d)}))}}const htmlLegend=()=>new HtmlLegend,LABEL_GAP=2;class Legend{constructor(){this._parent=void 0,this._x=0,this._y=0,this._itemHeight=12,this._gap=5,this._horizontal=!1,this._legendWidth=560,this._itemWidth=70,this._autoItemWidth=!1,this._legendText=pluck("name"),this._maxItems=void 0,this._highlightSelected=!1,this._keyboardAccessible=!1,this._g=void 0}parent(p){return arguments.length?(this._parent=p,this):this._parent}x(x){return arguments.length?(this._x=x,this):this._x}y(y){return arguments.length?(this._y=y,this):this._y}gap(gap){return arguments.length?(this._gap=gap,this):this._gap}highlightSelected(highlightSelected){return arguments.length?(this._highlightSelected=highlightSelected,this):this._highlightSelected}itemHeight(itemHeight){return arguments.length?(this._itemHeight=itemHeight,this):this._itemHeight}horizontal(horizontal){return arguments.length?(this._horizontal=horizontal,this):this._horizontal}legendWidth(legendWidth){return arguments.length?(this._legendWidth=legendWidth,this):this._legendWidth}itemWidth(itemWidth){return arguments.length?(this._itemWidth=itemWidth,this):this._itemWidth}autoItemWidth(autoItemWidth){return arguments.length?(this._autoItemWidth=autoItemWidth,this):this._autoItemWidth}legendText(legendText){return arguments.length?(this._legendText=legendText,this):this._legendText}maxItems(maxItems){return arguments.length?(this._maxItems=utils.isNumber(maxItems)?maxItems:void 0,this):this._maxItems}keyboardAccessible(keyboardAccessible){return arguments.length?(this._keyboardAccessible=keyboardAccessible,this):this._keyboardAccessible}_legendItemHeight(){return this._gap+this._itemHeight}_makeLegendKeyboardAccessible(){this._parent._svgDescription||(this._parent.svg().append("desc").attr("id",`desc-id-${this._parent.__dcFlag__}`).html(`${this._parent.svgDescription()}`),this._parent.svg().attr("tabindex","0").attr("role","img").attr("aria-labelledby",`desc-id-${this._parent.__dcFlag__}`));const tabElements=this._parent.svg().selectAll(".dc-legend .dc-tabbable").attr("tabindex",0);tabElements.on("keydown",d3compat.eventHandler((d,event)=>{13===event.keyCode&&"object"==typeof d&&d.chart.legendToggle(d),32===event.keyCode&&"object"==typeof d&&(d.chart.legendToggle(d),event.preventDefault())})).on("focus",d3compat.eventHandler(d=>{this._parent.legendHighlight(d)})).on("blur",d3compat.eventHandler(d=>{this._parent.legendReset(d)}))}render(){this._parent.svg().select("g.dc-legend").remove(),this._g=this._parent.svg().append("g").attr("class","dc-legend").attr("transform",`translate(${this._x},${this._y})`);let legendables=this._parent.legendables();const filters=this._parent.filters();void 0!==this._maxItems&&(legendables=legendables.slice(0,this._maxItems));const itemEnter=this._g.selectAll("g.dc-legend-item").data(legendables).enter().append("g").attr("class","dc-legend-item").on("mouseover",d3compat.eventHandler(d=>{this._parent.legendHighlight(d)})).on("mouseout",d3compat.eventHandler(d=>{this._parent.legendReset(d)})).on("click",d3compat.eventHandler(d=>{d.chart.legendToggle(d)}));this._highlightSelected&&itemEnter.classed(constants.SELECTED_CLASS,d=>-1!==filters.indexOf(d.name)),this._g.selectAll("g.dc-legend-item").classed("fadeout",d=>d.chart.isLegendableHidden(d)),legendables.some(pluck("dashstyle"))?itemEnter.append("line").attr("x1",0).attr("y1",this._itemHeight/2).attr("x2",this._itemHeight).attr("y2",this._itemHeight/2).attr("stroke-width",2).attr("stroke-dasharray",pluck("dashstyle")).attr("stroke",pluck("color")):itemEnter.append("rect").attr("width",this._itemHeight).attr("height",this._itemHeight).attr("fill",d=>d?d.color:"blue");{const self=this;itemEnter.append("text").text(self._legendText).classed("dc-tabbable",this._keyboardAccessible).attr("x",self._itemHeight+2).attr("y",(function(){return self._itemHeight/2+(this.clientHeight?this.clientHeight:13)/2-2})),this._keyboardAccessible&&this._makeLegendKeyboardAccessible()}let cumulativeLegendTextWidth=0,row=0;{const self=this;itemEnter.attr("transform",(function(d,i){if(self._horizontal){const itemWidth=!0===self._autoItemWidth?this.getBBox().width+self._gap:self._itemWidth;cumulativeLegendTextWidth+itemWidth>self._legendWidth&&cumulativeLegendTextWidth>0&&(++row,cumulativeLegendTextWidth=0);const translateBy=`translate(${cumulativeLegendTextWidth},${row*self._legendItemHeight()})`;return cumulativeLegendTextWidth+=itemWidth,translateBy}return`translate(0,${i*self._legendItemHeight()})`}))}}}const legend=()=>new Legend,DEFAULT_DOT_RADIUS=5,TOOLTIP_G_CLASS="dc-tooltip",DOT_CIRCLE_CLASS="dot",Y_AXIS_REF_LINE_CLASS="yRef",X_AXIS_REF_LINE_CLASS="xRef",DEFAULT_DOT_OPACITY=1e-6,LABEL_PADDING$1=3;class LineChart extends StackMixin{constructor(parent,chartGroup){super(),this._renderArea=!1,this._dotRadius=5,this._dataPointRadius=null,this._dataPointFillOpacity=1e-6,this._dataPointStrokeOpacity=1e-6,this._curve=null,this._interpolate=null,this._tension=null,this._defined=void 0,this._dashStyle=void 0,this._xyTipsOn=!0,this.transitionDuration(500),this.transitionDelay(0),this._rangeBandPadding(1),this.label(d=>utils.printSingleValue(d.y0+d.y),!1),this.anchor(parent,chartGroup)}plotData(){const chartBody=this.chartBodyG();let layersList=chartBody.select("g.stack-list");layersList.empty()&&(layersList=chartBody.append("g").attr("class","stack-list"));let layers=layersList.selectAll("g.stack").data(this.data());const layersEnter=layers.enter().append("g").attr("class",(d,i)=>`stack _${i}`);layers=layersEnter.merge(layers),this._drawLine(layersEnter,layers),this._drawArea(layersEnter,layers),this._drawDots(chartBody,layers),this.renderLabel()&&this._drawLabels(layers)}curve(curve){return arguments.length?(this._curve=curve,this):this._curve}interpolate(interpolate){return logger.warnOnce("dc.lineChart.interpolate has been deprecated since version 3.0 use dc.lineChart.curve instead"),arguments.length?(this._interpolate=interpolate,this):this._interpolate}tension(tension){return logger.warnOnce("dc.lineChart.tension has been deprecated since version 3.0 use dc.lineChart.curve instead"),arguments.length?(this._tension=tension,this):this._tension}defined(defined){return arguments.length?(this._defined=defined,this):this._defined}dashStyle(dashStyle){return arguments.length?(this._dashStyle=dashStyle,this):this._dashStyle}renderArea(renderArea){return arguments.length?(this._renderArea=renderArea,this):this._renderArea}_getColor(d,i){return this.getColor.call(d,d.values,i)}_getCurveFactory(){let curve=null;if(this._curve)return this._curve;if("function"==typeof this._interpolate)curve=this._interpolate;else{const mapping={linear:d3Shape.curveLinear,"linear-closed":d3Shape.curveLinearClosed,step:d3Shape.curveStep,"step-before":d3Shape.curveStepBefore,"step-after":d3Shape.curveStepAfter,basis:d3Shape.curveBasis,"basis-open":d3Shape.curveBasisOpen,"basis-closed":d3Shape.curveBasisClosed,bundle:d3Shape.curveBundle,cardinal:d3Shape.curveCardinal,"cardinal-open":d3Shape.curveCardinalOpen,"cardinal-closed":d3Shape.curveCardinalClosed,monotone:d3Shape.curveMonotoneX};curve=mapping[this._interpolate]}return curve||(curve=d3Shape.curveLinear),null!==this._tension&&("function"!=typeof curve.tension?logger.warn("tension was specified but the curve/interpolate does not support it."):curve=curve.tension(this._tension)),curve}_drawLine(layersEnter,layers){const _line=d3Shape.line().x(d=>this.x()(d.x)).y(d=>this.y()(d.y+d.y0)).curve(this._getCurveFactory());this._defined&&_line.defined(this._defined);const path=layersEnter.append("path").attr("class","line").attr("stroke",(d,i)=>this._getColor(d,i));this._dashStyle&&path.attr("stroke-dasharray",this._dashStyle),transition(layers.select("path.line"),this.transitionDuration(),this.transitionDelay()).attr("stroke",(d,i)=>this._getColor(d,i)).attr("d",d=>this._safeD(_line(d.values)))}_drawArea(layersEnter,layers){if(this._renderArea){const _area=d3Shape.area().x(d=>this.x()(d.x)).y1(d=>this.y()(d.y+d.y0)).y0(d=>this.y()(d.y0)).curve(this._getCurveFactory());this._defined&&_area.defined(this._defined),layersEnter.append("path").attr("class","area").attr("fill",(d,i)=>this._getColor(d,i)).attr("d",d=>this._safeD(_area(d.values))),transition(layers.select("path.area"),this.transitionDuration(),this.transitionDelay()).attr("fill",(d,i)=>this._getColor(d,i)).attr("d",d=>this._safeD(_area(d.values)))}}_safeD(d){return!d||d.indexOf("NaN")>=0?"M0,0":d}_drawDots(chartBody,layers){if("always"===this.xyTipsOn()||!this.brushOn()&&!this.parentBrushOn()&&this.xyTipsOn()){const tooltipListClass="dc-tooltip-list";let tooltips=chartBody.select(`g.${tooltipListClass}`);tooltips.empty()&&(tooltips=chartBody.append("g").attr("class",tooltipListClass)),layers.each((data,layerIndex)=>{let points=data.values;this._defined&&(points=points.filter(this._defined));let g=tooltips.select(`g.dc-tooltip._${layerIndex}`);g.empty()&&(g=tooltips.append("g").attr("class",`dc-tooltip _${layerIndex}`)),this._createRefLines(g);const dots=g.selectAll("circle.dot").data(points,pluck("x")),chart=this,dotsEnterModify=dots.enter().append("circle").attr("class","dot").classed("dc-tabbable",this._keyboardAccessible).attr("cx",d=>utils.safeNumber(this.x()(d.x))).attr("cy",d=>utils.safeNumber(this.y()(d.y+d.y0))).attr("r",this._getDotRadius()).style("fill-opacity",this._dataPointFillOpacity).style("stroke-opacity",this._dataPointStrokeOpacity).attr("fill",this.getColor).attr("stroke",this.getColor).on("mousemove",(function(){const dot=d3Selection.select(this);chart._showDot(dot),chart._showRefLines(dot,g)})).on("mouseout",(function(){const dot=d3Selection.select(this);chart._hideDot(dot),chart._hideRefLines(g)})).merge(dots);this._keyboardAccessible&&this._svg.selectAll(".dc-tabbable").attr("tabindex",0).on("focus",(function(){const dot=d3Selection.select(this);chart._showDot(dot),chart._showRefLines(dot,g)})).on("blur",(function(){const dot=d3Selection.select(this);chart._hideDot(dot),chart._hideRefLines(g)})),dotsEnterModify.call(dot=>this._doRenderTitle(dot,data)),transition(dotsEnterModify,this.transitionDuration()).attr("cx",d=>utils.safeNumber(this.x()(d.x))).attr("cy",d=>utils.safeNumber(this.y()(d.y+d.y0))).attr("fill",this.getColor),dots.exit().remove()})}}_drawLabels(layers){const chart=this;layers.each((function(data,layerIndex){const layer=d3Selection.select(this),labels=layer.selectAll("text.lineLabel").data(data.values,pluck("x")),labelsEnterModify=labels.enter().append("text").attr("class","lineLabel").attr("text-anchor","middle").merge(labels);transition(labelsEnterModify,chart.transitionDuration()).attr("x",d=>utils.safeNumber(chart.x()(d.x))).attr("y",d=>{const y=chart.y()(d.y+d.y0)-3;return utils.safeNumber(y)}).text(d=>chart.label()(d)),transition(labels.exit(),chart.transitionDuration()).attr("height",0).remove()}))}_createRefLines(g){const yRefLine=g.select("path.yRef").empty()?g.append("path").attr("class","yRef"):g.select("path.yRef");yRefLine.style("display","none").attr("stroke-dasharray","5,5");const xRefLine=g.select("path.xRef").empty()?g.append("path").attr("class","xRef"):g.select("path.xRef");xRefLine.style("display","none").attr("stroke-dasharray","5,5")}_showDot(dot){return dot.style("fill-opacity",.8),dot.style("stroke-opacity",.8),dot.attr("r",this._dotRadius),dot}_showRefLines(dot,g){const x=dot.attr("cx"),y=dot.attr("cy"),yAxisX=this._yAxisX()-this.margins().left,yAxisRefPathD=`M${yAxisX} ${y}L${x} ${y}`,xAxisRefPathD=`M${x} ${this.yAxisHeight()}L${x} ${y}`;g.select("path.yRef").style("display","").attr("d",yAxisRefPathD),g.select("path.xRef").style("display","").attr("d",xAxisRefPathD)}_getDotRadius(){return this._dataPointRadius||this._dotRadius}_hideDot(dot){dot.style("fill-opacity",this._dataPointFillOpacity).style("stroke-opacity",this._dataPointStrokeOpacity).attr("r",this._getDotRadius())}_hideRefLines(g){g.select("path.yRef").style("display","none"),g.select("path.xRef").style("display","none")}_doRenderTitle(dot,d){this.renderTitle()&&(dot.select("title").remove(),dot.append("title").text(pluck("data",this.title(d.name))))}xyTipsOn(xyTipsOn){return arguments.length?(this._xyTipsOn=xyTipsOn,this):this._xyTipsOn}dotRadius(dotRadius){return arguments.length?(this._dotRadius=dotRadius,this):this._dotRadius}renderDataPoints(options){return arguments.length?(options?(this._dataPointFillOpacity=options.fillOpacity||.8,this._dataPointStrokeOpacity=options.strokeOpacity||0,this._dataPointRadius=options.radius||2):(this._dataPointFillOpacity=1e-6,this._dataPointStrokeOpacity=1e-6,this._dataPointRadius=null),this):{fillOpacity:this._dataPointFillOpacity,strokeOpacity:this._dataPointStrokeOpacity,radius:this._dataPointRadius}}_colorFilter(color,dashstyle,inv){return function(){const item=d3Selection.select(this),match=item.attr("stroke")===color&&item.attr("stroke-dasharray")===(dashstyle instanceof Array?dashstyle.join(","):null)||item.attr("fill")===color;return inv?!match:match}}legendHighlight(d){this.isLegendableHidden(d)||this.g().selectAll("path.line, path.area").classed("highlight",this._colorFilter(d.color,d.dashstyle)).classed("fadeout",this._colorFilter(d.color,d.dashstyle,!0))}legendReset(){this.g().selectAll("path.line, path.area").classed("highlight",!1).classed("fadeout",!1)}legendables(){const legendables=super.legendables();return this._dashStyle?legendables.map(l=>(l.dashstyle=this._dashStyle,l)):legendables}}const lineChart=(parent,chartGroup)=>new LineChart(parent,chartGroup),SPAN_CLASS="number-display";class NumberDisplay extends BaseMixin{constructor(parent,chartGroup){super(),this._formatNumber=d3Format.format(".2s"),this._html={one:"",some:"",none:""},this._lastValue=void 0,this._ariaLiveRegion=!1,this._mandatoryAttributes(["group"]),this.ordering(kv=>kv.value),this.data(group=>{const valObj=group.value?group.value():this._maxBin(group.all());return this.valueAccessor()(valObj)}),this.transitionDuration(250),this.transitionDelay(0),this.anchor(parent,chartGroup)}html(html){return arguments.length?(html.none?this._html.none=html.none:html.one?this._html.none=html.one:html.some&&(this._html.none=html.some),html.one?this._html.one=html.one:html.some&&(this._html.one=html.some),html.some?this._html.some=html.some:html.one&&(this._html.some=html.one),this):this._html}value(){return this.data()}_maxBin(all){if(!all.length)return null;const sorted=this._computeOrderedGroups(all);return sorted[sorted.length-1]}_doRender(){const newValue=this.value();let span=this.selectAll(`.${SPAN_CLASS}`);span.empty()&&(span=span.data([0]).enter().append("span").attr("class",SPAN_CLASS).classed("dc-tabbable",this._keyboardAccessible).merge(span),this._keyboardAccessible&&span.attr("tabindex","0"),this._ariaLiveRegion&&(this.transitionDuration(0),span.attr("aria-live","polite")));{const chart=this;span.transition().duration(chart.transitionDuration()).delay(chart.transitionDelay()).ease(d3Ease.easeQuad).tween("text",(function(){const interpStart=isFinite(chart._lastValue)?chart._lastValue:0,interp=d3Interpolate.interpolateNumber(interpStart||0,newValue);chart._lastValue=newValue;const node=this;return t=>{let html=null;const num=chart.formatNumber()(interp(t));0===newValue&&""!==chart._html.none?html=chart._html.none:1===newValue&&""!==chart._html.one?html=chart._html.one:""!==chart._html.some&&(html=chart._html.some),node.innerHTML=html?html.replace("%number",num):num}}))}}_doRedraw(){return this._doRender()}formatNumber(formatter){return arguments.length?(this._formatNumber=formatter,this):this._formatNumber}ariaLiveRegion(ariaLiveRegion){return arguments.length?(this._ariaLiveRegion=ariaLiveRegion,this):this._ariaLiveRegion}}const numberDisplay=(parent,chartGroup)=>new NumberDisplay(parent,chartGroup),DEFAULT_MIN_ANGLE_FOR_LABEL=.5;class PieChart extends(CapMixin(ColorMixin(BaseMixin))){constructor(parent,chartGroup){super(),this._sliceCssClass="pie-slice",this._labelCssClass="pie-label",this._sliceGroupCssClass="pie-slice-group",this._labelGroupCssClass="pie-label-group",this._emptyCssClass="empty-chart",this._emptyTitle="empty",this._radius=void 0,this._givenRadius=void 0,this._innerRadius=0,this._externalRadiusPadding=0,this._g=void 0,this._cx=void 0,this._cy=void 0,this._minAngleForLabel=.5,this._externalLabelRadius=void 0,this._drawPaths=!1,this.colorAccessor(d=>this.cappedKeyAccessor(d)),this.title(d=>`${this.cappedKeyAccessor(d)}: ${this.cappedValueAccessor(d)}`),this.label(d=>this.cappedKeyAccessor(d)),this.renderLabel(!0),this.transitionDuration(350),this.transitionDelay(0),this.anchor(parent,chartGroup)}slicesCap(cap){return this.cap(cap)}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.cx()},${this.cy()})`),this._g.append("g").attr("class",this._sliceGroupCssClass),this._g.append("g").attr("class",this._labelGroupCssClass),this._drawChart(),this}_drawChart(){const maxRadius=d3Array.min([this.width(),this.height()])/2;this._radius=this._givenRadius&&this._givenRadius<maxRadius?this._givenRadius:maxRadius;const arcs=this._buildArcs(),pieLayout=this._pieLayout();let pieData;if(d3Array.sum(this.data(),d=>this.cappedValueAccessor(d))?(pieData=pieLayout(this.data()),this._g.classed(this._emptyCssClass,!1)):(pieData=pieLayout([{key:this._emptyTitle,value:1,others:[this._emptyTitle]}]),this._g.classed(this._emptyCssClass,!0)),this._g){const slices=this._g.select(`g.${this._sliceGroupCssClass}`).selectAll(`g.${this._sliceCssClass}`).data(pieData),labels=this._g.select(`g.${this._labelGroupCssClass}`).selectAll(`text.${this._labelCssClass}`).data(pieData);this._removeElements(slices,labels),this._createElements(slices,labels,arcs,pieData),this._updateElements(pieData,arcs),this._highlightFilter(),transition(this._g,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.cx()},${this.cy()})`)}}_createElements(slices,labels,arcs,pieData){const slicesEnter=this._createSliceNodes(slices);this._createSlicePath(slicesEnter,arcs),this._createTitles(slicesEnter),this._createLabels(labels,pieData,arcs)}_createSliceNodes(slices){return slices.enter().append("g").attr("class",(d,i)=>`${this._sliceCssClass} _${i}`).classed("dc-tabbable",this._keyboardAccessible)}_createSlicePath(slicesEnter,arcs){const slicePath=slicesEnter.append("path").attr("fill",(d,i)=>this._fill(d,i)).on("click",d3compat.eventHandler(d=>this._onClick(d))).attr("d",(d,i)=>this._safeArc(d,i,arcs));this._keyboardAccessible&&this._makeKeyboardAccessible(this._onClick);const tranNodes=transition(slicePath,this.transitionDuration(),this.transitionDelay());if(tranNodes.attrTween){const chart=this;tranNodes.attrTween("d",(function(d){return chart._tweenPie(d,this)}))}}_createTitles(slicesEnter){this.renderTitle()&&slicesEnter.append("title").text(d=>this.title()(d.data))}_applyLabelText(labels){labels.text(d=>{const data=d.data;return!this._sliceHasNoData(data)&&!this._sliceTooSmall(d)||this._isSelectedSlice(d)?this.label()(d.data):""})}_positionLabels(labels,arcs){this._applyLabelText(labels),transition(labels,this.transitionDuration(),this.transitionDelay()).attr("transform",d=>this._labelPosition(d,arcs)).attr("text-anchor","middle")}_highlightSlice(i,whether){this.select(`g.pie-slice._${i}`).classed("highlight",whether)}_createLabels(labels,pieData,arcs){if(this.renderLabel()){const labelsEnter=labels.enter().append("text").attr("class",(d,i)=>{let classes=`${this._sliceCssClass} ${this._labelCssClass} _${i}`;return this._externalLabelRadius&&(classes+=" external"),classes}).on("click",d3compat.eventHandler(d=>this._onClick(d))).on("mouseover",d3compat.eventHandler(d=>{this._highlightSlice(d.index,!0)})).on("mouseout",d3compat.eventHandler(d=>{this._highlightSlice(d.index,!1)}));this._positionLabels(labelsEnter,arcs),this._externalLabelRadius&&this._drawPaths&&this._updateLabelPaths(pieData,arcs)}}_updateLabelPaths(pieData,arcs){let polyline=this._g.selectAll(`polyline.${this._sliceCssClass}`).data(pieData);polyline.exit().remove(),polyline=polyline.enter().append("polyline").attr("class",(d,i)=>`pie-path _${i} ${this._sliceCssClass}`).on("click",d3compat.eventHandler(d=>this._onClick(d))).on("mouseover",d3compat.eventHandler(d=>{this._highlightSlice(d.index,!0)})).on("mouseout",d3compat.eventHandler(d=>{this._highlightSlice(d.index,!1)})).merge(polyline);const arc2=d3Shape.arc().outerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).innerRadius(this._radius-this._externalRadiusPadding),tranNodes=transition(polyline,this.transitionDuration(),this.transitionDelay());tranNodes.attrTween?tranNodes.attrTween("points",(function(d){let current=this._current||d;current={startAngle:current.startAngle,endAngle:current.endAngle};const _interpolate=d3Interpolate.interpolate(current,d);return this._current=_interpolate(0),t=>{const d2=_interpolate(t);return[arcs.centroid(d2),arc2.centroid(d2)]}})):tranNodes.attr("points",d=>[arcs.centroid(d),arc2.centroid(d)]),tranNodes.style("visibility",d=>d.endAngle-d.startAngle<1e-4?"hidden":"visible")}_updateElements(pieData,arcs){this._updateSlicePaths(pieData,arcs),this._updateLabels(pieData,arcs),this._updateTitles(pieData)}_updateSlicePaths(pieData,arcs){const slicePaths=this._g.selectAll(`g.${this._sliceCssClass}`).data(pieData).select("path").attr("d",(d,i)=>this._safeArc(d,i,arcs)),tranNodes=transition(slicePaths,this.transitionDuration(),this.transitionDelay());if(tranNodes.attrTween){const chart=this;tranNodes.attrTween("d",(function(d){return chart._tweenPie(d,this)}))}tranNodes.attr("fill",(d,i)=>this._fill(d,i))}_updateLabels(pieData,arcs){if(this.renderLabel()){const labels=this._g.selectAll(`text.${this._labelCssClass}`).data(pieData);this._positionLabels(labels,arcs),this._externalLabelRadius&&this._drawPaths&&this._updateLabelPaths(pieData,arcs)}}_updateTitles(pieData){this.renderTitle()&&this._g.selectAll(`g.${this._sliceCssClass}`).data(pieData).select("title").text(d=>this.title()(d.data))}_removeElements(slices,labels){slices.exit().remove(),labels.exit().remove()}_highlightFilter(){const chart=this;this.hasFilter()?this.selectAll(`g.${this._sliceCssClass}`).each((function(d){chart._isSelectedSlice(d)?chart.highlightSelected(this):chart.fadeDeselected(this)})):this.selectAll(`g.${this._sliceCssClass}`).each((function(){chart.resetHighlight(this)}))}externalRadiusPadding(externalRadiusPadding){return arguments.length?(this._externalRadiusPadding=externalRadiusPadding,this):this._externalRadiusPadding}innerRadius(innerRadius){return arguments.length?(this._innerRadius=innerRadius,this):this._innerRadius}radius(radius){return arguments.length?(this._givenRadius=radius,this):this._givenRadius}cx(cx){return arguments.length?(this._cx=cx,this):this._cx||this.width()/2}cy(cy){return arguments.length?(this._cy=cy,this):this._cy||this.height()/2}_buildArcs(){return d3Shape.arc().outerRadius(this._radius-this._externalRadiusPadding).innerRadius(this._innerRadius)}_isSelectedSlice(d){return this.hasFilter(this.cappedKeyAccessor(d.data))}_doRedraw(){return this._drawChart(),this}minAngleForLabel(minAngleForLabel){return arguments.length?(this._minAngleForLabel=minAngleForLabel,this):this._minAngleForLabel}_pieLayout(){return d3Shape.pie().sort(null).value(d=>this.cappedValueAccessor(d))}_sliceTooSmall(d){const angle=d.endAngle-d.startAngle;return isNaN(angle)||angle<this._minAngleForLabel}_sliceHasNoData(d){return 0===this.cappedValueAccessor(d)}_isOffCanvas(current){return!current||isNaN(current.startAngle)||isNaN(current.endAngle)}_fill(d,i){return this.getColor(d.data,i)}_onClick(d){this._g.attr("class")!==this._emptyCssClass&&this.onClick(d.data)}_safeArc(d,i,_arc){let path=_arc(d,i);return path.indexOf("NaN")>=0&&(path="M0,0"),path}emptyTitle(title){return 0===arguments.length?this._emptyTitle:(this._emptyTitle=title,this)}externalLabels(externalLabelRadius){return 0===arguments.length?this._externalLabelRadius:(this._externalLabelRadius=externalLabelRadius||void 0,this)}drawPaths(drawPaths){return 0===arguments.length?this._drawPaths:(this._drawPaths=drawPaths,this)}_labelPosition(d,_arc){let centroid;return centroid=this._externalLabelRadius?d3Shape.arc().outerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).innerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).centroid(d):_arc.centroid(d),isNaN(centroid[0])||isNaN(centroid[1])?"translate(0,0)":`translate(${centroid})`}legendables(){return this.data().map((d,i)=>{const legendable={name:d.key,data:d.value,others:d.others,chart:this};return legendable.color=this.getColor(d,i),legendable})}legendHighlight(d){this._highlightSliceFromLegendable(d,!0)}legendReset(d){this._highlightSliceFromLegendable(d,!1)}legendToggle(d){this.onClick({key:d.name,others:d.others})}_highlightSliceFromLegendable(legendable,highlighted){this.selectAll("g.pie-slice").each((function(d){legendable.name===d.data.key&&d3Selection.select(this).classed("highlight",highlighted)}))}_tweenPie(b,element){b.innerRadius=this._innerRadius;let current=element._current;current=this._isOffCanvas(current)?{startAngle:0,endAngle:0}:{startAngle:current.startAngle,endAngle:current.endAngle};const i=d3Interpolate.interpolate(current,b);return element._current=i(0),t=>this._safeArc(i(t),0,this._buildArcs())}}const pieChart=(parent,chartGroup)=>new PieChart(parent,chartGroup);class RowChart extends(CapMixin(ColorMixin(MarginMixin))){constructor(parent,chartGroup){super(),this._g=void 0,this._labelOffsetX=10,this._labelOffsetY=15,this._hasLabelOffsetY=!1,this._dyOffset="0.35em",this._titleLabelOffsetX=2,this._gap=5,this._fixedBarHeight=!1,this._rowCssClass="row",this._titleRowCssClass="titlerow",this._renderTitleLabel=!1,this._x=void 0,this._elasticX=void 0,this._xAxis=d3Axis.axisBottom(),this._rowData=void 0,this.rowsCap=this.cap,this.title(d=>`${this.cappedKeyAccessor(d)}: ${this.cappedValueAccessor(d)}`),this.label(d=>this.cappedKeyAccessor(d)),this.anchor(parent,chartGroup)}_calculateAxisScale(){if(!this._x||this._elasticX){const _extent=d3Array.extent(this._rowData,d=>this.cappedValueAccessor(d));_extent[0]>0&&(_extent[0]=0),_extent[1]<0&&(_extent[1]=0),this._x=d3Scale.scaleLinear().domain(_extent).range([0,this.effectiveWidth()])}this._xAxis.scale(this._x)}_drawAxis(){let axisG=this._g.select("g.axis");this._calculateAxisScale(),axisG.empty()&&(axisG=this._g.append("g").attr("class","axis")),axisG.attr("transform",`translate(0, ${this.effectiveHeight()})`),transition(axisG,this.transitionDuration(),this.transitionDelay()).call(this._xAxis)}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this._drawChart(),this}x(scale){return arguments.length?(this._x=scale,this):this._x}_drawGridLines(){this._g.selectAll("g.tick").select("line.grid-line").remove(),this._g.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",()=>-this.effectiveHeight())}_drawChart(){this._rowData=this.data(),this._drawAxis(),this._drawGridLines();let rows=this._g.selectAll(`g.${this._rowCssClass}`).data(this._rowData);this._removeElements(rows),rows=this._createElements(rows).merge(rows),this._updateElements(rows)}_createElements(rows){const rowEnter=rows.enter().append("g").attr("class",(d,i)=>`${this._rowCssClass} _${i}`);return rowEnter.append("rect").attr("width",0),this._createLabels(rowEnter),rowEnter}_removeElements(rows){rows.exit().remove()}_rootValue(){const root=this._x(0);return root===-1/0||root!=root?this._x(1):root}_updateElements(rows){const n=this._rowData.length;let height;height=this._fixedBarHeight?this._fixedBarHeight:(this.effectiveHeight()-(n+1)*this._gap)/n,this._hasLabelOffsetY||(this._labelOffsetY=height/2);const rect=rows.attr("transform",(d,i)=>`translate(0,${(i+1)*this._gap+i*height})`).select("rect").attr("height",height).attr("fill",this.getColor).on("click",d3compat.eventHandler(d=>this._onClick(d))).classed("dc-tabbable",this._keyboardAccessible).classed("deselected",d=>!!this.hasFilter()&&!this._isSelectedRow(d)).classed("selected",d=>!!this.hasFilter()&&this._isSelectedRow(d));this._keyboardAccessible&&this._makeKeyboardAccessible(d=>this._onClick(d)),transition(rect,this.transitionDuration(),this.transitionDelay()).attr("width",d=>Math.abs(this._rootValue()-this._x(this.cappedValueAccessor(d)))).attr("transform",d=>this._translateX(d)),this._createTitles(rows),this._updateLabels(rows)}_createTitles(rows){this.renderTitle()&&(rows.select("title").remove(),rows.append("title").text(this.title()))}_createLabels(rowEnter){this.renderLabel()&&rowEnter.append("text").on("click",d3compat.eventHandler(d=>this._onClick(d))),this.renderTitleLabel()&&rowEnter.append("text").attr("class",this._titleRowCssClass).on("click",d3compat.eventHandler(d=>this._onClick(d)))}_updateLabels(rows){if(this.renderLabel()){const lab=rows.select("text").attr("x",this._labelOffsetX).attr("y",this._labelOffsetY).attr("dy",this._dyOffset).on("click",d3compat.eventHandler(d=>this._onClick(d))).attr("class",(d,i)=>`${this._rowCssClass} _${i}`).text(d=>this.label()(d));transition(lab,this.transitionDuration(),this.transitionDelay()).attr("transform",d=>this._translateX(d))}if(this.renderTitleLabel()){const titlelab=rows.select(`.${this._titleRowCssClass}`).attr("x",this.effectiveWidth()-this._titleLabelOffsetX).attr("y",this._labelOffsetY).attr("dy",this._dyOffset).attr("text-anchor","end").on("click",d3compat.eventHandler(d=>this._onClick(d))).attr("class",(d,i)=>`${this._titleRowCssClass} _${i}`).text(d=>this.title()(d));transition(titlelab,this.transitionDuration(),this.transitionDelay()).attr("transform",d=>this._translateX(d))}}renderTitleLabel(renderTitleLabel){return arguments.length?(this._renderTitleLabel=renderTitleLabel,this):this._renderTitleLabel}_onClick(d){this.onClick(d)}_translateX(d){const x=this._x(this.cappedValueAccessor(d)),x0=this._rootValue(),s=x>x0?x0:x;return`translate(${s},0)`}_doRedraw(){return this._drawChart(),this}xAxis(xAxis){return arguments.length?(this._xAxis=xAxis,this):this._xAxis}fixedBarHeight(fixedBarHeight){return arguments.length?(this._fixedBarHeight=fixedBarHeight,this):this._fixedBarHeight}gap(gap){return arguments.length?(this._gap=gap,this):this._gap}elasticX(elasticX){return arguments.length?(this._elasticX=elasticX,this):this._elasticX}labelOffsetX(labelOffsetX){return arguments.length?(this._labelOffsetX=labelOffsetX,this):this._labelOffsetX}labelOffsetY(labelOffsety){return arguments.length?(this._labelOffsetY=labelOffsety,this._hasLabelOffsetY=!0,this):this._labelOffsetY}titleLabelOffsetX(titleLabelOffsetX){return arguments.length?(this._titleLabelOffsetX=titleLabelOffsetX,this):this._titleLabelOffsetX}_isSelectedRow(d){return this.hasFilter(this.cappedKeyAccessor(d))}}const rowChart=(parent,chartGroup)=>new RowChart(parent,chartGroup);class ScatterPlot extends CoordinateGridMixin{constructor(parent,chartGroup){super(),this._symbol=d3Shape.symbol(),this._existenceAccessor=d=>d.value;const originalKeyAccessor=this.keyAccessor();this.keyAccessor(d=>originalKeyAccessor(d)[0]),this.valueAccessor(d=>originalKeyAccessor(d)[1]),this.colorAccessor(()=>this._groupName),this.title(d=>`${this.keyAccessor()(d)},${this.valueAccessor()(d)}: ${this.existenceAccessor()(d)}`),this._highlightedSize=7,this._symbolSize=5,this._excludedSize=3,this._excludedColor=null,this._excludedOpacity=1,this._emptySize=0,this._emptyOpacity=0,this._nonemptyOpacity=1,this._emptyColor=null,this._filtered=[],this._canvas=null,this._context=null,this._useCanvas=!1,this.brush(d3Brush.brush()),this._symbol.size((d,i)=>this._elementSize(d,i)),this.anchor(parent,chartGroup)}_canvasElementSize(d,isFiltered){return this._existenceAccessor(d)?isFiltered?this._symbolSize/Math.sqrt(Math.PI):this._excludedSize/Math.sqrt(Math.PI):this._emptySize/Math.sqrt(Math.PI)}_elementSize(d,i){return this._existenceAccessor(d)?this._filtered[i]?Math.pow(this._symbolSize,2):Math.pow(this._excludedSize,2):Math.pow(this._emptySize,2)}_locator(d){return`translate(${this.x()(this.keyAccessor()(d))},${this.y()(this.valueAccessor()(d))})`}filter(filter){return arguments.length?super.filter(filters.RangedTwoDimensionalFilter(filter)):super.filter()}resetSvg(){if(this._useCanvas){super.resetSvg(),this.select("canvas").remove();const svgSel=this.svg(),rootSel=this.root();rootSel.style("position","relative"),svgSel.style("position","relative");const svgLeft=isNaN(parseInt(svgSel.style("left"),10))?0:parseInt(svgSel.style("left"),10),svgTop=isNaN(parseInt(svgSel.style("top"),10))?0:parseInt(svgSel.style("top"),10),width=this.effectiveWidth(),height=this.effectiveHeight(),margins=this.margins(),devicePixelRatio=window.devicePixelRatio||1;return this._canvas=this.root().append("canvas").attr("x",0).attr("y",0).attr("width",width*devicePixelRatio).attr("height",height*devicePixelRatio).style("width",`${width}px`).style("height",`${height}px`).style("position","absolute").style("top",`${margins.top+svgTop}px`).style("left",`${margins.left+svgLeft}px`).style("z-index",-1).style("pointer-events","none"),this._context=this._canvas.node().getContext("2d"),this._context.scale(devicePixelRatio,devicePixelRatio),this._context.rect(0,0,width,height),this._context.clip(),this._context.imageSmoothingQuality="high",this.svg()}return super.resetSvg()}_resizeCanvas(){const width=this.effectiveWidth(),height=this.effectiveHeight(),devicePixelRatio=window.devicePixelRatio||1;this._canvas.attr("width",width*devicePixelRatio).attr("height",height*devicePixelRatio).style("width",`${width}px`).style("height",`${height}px`),this._context.scale(devicePixelRatio,devicePixelRatio)}useCanvas(useCanvas){return arguments.length?(this._useCanvas=useCanvas,this):this._useCanvas}canvas(canvasElement){return arguments.length?(this._canvas=canvasElement,this):this._canvas}context(){return this._context}_plotOnCanvas(legendHighlightDatum){this._resizeCanvas();const context=this.context();context.clearRect(0,0,1*(context.canvas.width+2),1*(context.canvas.height+2));const data=this.data();data.forEach((d,i)=>{const isFiltered=!this.filter()||this.filter().isFiltered([d.key[0],d.key[1]]);let cOpacity=1;cOpacity=this._existenceAccessor(d)?isFiltered?this._nonemptyOpacity:this.excludedOpacity():this._emptyOpacity;let cColor=null;cColor=this._emptyColor&&!this._existenceAccessor(d)?this._emptyColor:this.excludedColor()&&!isFiltered?this.excludedColor():this.getColor(d);let cSize=this._canvasElementSize(d,isFiltered);if(legendHighlightDatum){const isHighlighted=cColor===legendHighlightDatum.color,fadeOutOpacity=.1;isHighlighted||(cOpacity=fadeOutOpacity),isHighlighted&&(cSize=this._highlightedSize/Math.sqrt(Math.PI))}context.save(),context.globalAlpha=cOpacity,context.beginPath(),context.arc(this.x()(this.keyAccessor()(d)),this.y()(this.valueAccessor()(d)),cSize,0,2*Math.PI,!0),context.fillStyle=cColor,context.fill(),context.restore()})}_plotOnSVG(){const data=this.data();this._keyboardAccessible&&data.sort((a,b)=>d3Array.ascending(this.keyAccessor()(a),this.keyAccessor()(b)));let symbols=this.chartBodyG().selectAll("path.symbol").data(data);transition(symbols.exit(),this.transitionDuration(),this.transitionDelay()).attr("opacity",0).remove(),symbols=symbols.enter().append("path").attr("class","symbol").classed("dc-tabbable",this._keyboardAccessible).attr("opacity",0).attr("fill",this.getColor).attr("transform",d=>this._locator(d)).merge(symbols),this._keyboardAccessible&&(this._makeKeyboardAccessible(),symbols.order()),symbols.call(s=>this._renderTitles(s,data)),symbols.each((d,i)=>{this._filtered[i]=!this.filter()||this.filter().isFiltered([this.keyAccessor()(d),this.valueAccessor()(d)])}),transition(symbols,this.transitionDuration(),this.transitionDelay()).attr("opacity",(d,i)=>this._existenceAccessor(d)?this._filtered[i]?this._nonemptyOpacity:this.excludedOpacity():this._emptyOpacity).attr("fill",(d,i)=>this._emptyColor&&!this._existenceAccessor(d)?this._emptyColor:this.excludedColor()&&!this._filtered[i]?this.excludedColor():this.getColor(d)).attr("transform",d=>this._locator(d)).attr("d",this._symbol)}plotData(){this._useCanvas?this._plotOnCanvas():this._plotOnSVG()}_renderTitles(_symbol,_d){this.renderTitle()&&(_symbol.selectAll("title").remove(),_symbol.append("title").text(d=>this.title()(d)))}existenceAccessor(accessor){return arguments.length?(this._existenceAccessor=accessor,this):this._existenceAccessor}symbol(type){return arguments.length?(this._symbol.type(type),this):this._symbol.type()}customSymbol(customSymbol){return arguments.length?(this._symbol=customSymbol,this._symbol.size((d,i)=>this._elementSize(d,i)),this):this._symbol}symbolSize(symbolSize){return arguments.length?(this._symbolSize=symbolSize,this):this._symbolSize}highlightedSize(highlightedSize){return arguments.length?(this._highlightedSize=highlightedSize,this):this._highlightedSize}excludedSize(excludedSize){return arguments.length?(this._excludedSize=excludedSize,this):this._excludedSize}excludedColor(excludedColor){return arguments.length?(this._excludedColor=excludedColor,this):this._excludedColor}excludedOpacity(excludedOpacity){return arguments.length?(this._excludedOpacity=excludedOpacity,this):this._excludedOpacity}emptySize(emptySize){return arguments.length?(this._emptySize=emptySize,this):this._emptySize}hiddenSize(emptySize){return arguments.length?this.emptySize(emptySize):this.emptySize()}emptyColor(emptyColor){return arguments.length?(this._emptyColor=emptyColor,this):this._emptyColor}emptyOpacity(emptyOpacity){return arguments.length?(this._emptyOpacity=emptyOpacity,this):this._emptyOpacity}nonemptyOpacity(nonemptyOpacity){return arguments.length?(this._nonemptyOpacity=nonemptyOpacity,this):this._emptyOpacity}legendables(){return[{chart:this,name:this._groupName,color:this.getColor()}]}legendHighlight(d){this._useCanvas?this._plotOnCanvas(d):(this._resizeSymbolsWhere(s=>s.attr("fill")===d.color,this._highlightedSize),this.chartBodyG().selectAll(".chart-body path.symbol").filter((function(){return d3Selection.select(this).attr("fill")!==d.color})).classed("fadeout",!0))}legendReset(d){this._useCanvas?this._plotOnCanvas(d):(this._resizeSymbolsWhere(s=>s.attr("fill")===d.color,this._symbolSize),this.chartBodyG().selectAll(".chart-body path.symbol").filter((function(){return d3Selection.select(this).attr("fill")!==d.color})).classed("fadeout",!1))}_resizeSymbolsWhere(condition,size){const symbols=this.chartBodyG().selectAll(".chart-body path.symbol").filter((function(){return condition(d3Selection.select(this))})),oldSize=this._symbol.size();this._symbol.size(Math.pow(size,2)),transition(symbols,this.transitionDuration(),this.transitionDelay()).attr("d",this._symbol),this._symbol.size(oldSize)}createBrushHandlePaths(){}extendBrush(brushSelection){return this.round()&&(brushSelection[0]=brushSelection[0].map(this.round()),brushSelection[1]=brushSelection[1].map(this.round())),brushSelection}brushIsEmpty(brushSelection){return!brushSelection||brushSelection[0][0]>=brushSelection[1][0]||brushSelection[0][1]>=brushSelection[1][1]}_brushing(evt){if(this._ignoreBrushEvents)return;let brushSelection=evt.selection,brushIsEmpty=this.brushIsEmpty(brushSelection);brushSelection&&(brushSelection=brushSelection.map(point=>point.map((coord,i)=>{const scale=0===i?this.x():this.y();return scale.invert(coord)})),brushSelection=this.extendBrush(brushSelection),brushIsEmpty=brushIsEmpty&&this.brushIsEmpty(brushSelection)),this.redrawBrush(brushSelection,!1);const ranged2DFilter=brushIsEmpty?null:filters.RangedTwoDimensionalFilter(brushSelection);events.trigger(()=>{this.replaceFilter(ranged2DFilter),this.redrawGroup()},constants.EVENT_DELAY)}redrawBrush(brushSelection,doTransition){if(this._gBrush=this.gBrush(),this.brushOn()&&this._gBrush)if(this.resizing()&&this.setBrushExtents(doTransition),brushSelection){brushSelection=brushSelection.map(point=>point.map((coord,i)=>{const scale=0===i?this.x():this.y();return scale(coord)}));const gBrush=optionalTransition(doTransition,this.transitionDuration(),this.transitionDelay())(this._gBrush);this._withoutBrushEvents(()=>{gBrush.call(this.brush().move,brushSelection)})}else this._withoutBrushEvents(()=>{this._gBrush.call(this.brush().move,brushSelection)});this.fadeDeselectedArea(brushSelection)}}const scatterPlot=(parent,chartGroup)=>new ScatterPlot(parent,chartGroup),SELECT_CSS_CLASS="dc-select-menu",OPTION_CSS_CLASS="dc-select-option";class SelectMenu extends BaseMixin{constructor(parent,chartGroup){super(),this._select=void 0,this._promptText="Select all",this._multiple=!1,this._promptValue=null,this._numberVisible=null,this.data(group=>group.all().filter(this._filterDisplayed)),this._filterDisplayed=d=>this.valueAccessor()(d)>0,this._order=(a,b)=>this.keyAccessor()(a)>this.keyAccessor()(b)?1:this.keyAccessor()(a)<this.keyAccessor()(b)?-1:0,this.anchor(parent,chartGroup)}_doRender(){return this.select("select").remove(),this._select=this.root().append("select").classed("dc-select-menu",!0),this._select.append("option").text(this._promptText).attr("value",""),this._doRedraw(),this}_doRedraw(){return this._setAttributes(),this._renderOptions(),this.hasFilter()&&this._multiple?this._select.selectAll("option").property("selected",d=>void 0!==d&&this.filters().indexOf(String(this.keyAccessor()(d)))>=0):this.hasFilter()?this._select.property("value",this.filter()):this._select.property("value",""),this}_renderOptions(){const options=this._select.selectAll("option.dc-select-option").data(this.data(),d=>this.keyAccessor()(d));options.exit().remove(),options.enter().append("option").classed(OPTION_CSS_CLASS,!0).attr("value",d=>this.keyAccessor()(d)).merge(options).text(this.title()),this._select.selectAll("option.dc-select-option").sort(this._order),this._select.on("change",d3compat.eventHandler((d,evt)=>this._onChange(d,evt)))}_onChange(_d,evt){let values;const target=evt.target;if(target.selectedOptions){const selectedOptions=Array.prototype.slice.call(target.selectedOptions);values=selectedOptions.map(d=>d.value)}else{const options=[].slice.call(evt.target.options);values=options.filter(option=>option.selected).map(option=>option.value)}1===values.length&&""===values[0]?values=this._promptValue||null:this._multiple||1!==values.length||(values=values[0]),this.onChange(values)}onChange(val){val&&this._multiple?this.replaceFilter([val]):val?this.replaceFilter(val):this.filterAll(),events.trigger(()=>{this.redrawGroup()})}_setAttributes(){this._multiple?this._select.attr("multiple",!0):this._select.attr("multiple",null),null!==this._numberVisible?this._select.attr("size",this._numberVisible):this._select.attr("size",null)}order(order){return arguments.length?(this._order=order,this):this._order}promptText(promptText){return arguments.length?(this._promptText=promptText,this):this._promptText}filterDisplayed(filterDisplayed){return arguments.length?(this._filterDisplayed=filterDisplayed,this):this._filterDisplayed}multiple(multiple){return arguments.length?(this._multiple=multiple,this):this._multiple}promptValue(promptValue){return arguments.length?(this._promptValue=promptValue,this):this._promptValue}numberVisible(numberVisible){return arguments.length?(this._numberVisible=numberVisible,this):this._numberVisible}size(numberVisible){return logger.warnOnce("selectMenu.size is ambiguous - use selectMenu.numberVisible instead"),arguments.length?this.numberVisible(numberVisible):this.numberVisible()}}const selectMenu=(parent,chartGroup)=>new SelectMenu(parent,chartGroup);class SeriesChart extends CompositeChart{constructor(parent,chartGroup){super(parent,chartGroup),this._keySort=(a,b)=>d3Array.ascending(this.keyAccessor()(a),this.keyAccessor()(b)),this._charts={},this._chartFunction=lineChart,this._chartGroup=chartGroup,this._seriesAccessor=void 0,this._seriesSort=d3Array.ascending,this._valueSort=this._keySort,this._mandatoryAttributes().push("seriesAccessor","chart"),this.shareColors(!0)}_compose(subChartArray){super.compose(subChartArray)}compose(subChartArray){throw new Error("Not supported for this chart type")}_preprocessData(){const keep=[];let childrenChanged;const nesting=d3compat.nester({key:this._seriesAccessor,sortKeys:this._seriesSort,sortValues:this._valueSort,entries:this.data()}),children=nesting.map((sub,i)=>{const subChart=this._charts[sub.key]||this._chartFunction(this,this._chartGroup,sub.key,i);return this._charts[sub.key]||(childrenChanged=!0),this._charts[sub.key]=subChart,keep.push(sub.key),subChart.dimension(this.dimension()).group({all:"function"==typeof sub.values?sub.values:utils.constant(sub.values)},sub.key).keyAccessor(this.keyAccessor()).valueAccessor(this.valueAccessor()).brushOn(!1)});Object.keys(this._charts).filter(c=>-1===keep.indexOf(c)).forEach(c=>{this._clearChart(c),childrenChanged=!0}),this._compose(children),childrenChanged&&this.legend()&&this.legend().render()}_clearChart(c){this._charts[c].g()&&this._charts[c].g().remove(),delete this._charts[c]}_resetChildren(){Object.keys(this._charts).map(this._clearChart.bind(this)),this._charts={}}chart(chartFunction){return arguments.length?(this._chartFunction=chartFunction,this._resetChildren(),this):this._chartFunction}seriesAccessor(accessor){return arguments.length?(this._seriesAccessor=accessor,this._resetChildren(),this):this._seriesAccessor}seriesSort(sortFunction){return arguments.length?(this._seriesSort=sortFunction,this._resetChildren(),this):this._seriesSort}valueSort(sortFunction){return arguments.length?(this._valueSort=sortFunction,this._resetChildren(),this):this._valueSort}}const seriesChart=(parent,chartGroup)=>new SeriesChart(parent,chartGroup),DEFAULT_MIN_ANGLE_FOR_LABEL$1=.5;class SunburstChart extends(ColorMixin(BaseMixin)){constructor(parent,chartGroup){super(),this._sliceCssClass="pie-slice",this._emptyCssClass="empty-chart",this._emptyTitle="empty",this._radius=void 0,this._givenRadius=void 0,this._innerRadius=0,this._ringSizes=null,this._g=void 0,this._cx=void 0,this._cy=void 0,this._minAngleForLabel=.5,this._externalLabelRadius=void 0,this.colorAccessor(d=>this.keyAccessor()(d)),this.ordering(pluck("key")),this.title(d=>`${this.keyAccessor()(d)}: ${this._extendedValueAccessor(d)}`),this.label(d=>this.keyAccessor()(d)),this.renderLabel(!0),this.transitionDuration(350),this.anchor(parent,chartGroup)}_extendedValueAccessor(d){return d.path?d.value:this.valueAccessor()(d)}_scaleRadius(ringIndex,y){if(0===ringIndex)return this._innerRadius;{const customRelativeRadius=d3Array.sum(this.ringSizes().relativeRingSizes.slice(0,ringIndex)),scaleFactor=ringIndex*(1/this.ringSizes().relativeRingSizes.length)/customRelativeRadius,standardRadius=(y-this.ringSizes().rootOffset)/(1-this.ringSizes().rootOffset)*(this._radius-this._innerRadius);return this._innerRadius+standardRadius/scaleFactor}}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.cx()},${this.cy()})`),this._drawChart(),this}_drawChart(){const maxRadius=d3Array.min([this.width(),this.height()])/2;this._radius=this._givenRadius&&this._givenRadius<maxRadius?this._givenRadius:maxRadius;const arcs=this._buildArcs();let partitionedNodes,cdata;if(d3Array.sum(this.data(),this.valueAccessor())?(cdata=utils.toHierarchy(this.data(),this.valueAccessor()),partitionedNodes=this._partitionNodes(cdata),partitionedNodes.nodes.shift(),this._g.classed(this._emptyCssClass,!1)):(cdata=utils.toHierarchy([],d=>d.value),partitionedNodes=this._partitionNodes(cdata),this._g.classed(this._emptyCssClass,!0)),this.ringSizes().rootOffset=partitionedNodes.rootOffset,this.ringSizes().relativeRingSizes=partitionedNodes.relativeRingSizes,this._g){const slices=this._g.selectAll(`g.${this._sliceCssClass}`).data(partitionedNodes.nodes);this._createElements(slices,arcs,partitionedNodes.nodes),this._updateElements(partitionedNodes.nodes,arcs),this._removeElements(slices),this._highlightFilter(),transition(this._g,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.cx()},${this.cy()})`)}}_createElements(slices,arcs,sunburstData){const slicesEnter=this._createSliceNodes(slices);this._createSlicePath(slicesEnter,arcs),this._createTitles(slicesEnter),this._createLabels(sunburstData,arcs)}_createSliceNodes(slices){return slices.enter().append("g").attr("class",(d,i)=>`${this._sliceCssClass} _${i} ${this._sliceCssClass}-level-${d.depth}`)}_createSlicePath(slicesEnter,arcs){const slicePath=slicesEnter.append("path").attr("fill",(d,i)=>this._fill(d,i)).on("click",d3compat.eventHandler(d=>this.onClick(d))).classed("dc-tabbable",this._keyboardAccessible).attr("d",d=>this._safeArc(arcs,d));this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick);const tranNodes=transition(slicePath,this.transitionDuration());if(tranNodes.attrTween){const chart=this;tranNodes.attrTween("d",(function(d){return chart._tweenSlice(d,this)}))}}_createTitles(slicesEnter){this.renderTitle()&&slicesEnter.append("title").text(d=>this.title()(d))}_positionLabels(labelsEnter,arcs){transition(labelsEnter,this.transitionDuration()).attr("transform",d=>this._labelPosition(d,arcs)).attr("text-anchor","middle").text(d=>this._sliceHasNoData(d)||this._sliceTooSmall(d)?"":this.label()(d))}_createLabels(sunburstData,arcs){if(this.renderLabel()){const labels=this._g.selectAll(`text.${this._sliceCssClass}`).data(sunburstData);labels.exit().remove();const labelsEnter=labels.enter().append("text").attr("class",(d,i)=>{let classes=`${this._sliceCssClass} _${i}`;return this._externalLabelRadius&&(classes+=" external"),classes}).on("click",d3compat.eventHandler(d=>this.onClick(d)));this._positionLabels(labelsEnter,arcs)}}_updateElements(sunburstData,arcs){this._updateSlicePaths(sunburstData,arcs),this._updateLabels(sunburstData,arcs),this._updateTitles(sunburstData)}_updateSlicePaths(sunburstData,arcs){const slicePaths=this._g.selectAll(`g.${this._sliceCssClass}`).data(sunburstData).select("path").attr("d",(d,i)=>this._safeArc(arcs,d)),tranNodes=transition(slicePaths,this.transitionDuration());if(tranNodes.attrTween){const chart=this;tranNodes.attrTween("d",(function(d){return chart._tweenSlice(d,this)}))}tranNodes.attr("fill",(d,i)=>this._fill(d,i))}_updateLabels(sunburstData,arcs){if(this.renderLabel()){const labels=this._g.selectAll(`text.${this._sliceCssClass}`).data(sunburstData);this._positionLabels(labels,arcs)}}_updateTitles(sunburstData){this.renderTitle()&&this._g.selectAll(`g.${this._sliceCssClass}`).data(sunburstData).select("title").text(d=>this.title()(d))}_removeElements(slices){slices.exit().remove()}_highlightFilter(){const chart=this;chart.hasFilter()?chart.selectAll(`g.${chart._sliceCssClass}`).each((function(d){chart._isSelectedSlice(d)?chart.highlightSelected(this):chart.fadeDeselected(this)})):chart.selectAll(`g.${chart._sliceCssClass}`).each((function(d){chart.resetHighlight(this)}))}innerRadius(innerRadius){return arguments.length?(this._innerRadius=innerRadius,this):this._innerRadius}radius(radius){return arguments.length?(this._givenRadius=radius,this):this._givenRadius}cx(cx){return arguments.length?(this._cx=cx,this):this._cx||this.width()/2}cy(cy){return arguments.length?(this._cy=cy,this):this._cy||this.height()/2}minAngleForLabel(minAngleForLabel){return arguments.length?(this._minAngleForLabel=minAngleForLabel,this):this._minAngleForLabel}emptyTitle(title){return 0===arguments.length?this._emptyTitle:(this._emptyTitle=title,this)}externalLabels(externalLabelRadius){return 0===arguments.length?this._externalLabelRadius:(this._externalLabelRadius=externalLabelRadius||void 0,this)}defaultRingSizes(){return{partitionDy:()=>this._radius*this._radius,scaleInnerRadius:d=>d.data.path&&1===d.data.path.length?this._innerRadius:Math.sqrt(d.y0),scaleOuterRadius:d=>Math.sqrt(d.y1),relativeRingSizesFunction:()=>[]}}equalRingSizes(){return this.relativeRingSizes(ringCount=>{const result=[];for(let i=0;i<ringCount;i++)result.push(1/ringCount);return result})}relativeRingSizes(relativeRingSizesFunction){function assertPortionsArray(relativeSizes,numberOfRings){if(!Array.isArray(relativeSizes))throw new BadArgumentException("relativeRingSizes function must return an array");const portionsSum=d3Array.sum(relativeSizes);if(Math.abs(portionsSum-1)>constants.NEGLIGIBLE_NUMBER)throw new BadArgumentException(`relativeRingSizes : portions must add up to 1, but sum was ${portionsSum}`);if(relativeSizes.length!==numberOfRings)throw new BadArgumentException(`relativeRingSizes : number of values must match number of rings (${numberOfRings}) but was ${relativeSizes.length}`)}return{partitionDy:()=>1,scaleInnerRadius:d=>this._scaleRadius(d.data.path.length-1,d.y0),scaleOuterRadius:d=>this._scaleRadius(d.data.path.length,d.y1),relativeRingSizesFunction:ringCount=>{const result=relativeRingSizesFunction(ringCount);return assertPortionsArray(result,ringCount),result}}}ringSizes(ringSizes){return arguments.length?(this._ringSizes=ringSizes,this):(this._ringSizes||(this._ringSizes=this.defaultRingSizes()),this._ringSizes)}_buildArcs(){return d3Shape.arc().startAngle(d=>d.x0).endAngle(d=>d.x1).innerRadius(d=>this.ringSizes().scaleInnerRadius(d)).outerRadius(d=>this.ringSizes().scaleOuterRadius(d))}_isSelectedSlice(d){return this._isPathFiltered(d.path)}_isPathFiltered(path){for(let i=0;i<this.filters().length;i++){const currentFilter=this.filters()[i];if(currentFilter.isFiltered(path))return!0}return!1}_filtersForPath(path){const pathFilter=filters.HierarchyFilter(path),filtersList=[];for(let i=0;i<this.filters().length;i++){const currentFilter=this.filters()[i];(currentFilter.isFiltered(path)||pathFilter.isFiltered(currentFilter))&&filtersList.push(currentFilter)}return filtersList}_doRedraw(){return this._drawChart(),this}_partitionNodes(data){const getSortable=function(d){return{key:d.data.key,value:d.value}},_hierarchy=d3Hierarchy.hierarchy(data).sum(d=>d.children?0:this._extendedValueAccessor(d)).sort((a,b)=>d3Array.ascending(this.ordering()(getSortable(a)),this.ordering()(getSortable(b)))),_partition=d3Hierarchy.partition().size([2*Math.PI,this.ringSizes().partitionDy()]);_partition(_hierarchy);const nodes=_hierarchy.descendants().map(d=>(d.key=d.data.key,d.path=d.data.path,d)),relativeSizes=this.ringSizes().relativeRingSizesFunction(_hierarchy.height);return{nodes:nodes,rootOffset:_hierarchy.y1,relativeRingSizes:relativeSizes}}_sliceTooSmall(d){const angle=d.x1-d.x0;return isNaN(angle)||angle<this._minAngleForLabel}_sliceHasNoData(d){return 0===this._extendedValueAccessor(d)}_isOffCanvas(d){return!d||isNaN(d.x0)||isNaN(d.y0)}_fill(d,i){return this.getColor(d.data,i)}onClick(d){if(this._g.attr("class")===this._emptyCssClass)return;const path=d.path||d.key,filter=filters.HierarchyFilter(path),filtersList=this._filtersForPath(path);let exactMatch=!1;for(let j=filtersList.length-1;j>=0;j--){const currentFilter=filtersList[j];utils.arraysIdentical(currentFilter,path)&&(exactMatch=!0),this.filter(filtersList[j])}events.trigger(()=>{exactMatch||this.filter(filter),this.redrawGroup()})}_safeArc(_arc,d){let path=_arc(d);return path.indexOf("NaN")>=0&&(path="M0,0"),path}_labelPosition(d,_arc){let centroid;return centroid=this._externalLabelRadius?d3Shape.arc().outerRadius(this._radius+this._externalLabelRadius).innerRadius(this._radius+this._externalLabelRadius).centroid(d):_arc.centroid(d),isNaN(centroid[0])||isNaN(centroid[1])?"translate(0,0)":`translate(${centroid})`}legendables(){return this.data().map((d,i)=>{const legendable={name:d.key,data:d.value,others:d.others,chart:this};return legendable.color=this.getColor(d,i),legendable})}legendHighlight(d){this._highlightSliceFromLegendable(d,!0)}legendReset(d){this._highlightSliceFromLegendable(d,!1)}legendToggle(d){this.onClick({key:d.name,others:d.others})}_highlightSliceFromLegendable(legendable,highlighted){this.selectAll("g.pie-slice").each((function(d){legendable.name===d.key&&d3Selection.select(this).classed("highlight",highlighted)}))}_tweenSlice(d,element){let current=element._current;this._isOffCanvas(current)&&(current={x0:0,x1:0,y0:0,y1:0});const tweenTarget={x0:d.x0,x1:d.x1,y0:d.y0,y1:d.y1},i=d3Interpolate.interpolate(current,tweenTarget);return element._current=i(0),t=>this._safeArc(this._buildArcs(),Object.assign({},d,i(t)))}}const sunburstChart=(parent,chartGroup)=>new SunburstChart(parent,chartGroup),INPUT_CSS_CLASS="dc-text-filter-input";class TextFilterWidget extends BaseMixin{constructor(parent,chartGroup){super(),this._normalize=s=>s.toLowerCase(),this._filterFunctionFactory=query=>(query=this._normalize(query),d=>-1!==this._normalize(d).indexOf(query)),this._placeHolder="search",this.group(()=>{throw"the group function on textFilterWidget should never be called, please report the issue"}),this.anchor(parent,chartGroup)}_doRender(){this.select("input").remove(),this._input=this.root().append("input").classed(INPUT_CSS_CLASS,!0);const chart=this;return this._input.on("input",(function(){chart.dimension().filterFunction(chart._filterFunctionFactory(this.value)),events.trigger(()=>{chart.redrawGroup()},constants.EVENT_DELAY)})),this._doRedraw(),this}_doRedraw(){return this.root().selectAll("input").attr("placeholder",this._placeHolder),this}normalize(normalize){return arguments.length?(this._normalize=normalize,this):this._normalize}placeHolder(placeHolder){return arguments.length?(this._placeHolder=placeHolder,this):this._placeHolder}filterFunctionFactory(filterFunctionFactory){return arguments.length?(this._filterFunctionFactory=filterFunctionFactory,this):this._filterFunctionFactory}}const textFilterWidget=(parent,chartGroup)=>new TextFilterWidget(parent,chartGroup),majorVer=+d3.version[0];majorVer<6&&Object.assign(d3compat,{eventHandler:handler=>function eventHandler(d,_){handler.call(this,d,d3Selection.event)},callHandler:function callHandler(handler,that,_,d){handler.call(that,d)},nester:({key:key,sortKeys:sortKeys,sortValues:sortValues,entries:entries})=>{const nester=d3Collection.nest().key(key);return sortKeys&&nester.sortKeys(sortKeys),sortValues&&nester.sortValues(sortValues),nester.entries(entries)},pointer:(evt,elem)=>d3Selection.mouse(elem)});const majorVer$1=+d3.version[0];majorVer$1>5&&Object.assign(d3compat,{eventHandler:handler=>function eventHandler(event,d){handler.call(this,d,event)},callHandler:function callHandler(handler,that,event,d){handler.call(that,event,d)},nester:({key:key,sortKeys:sortKeys,sortValues:sortValues,entries:entries})=>{sortValues&&(entries=[...entries].sort(sortValues));let out=d3Array.groups(entries,key);return sortKeys&&(out=out.sort(sortKeys)),out.map(e=>({key:`${e[0]}`,values:e[1]}))},pointer:d3Selection.pointer}),exports.BadArgumentException=BadArgumentException,exports.BarChart=BarChart,exports.BaseMixin=BaseMixin,exports.BoxPlot=BoxPlot,exports.BubbleChart=BubbleChart,exports.BubbleMixin=BubbleMixin,exports.BubbleOverlay=BubbleOverlay,exports.CapMixin=CapMixin,exports.CboxMenu=CboxMenu,exports.ColorMixin=ColorMixin,exports.CompositeChart=CompositeChart,exports.Config=Config,exports.CoordinateGridMixin=CoordinateGridMixin,exports.DataCount=DataCount,exports.DataGrid=DataGrid,exports.DataTable=DataTable,exports.GeoChoroplethChart=GeoChoroplethChart,exports.HeatMap=HeatMap,exports.HtmlLegend=HtmlLegend,exports.InvalidStateException=InvalidStateException,exports.Legend=Legend,exports.LineChart=LineChart,exports.Logger=Logger,exports.MarginMixin=MarginMixin,exports.NumberDisplay=NumberDisplay,exports.PieChart=PieChart,exports.RowChart=RowChart,exports.ScatterPlot=ScatterPlot,exports.SelectMenu=SelectMenu,exports.SeriesChart=SeriesChart,exports.StackMixin=StackMixin,exports.SunburstChart=SunburstChart,exports.TextFilterWidget=TextFilterWidget,exports.afterTransition=afterTransition,exports.barChart=barChart,exports.baseMixin=baseMixin,exports.boxPlot=boxPlot,exports.bubbleChart=bubbleChart,exports.bubbleOverlay=bubbleOverlay,exports.cboxMenu=cboxMenu,exports.chartRegistry=chartRegistry,exports.compositeChart=compositeChart,exports.config=config,exports.constants=constants,exports.d3Box=d3Box,exports.d3compat=d3compat,exports.dataCount=dataCount,exports.dataGrid=dataGrid,exports.dataTable=dataTable,exports.deregisterAllCharts=deregisterAllCharts,exports.deregisterChart=deregisterChart,exports.events=events,exports.filterAll=filterAll,exports.filters=filters,exports.geoChoroplethChart=geoChoroplethChart,exports.hasChart=hasChart,exports.heatMap=heatMap,exports.htmlLegend=htmlLegend,exports.instanceOfChart=instanceOfChart,exports.legend=legend,exports.lineChart=lineChart,exports.logger=logger,exports.numberDisplay=numberDisplay,exports.optionalTransition=optionalTransition,exports.pieChart=pieChart,exports.pluck=pluck,exports.printers=printers,exports.redrawAll=redrawAll,exports.refocusAll=refocusAll,exports.registerChart=registerChart,exports.renderAll=renderAll,exports.renderlet=renderlet,exports.rowChart=rowChart,exports.scatterPlot=scatterPlot,exports.selectMenu=selectMenu,exports.seriesChart=seriesChart,exports.sunburstChart=sunburstChart,exports.textFilterWidget=textFilterWidget,exports.transition=transition,exports.units=units,exports.utils=utils,exports.version="4.2.7",Object.defineProperty(exports,"__esModule",{value:!0})}));